{
  String url=pathHelper.getRequestUri(request).substring(pathHelper.getContextPath(request).length());
  String categoryId=request.getParameter("categoryId");
  if (categoryId != null) {
    Category category=catalogService.findCategoryById(new Long(categoryId));
    if (category != null) {
      url=category.getUrl();
    }
  }
  List<Long> categoryIdList=catalogService.getChildCategoryURLMapByCategoryId(rootCategory.getId()).get(url);
  List<Category> categoryList=null;
  if (categoryIdList != null) {
    categoryList=new ArrayList<Category>(categoryIdList.size());
    for (    Long id : categoryIdList) {
      categoryList.add(catalogService.findCategoryById(id));
    }
  }
  addCategoryListToModel(categoryList,rootCategory,url,model);
  model.addAttribute("rootCategory",rootCategory);
}
