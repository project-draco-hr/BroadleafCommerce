{
  Money amountToReverse=paymentContext.getRemainingTransactionAmount();
  PaymentInfo paymentInfo=findPaymentInfoFromContext(paymentContext);
  Money amountCaptured=paymentInfo.getPaymentCapturedAmount();
  Money amountAlreadyReversed=paymentInfo.getReverseAuthAmount();
  Money amount=paymentInfo.getAmount();
  Money amountAvailableToReverse=amount.subtract(amountCaptured).subtract(amountAlreadyReversed);
  if (amountAvailableToReverse.lessThan(amountToReverse)) {
    return amountAvailableToReverse;
  }
 else {
    return amountToReverse;
  }
}
