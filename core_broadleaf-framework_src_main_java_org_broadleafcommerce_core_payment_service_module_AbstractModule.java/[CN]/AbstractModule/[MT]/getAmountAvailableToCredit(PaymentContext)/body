{
  Money amountToCredit=paymentContext.getRemainingTransactionAmount();
  PaymentInfo paymentInfo=findPaymentInfoFromContext(paymentContext);
  Money amountCaptured=paymentInfo.getPaymentCapturedAmount();
  Money amountAlreadyCredited=paymentInfo.getPaymentCreditedAmount();
  Money amountAvailableToCredit=amountCaptured.subtract(amountAlreadyCredited);
  if (amountAvailableToCredit.lessThan(amountToCredit)) {
    return amountAvailableToCredit;
  }
 else {
    return amountToCredit;
  }
}
