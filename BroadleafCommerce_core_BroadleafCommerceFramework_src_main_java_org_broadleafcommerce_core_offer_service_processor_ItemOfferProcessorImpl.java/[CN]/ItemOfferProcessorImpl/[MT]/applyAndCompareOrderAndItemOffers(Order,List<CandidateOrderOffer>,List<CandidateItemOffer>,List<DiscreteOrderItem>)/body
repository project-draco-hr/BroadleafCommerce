{
  if (!qualifiedItemOffers.isEmpty()) {
    Collections.sort(qualifiedItemOffers,ItemOfferComparator.INSTANCE);
    applyAllItemOffers(qualifiedItemOffers,discreteOrderItems,order);
  }
  if (!qualifiedOrderOffers.isEmpty()) {
    Collections.sort(qualifiedOrderOffers,new BeanComparator("discountAmount",Collections.reverseOrder()));
    Collections.sort(qualifiedOrderOffers,new BeanComparator("priority"));
    qualifiedOrderOffers=removeTrailingNotCombinableOrderOffers(qualifiedOrderOffers);
    applyAllOrderOffers(qualifiedOrderOffers,order);
  }
  compileOrderTotal(order);
  if (!qualifiedOrderOffers.isEmpty() && !qualifiedItemOffers.isEmpty()) {
    List<CandidateOrderOffer> finalQualifiedOrderOffers=new ArrayList<CandidateOrderOffer>();
    order.removeAllOrderAdjustments();
    for (    CandidateOrderOffer condidateOrderOffer : qualifiedOrderOffers) {
      if (couldOfferApplyToOrder(condidateOrderOffer.getOffer(),order)) {
        finalQualifiedOrderOffers.add(condidateOrderOffer);
      }
    }
    Collections.sort(finalQualifiedOrderOffers,new BeanComparator("discountedPrice"));
    Collections.sort(finalQualifiedOrderOffers,new BeanComparator("priority"));
    if (!finalQualifiedOrderOffers.isEmpty()) {
      applyAllOrderOffers(finalQualifiedOrderOffers,order);
    }
  }
}
