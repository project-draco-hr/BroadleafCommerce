{
  if (LOG.isDebugEnabled()) {
    LOG.debug("recordClick() => Click detected for Email[" + emailId + "]");
  }
  Map parameterMap=request.getParameterMap();
  Iterator keys=parameterMap.keySet().iterator();
  ArrayList queryParms=new ArrayList();
  while (keys.hasNext()) {
    String p=(String)keys.next();
    if (!p.equals("email_id")) {
      queryParms.add(p);
    }
  }
  String newQuery=null;
  if (queryParms.size() > 0) {
    String[] p=(String[])queryParms.toArray(new String[queryParms.size()]);
    Arrays.sort(p);
    StringBuffer newQueryParms=new StringBuffer();
    for (int cnt=0; cnt < p.length; cnt++) {
      newQueryParms.append(p[cnt]);
      newQueryParms.append("=");
      newQueryParms.append(request.getParameter(p[cnt]));
      if (cnt != p.length - 1) {
        newQueryParms.append("&");
      }
    }
    newQuery=newQueryParms.toString();
  }
  String uri=request.getRequestURI();
  Customer customer=CustomerState.getCustomer(request);
  emailReportingDao.recordClick(emailId,customer,uri,newQuery);
}
