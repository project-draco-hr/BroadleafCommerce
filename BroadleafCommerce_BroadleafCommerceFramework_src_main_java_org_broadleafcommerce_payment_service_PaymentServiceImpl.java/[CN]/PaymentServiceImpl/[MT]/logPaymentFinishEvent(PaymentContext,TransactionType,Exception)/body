{
  PaymentLog log=paymentInfoService.createLog();
  log.setLogType(PaymentLogEventType.FINISHED);
  log.setTransactionTimestamp(SystemTime.asDate());
  log.setTransactionSuccess(e == null ? Boolean.TRUE : Boolean.FALSE);
  log.setTransactionType(transactionType);
  log.setUserName(paymentContext.getUserName());
  String exceptionMessage;
  if (e != null) {
    exceptionMessage=e.getMessage();
    if (exceptionMessage != null) {
      if (exceptionMessage.length() >= 255) {
        exceptionMessage=exceptionMessage.substring(0,254);
      }
    }
 else {
      exceptionMessage=e.getClass().getName();
    }
  }
 else {
    exceptionMessage=null;
  }
  log.setExceptionMessage(exceptionMessage);
  PaymentInfo info=paymentContext.getPaymentInfo();
  if (info != null) {
    log.setCustomer(info.getOrder().getCustomer());
    log.setPaymentInfoReferenceNumber(info.getReferenceNumber());
    log.setAmountPaid(info.getAmount());
    log.setPaymentInfoId(info.getId());
  }
  paymentInfoService.save(log);
}
