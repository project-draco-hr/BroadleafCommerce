{
  JoinStructure joinStructure=(JoinStructure)persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.JOINSTRUCTURE);
  PersistentEntityCriteria countCriteria=ctoConverter.convert(new CriteriaTransferObjectCountWrapper(cto).wrap(),joinStructure.getJoinStructureEntityClassname());
  Class<?>[] entities=persistenceManager.getDynamicEntityDao().getAllPolymorphicEntitiesFromCeiling(Class.forName(joinStructure.getJoinStructureEntityClassname()));
  boolean isArchivable=false;
  for (  Class<?> entity : entities) {
    if (Status.class.isAssignableFrom(entity)) {
      isArchivable=true;
      break;
    }
  }
  if (isArchivable && !persistencePackage.getPersistencePerspective().getShowArchivedFields()) {
    SimpleFilterCriterionProvider criterionProvider=new SimpleFilterCriterionProvider(SimpleFilterCriterionProvider.FilterDataStrategy.NONE,0){
      public Criterion getCriterion(      String targetPropertyName,      Object[] filterObjectValues,      Object[] directValues){
        return Restrictions.or(Restrictions.eq(targetPropertyName,'N'),Restrictions.isNull(targetPropertyName));
      }
    }
;
    FilterCriterion filterCriterion=new FilterCriterion(AssociationPath.ROOT,"archiveStatus.archived",criterionProvider);
    ((NestedPropertyCriteria)countCriteria).add(filterCriterion);
  }
  return persistenceManager.getDynamicEntityDao().count(countCriteria,Class.forName(joinStructure.getJoinStructureEntityClassname()));
}
