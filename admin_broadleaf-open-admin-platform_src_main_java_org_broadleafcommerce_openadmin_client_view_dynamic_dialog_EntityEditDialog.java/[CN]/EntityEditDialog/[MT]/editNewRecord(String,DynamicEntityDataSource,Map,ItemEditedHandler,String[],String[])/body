{
  pictureStack.setVisible(false);
  saveButton.enable();
  cancelButton.enable();
  initialValues.put(dataSource.getPrimaryKeyFieldName(),"");
  this.handler=handler;
  if (fieldNames != null && fieldNames.length > 0) {
    dataSource.resetVisibilityOnly(fieldNames);
  }
 else {
    dataSource.resetPermanentFieldVisibility();
  }
  if (ignoreFields != null) {
    for (    String fieldName : ignoreFields) {
      dataSource.getField(fieldName).setHidden(true);
    }
  }
  if (title != null) {
    this.setTitle(title);
  }
 else {
    this.setTitle("Add new entity: " + dataSource.getPolymorphicEntities().get(dataSource.getDefaultNewEntityFullyQualifiedClassname()));
  }
  buildFields(dataSource,dynamicForm,null);
  dynamicForm.editNewRecord(initialValues);
  show();
  redraw();
  saveButton.setVisible(true);
  setHeight(20);
  int formHeight=hStack.getScrollHeight() + vLayout.getScrollHeight() + 10;
  if (formHeight > 600) {
    setHeight(600);
  }
 else {
    setHeight(formHeight);
  }
  setWidth(20);
  int formWidth=hStack.getScrollWidth() + 10;
  if (formWidth > 800) {
    setWidth(800);
  }
 else   if (formWidth < 400) {
    setWidth(400);
  }
 else {
    setWidth(formWidth);
  }
  centerInPage();
  isHidden=false;
}
