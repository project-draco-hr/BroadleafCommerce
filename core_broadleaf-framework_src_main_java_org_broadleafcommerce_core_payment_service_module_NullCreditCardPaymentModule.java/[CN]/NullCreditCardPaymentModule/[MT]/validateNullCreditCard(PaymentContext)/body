{
  CreditCardPaymentInfo ccInfo=(CreditCardPaymentInfo)paymentContext.getReferencedPaymentInfo();
  if ((ccInfo == null) || (ccInfo.getPan() == null)) {
    return null;
  }
  String nameOnCard=ccInfo.getNameOnCard();
  String ccNumber=ccInfo.getPan().replaceAll("[\\s-]+","");
  Integer expMonth=ccInfo.getExpirationMonth();
  Integer expYear=ccInfo.getExpirationYear();
  String cvv=ccInfo.getCvvCode();
  String cardType=validateCardType(ccNumber);
  boolean validCard=!cardType.contains("UNKNOWN");
  DateTime expirationDate=new DateTime(expYear,expMonth,1,0,0);
  expirationDate=expirationDate.dayOfMonth().withMaximumValue();
  boolean validDate=expirationDate.isAfterNow();
  boolean validCVV=!"000".equals(cvv);
  if (validDate && validCard && validCVV) {
    Map<String,String> additionalFields=new HashMap<String,String>();
    additionalFields.put(PaymentInfoAdditionalFieldType.NAME_ON_CARD.getType(),nameOnCard);
    additionalFields.put(PaymentInfoAdditionalFieldType.CARD_TYPE.getType(),cardType);
    additionalFields.put(PaymentInfoAdditionalFieldType.EXP_MONTH.getType(),expMonth + "");
    additionalFields.put(PaymentInfoAdditionalFieldType.EXP_YEAR.getType(),expYear + "");
    additionalFields.put(PaymentInfoAdditionalFieldType.LAST_FOUR.getType(),StringUtils.right(ccNumber,4));
    return additionalFields;
  }
 else {
    return null;
  }
}
