{
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("productDS",new OneToOneProductSkuDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource top){
      setupDisplayItems(top);
      ((ListGridDataSource)top).setupGridFields(new String[]{},new Boolean[]{});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("categorySearch",new CategoryListDataSourceFactory(),new OperationTypes(OperationType.ENTITY,OperationType.ENTITY,OperationType.JOINSTRUCTURE,OperationType.ENTITY,OperationType.ENTITY),new Object[]{},new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      ListGridDataSource categorySearchDataSource=(ListGridDataSource)result;
      categorySearchDataSource.resetPermanentFieldVisibility("name","urlKey","activeStartDate","activeEndDate");
      EntitySearchDialog categorySearchView=new EntitySearchDialog(categorySearchDataSource);
      library.put("categorySearchView",categorySearchView);
      getPresenterSequenceSetupManager().getDataSource("productDS").getFormItemCallbackHandlerManager().addSearchFormItemCallback("defaultCategory",categorySearchView,BLCMain.getMessageManager().getString("categorySearchTitle"),getDisplay().getDynamicFormDisplay());
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("oneToOneProductSearchDS",new ProductListDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      final ListGridDataSource productSearchDataSource=(ListGridDataSource)result;
      productSearchDataSource.resetPermanentFieldVisibility("name","description","model","manufacturer","activeStartDate","activeEndDate");
      productSearchView=new EntitySearchDialog(productSearchDataSource);
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("crossSaleProductsDS",new CrossSaleProductListDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      crossSalePresenter=new EditableJoinStructurePresenter(getDisplay().getCrossSaleDisplay(),productSearchView,new String[]{EntityImplementations.PRODUCT},BLCMain.getMessageManager().getString("productSearchTitle"),BLCMain.getMessageManager().getString("setPromotionMessageTitle"),"promotionMessage");
      crossSalePresenter.setDataSource((ListGridDataSource)result,new String[]{"name","promotionMessage"},new Boolean[]{false,true});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("upSaleProductsDS",new UpSaleProductListDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      upSalePresenter=new EditableJoinStructurePresenter(getDisplay().getUpSaleDisplay(),productSearchView,new String[]{EntityImplementations.PRODUCT},BLCMain.getMessageManager().getString("productSearchTitle"),BLCMain.getMessageManager().getString("setPromotionMessageTitle"),"promotionMessage");
      upSalePresenter.setDataSource((ListGridDataSource)result,new String[]{"name","promotionMessage"},new Boolean[]{false,true});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("productMediaMapDS",new DefaultSkuMediaMapDataSourceFactory(this),null,new Object[]{getMediaMapKeys()},new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      Map<String,Object> initialValues=new HashMap<String,Object>(2);
      initialValues.put("name",BLCMain.getMessageManager().getString("mediaNameDefault"));
      initialValues.put("label",BLCMain.getMessageManager().getString("mediaLabelDefault"));
      mediaPresenter=new DefaultSkuMediaMapStructurePresenter(getDisplay().getMediaDisplay(),getMediaEntityView(),BLCMain.getMessageManager().getString("newMediaTitle"),initialValues);
      mediaPresenter.setDataSource((ListGridDataSource)result,new String[]{"key","name","url","label"},new Boolean[]{true,true,true,true});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("productAttributeDS",new ProductAttributeDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      Map<String,Object> initialValues=new HashMap<String,Object>(1);
      initialValues.put("name","Untitled");
      productAttributePresenter=new CreateBasedListStructurePresenter(getDisplay().getAttributesDisplay(),new String[]{EntityImplementations.PRODUCT},BLCMain.getMessageManager().getString("newAttributeTitle"),initialValues);
      productAttributePresenter.setDataSource((ListGridDataSource)result,new String[]{"name","value","searchable"},new Boolean[]{true,true,true});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("parentCategoriesDS",new ParentCategoryListDataSourceFactory(),new OperationTypes(OperationType.JOINSTRUCTURE,OperationType.JOINSTRUCTURE,OperationType.JOINSTRUCTURE,OperationType.JOINSTRUCTURE,OperationType.ENTITY),new Object[]{},new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      parentCategoriesPresenter=new SimpleSearchJoinStructurePresenter(getDisplay().getAllCategoriesDisplay(),(EntitySearchDialog)library.get("categorySearchView"),new String[]{EntityImplementations.PRODUCT},BLCMain.getMessageManager().getString("categorySearchPrompt"));
      parentCategoriesPresenter.setDataSource((ListGridDataSource)result,new String[]{"name","urlKey"},new Boolean[]{false,false});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("productOptionSearchDS",new ProductOptionListDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      EntitySearchDialog productOptionSearchView=new EntitySearchDialog((ListGridDataSource)result,true);
      library.put("productOptionSearchView",productOptionSearchView);
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("productOptionValuesDS",new ProductOptionValueDataSourceFactory(),new NullAsyncCallbackAdapter()));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("productOptionsDS",new ProductOptionDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      productOptionsPresenter=new AssociatedProductOptionPresenter(getDisplay().getProductOptionsDisplay(),(EntitySearchDialog)library.get("productOptionSearchView"),BLCMain.getMessageManager().getString("productOptionSearchPrompt"));
      productOptionsPresenter.setDataSource((ListGridDataSource)result,new String[]{"label","type","required"},new Boolean[]{true,true,true});
      productOptionsPresenter.setExpansionDataSource((ListGridDataSource)getPresenterSequenceSetupManager().getDataSource("productOptionValuesDS"),new String[]{"value","displayOrder"},new Boolean[]{false,false});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("skusDS",new ProductSkusDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      skusPresenter=new SubPresenter(getDisplay().getSkusDisplay());
      skusPresenter.setDataSource((ListGridDataSource)result,new String[]{},new Boolean[]{});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("skuSearchDS",new BundleSkuSearchDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      ListGridDataSource skuSearchDataSource=(ListGridDataSource)result;
      skuSearchDataSource.resetPermanentFieldVisibility("name","retailPrice","salePrice");
      skuSearchView=new EntitySearchDialog(skuSearchDataSource,true);
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("bundleSkusDS",new SkuBundleItemsDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource result){
      bundleItemsPresenter=new EditableJoinStructurePresenter(getDisplay().getBundleItemsDisplay(),skuSearchView,new String[]{EntityImplementations.PRODUCT_BUNDLE},BLCMain.getMessageManager().getString("skuSelect"),BLCMain.getMessageManager().getString("editBundleItem"),new String[]{"quantity","salePrice"});
      bundleItemsPresenter.setDataSource((ListGridDataSource)result,new String[]{"sku.name","quantity"},new Boolean[]{false,true});
    }
  }
));
  getPresenterSequenceSetupManager().addOrReplaceItem(new PresenterSetupItem("staticAssetTreeDS",new StaticAssetsTileGridDataSourceFactory(),new AsyncCallbackAdapter(){
    @Override public void onSetupSuccess(    DataSource dataSource){
      TileGridDataSource staticAssetTreeDS=(TileGridDataSource)dataSource;
      assetSearchDialogView=new AssetSearchDialog(staticAssetTreeDS);
      getPresenterSequenceSetupManager().getDataSource("productMediaMapDS").getFormItemCallbackHandlerManager().addFormItemCallback("url",new FormItemCallback(){
        @Override public void execute(        final FormItem formItem){
          assetSearchDialogView.search("Asset Search",new TileGridItemSelectedHandler(){
            @Override public void onSearchItemSelected(            TileGridItemSelected event){
              String staticAssetFullUrl=BLCMain.assetServerUrlPrefix + event.getRecord().getAttribute("fullUrl");
              formItem.setValue(staticAssetFullUrl);
              getMediaEntityView().updateMedia(staticAssetFullUrl);
            }
          }
);
        }
      }
);
    }
  }
));
}
