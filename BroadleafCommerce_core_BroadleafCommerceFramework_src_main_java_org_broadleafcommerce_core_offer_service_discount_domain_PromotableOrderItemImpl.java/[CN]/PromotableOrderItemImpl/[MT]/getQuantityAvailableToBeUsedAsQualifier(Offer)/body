{
  int qtyAvailable=delegate.getQuantity();
  for (  PromotionDiscount promotionDiscount : promotionDiscounts) {
    if (promotionDiscount.getPromotion().equals(promotion)) {
      qtyAvailable=qtyAvailable - promotionDiscount.getQuantity();
    }
 else {
      OfferItemRestrictionRuleType qualifierType=promotionDiscount.getPromotion().getOfferItemTargetRuleType();
      if (OfferItemRestrictionRuleType.NONE.equals(qualifierType) || OfferItemRestrictionRuleType.TARGET.equals(qualifierType)) {
        qtyAvailable=qtyAvailable - promotionDiscount.getQuantity();
      }
    }
  }
  for (  PromotionQualifier promotionQualifier : promotionQualifiers) {
    if (promotionQualifier.getPromotion().equals(promotion)) {
      qtyAvailable=qtyAvailable - promotionQualifier.getQuantity();
    }
 else {
      OfferItemRestrictionRuleType qualifierType=promotionQualifier.getPromotion().getOfferItemQualifierRuleType();
      if (OfferItemRestrictionRuleType.NONE.equals(qualifierType) || OfferItemRestrictionRuleType.TARGET.equals(qualifierType)) {
        qtyAvailable=qtyAvailable - promotionQualifier.getQuantity();
      }
    }
  }
  return qtyAvailable;
}
