{
  String msg="Attempting to confirm/authorize an UNCONFIRMED transaction on the order was unsuccessful.";
  Order order=context.getSeedData().getOrder();
  List<OrderPayment> invalidatedPayments=new ArrayList<OrderPayment>();
  for (  ResponseTransactionPair responseTransactionPair : failedTransactions) {
    PaymentTransaction tx=orderPaymentService.readTransactionById(responseTransactionPair.getTransactionId());
    if (!invalidatedPayments.contains(tx.getOrderPayment())) {
      paymentGatewayCheckoutService.markPaymentAsInvalid(tx.getOrderPayment().getId());
      invalidatedPayments.add(tx.getOrderPayment());
    }
  }
  if (LOG.isErrorEnabled()) {
    LOG.error(msg);
  }
  if (LOG.isTraceEnabled()) {
    for (    ResponseTransactionPair responseTransactionPair : failedTransactions) {
      LOG.trace(responseTransactionPair.getResponseDTO().getRawResponse());
    }
  }
  throw new CheckoutException(msg,context.getSeedData());
}
