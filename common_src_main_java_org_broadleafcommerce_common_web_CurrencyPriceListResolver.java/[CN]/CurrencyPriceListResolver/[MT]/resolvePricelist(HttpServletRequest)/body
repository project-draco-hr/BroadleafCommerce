{
  PriceList priceList=null;
  HttpSession session=request.getSession(true);
  priceList=(PriceList)request.getAttribute(PRICELIST_VAR);
  if (priceList == null && request.getParameter(PRICELIST_KEY_PARAM) != null) {
    String key=request.getParameter(PRICELIST_KEY_PARAM);
    priceList=priceListService.findPriceListByKey(key);
    if (LOG.isTraceEnabled()) {
      LOG.trace("Attempt to find pricelist by param " + key + " resulted in "+ priceList);
    }
  }
  if (priceList == null) {
    priceList=(PriceList)session.getAttribute(PRICELIST_VAR);
  }
  if (priceList == null) {
    BroadleafCurrency currency=(BroadleafCurrency)session.getAttribute(CURRENCY_VAR);
    if (currency != null) {
      priceList=priceListService.findPriceListByCurrency(currency);
    }
  }
  if (priceList == null) {
    priceList=priceListService.findDefaultPricelist();
  }
  session.setAttribute(PRICELIST_VAR,priceList);
  return priceList;
}
