{
  PersistencePackageRequest ppr=PersistencePackageRequest.fromMetadata(collectionProperty.getMetadata());
  FilterAndSortCriteria fasc;
  FieldMetadata md=collectionProperty.getMetadata();
  if (md instanceof BasicCollectionMetadata) {
    fasc=new FilterAndSortCriteria(ppr.getForeignKeys()[0].getManyToField());
  }
 else   if (md instanceof AdornedTargetCollectionMetadata) {
    fasc=new FilterAndSortCriteria(ppr.getAdornedList().getCollectionFieldName());
  }
 else   if (md instanceof MapMetadata) {
    fasc=new FilterAndSortCriteria(ppr.getForeignKeys()[0].getManyToField());
  }
 else {
    throw new IllegalArgumentException(String.format("The specified field [%s] for class [%s] was not a " + "collection field.",collectionProperty.getName(),containingClassMetadata.getCeilingType()));
  }
  fasc.setFilterValue(containingEntityId);
  ppr.addFilterAndSortCriteria(fasc);
  return fetch(ppr).getRecords();
}
