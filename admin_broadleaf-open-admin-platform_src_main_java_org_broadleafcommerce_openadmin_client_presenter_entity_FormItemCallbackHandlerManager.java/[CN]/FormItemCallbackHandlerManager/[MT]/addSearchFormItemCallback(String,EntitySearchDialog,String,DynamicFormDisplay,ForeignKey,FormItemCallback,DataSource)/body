{
  callbacks.put(fieldName,new FormItemCallback(){
    public void execute(    final FormItem formItem){
      searchView.search(searchDialogTitle,new SearchItemSelectedHandler(){
        public void onSearchItemSelected(        SearchItemSelected event){
          final String myId=((AbstractDynamicDataSource)event.getDataSource()).getPrimaryKeyValue(event.getRecord());
          if (LOG.isLoggable(Level.FINE)) {
            LOG.fine("The id of the ToOneLookup item selected is: " + myId);
          }
          String realFieldName=formItem.getName().substring("__display_".length(),formItem.getName().length());
          final FormItem realFormItem=formItem.getForm().getField(realFieldName);
          String displayFieldName="name";
          if (foreignKey != null) {
            displayFieldName=foreignKey.getDisplayValueProperty();
          }
 else {
            PersistencePerspective persistencePerspective=((DynamicEntityDataSource)dataSource).getPersistencePerspective();
            ForeignKey mainForeignKey=(ForeignKey)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.FOREIGNKEY);
            if (mainForeignKey != null && mainForeignKey.getManyToField().equals(realFieldName)) {
              displayFieldName=mainForeignKey.getDisplayValueProperty();
            }
 else {
              ForeignKey[] additionalKeys=persistencePerspective.getAdditionalForeignKeys();
              if (additionalKeys != null) {
                for (                ForeignKey foreignKey : additionalKeys) {
                  if (foreignKey.getManyToField().equals(realFieldName)) {
                    displayFieldName=foreignKey.getDisplayValueProperty();
                    break;
                  }
                }
              }
            }
          }
          String myName=event.getRecord().getAttribute(displayFieldName);
          formItem.setValue(myName);
          Timer timer=new Timer(){
            public void run(){
              realFormItem.setValue(myId);
              if (LOG.isLoggable(Level.FINE)) {
                LOG.fine("Set field " + realFormItem.getName() + " to value "+ myId);
              }
              if (dynamicFormDisplay != null) {
                dynamicFormDisplay.getSaveButton().enable();
                dynamicFormDisplay.getRefreshButton().enable();
                if (cb != null) {
                  cb.execute(realFormItem);
                }
              }
            }
          }
;
          timer.schedule(100);
        }
      }
);
    }
  }
);
}
