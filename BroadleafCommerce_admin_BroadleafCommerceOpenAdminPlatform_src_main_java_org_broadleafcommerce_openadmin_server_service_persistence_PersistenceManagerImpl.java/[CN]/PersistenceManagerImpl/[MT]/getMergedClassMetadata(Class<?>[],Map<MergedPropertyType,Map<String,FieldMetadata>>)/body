{
  ClassMetadata classMetadata=new ClassMetadata();
  PolymorphicEntity[] polyEntities=new PolymorphicEntity[entities.length];
  int j=0;
  for (  Class<?> type : entities) {
    polyEntities[j]=new PolymorphicEntity();
    polyEntities[j].setType(type.getName());
    polyEntities[j].setName(type.getSimpleName());
    j++;
  }
  classMetadata.setPolymorphicEntities(polyEntities);
  List<Property> propertiesList=new ArrayList<Property>();
  for (  PersistenceModule module : modules) {
    module.extractProperties(mergedProperties,propertiesList);
  }
  for (int i=0; i < entities.length - 1; i++) {
    for (    Property myProperty : propertiesList) {
      if (myProperty.getMetadata().getInheritedFromType().equals(entities[i].getName()) && myProperty.getMetadata().getPresentationAttributes().getOrder() != null) {
        for (        Property property : propertiesList) {
          if (!property.getMetadata().getInheritedFromType().equals(entities[i].getName()) && property.getMetadata().getPresentationAttributes().getOrder() != null && property.getMetadata().getPresentationAttributes().getOrder() >= myProperty.getMetadata().getPresentationAttributes().getOrder()) {
            property.getMetadata().getPresentationAttributes().setOrder(property.getMetadata().getPresentationAttributes().getOrder() + 1);
          }
        }
      }
    }
  }
  Property[] properties=new Property[propertiesList.size()];
  properties=propertiesList.toArray(properties);
  Arrays.sort(properties,new Comparator<Property>(){
    public int compare(    Property o1,    Property o2){
      if (o1.getMetadata().getPresentationAttributes().getOrder() != null && o2.getMetadata().getPresentationAttributes().getOrder() != null) {
        return o1.getMetadata().getPresentationAttributes().getOrder().compareTo(o2.getMetadata().getPresentationAttributes().getOrder());
      }
 else       if (o1.getMetadata().getPresentationAttributes().getOrder() != null && o2.getMetadata().getPresentationAttributes().getOrder() == null) {
        return -1;
      }
 else       if (o1.getMetadata().getPresentationAttributes().getOrder() == null && o2.getMetadata().getPresentationAttributes().getOrder() != null) {
        return 1;
      }
 else       if (o1.getMetadata().getPresentationAttributes().getFriendlyName() != null && o2.getMetadata().getPresentationAttributes().getFriendlyName() != null) {
        return o1.getMetadata().getPresentationAttributes().getFriendlyName().compareTo(o2.getMetadata().getPresentationAttributes().getFriendlyName());
      }
 else {
        return o1.getName().compareTo(o2.getName());
      }
    }
  }
);
  classMetadata.setProperties(properties);
  return classMetadata;
}
