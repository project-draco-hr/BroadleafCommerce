{
  ForeignKey foreignField=(ForeignKey)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.FOREIGNKEY);
  JoinStructure joinStructure=(JoinStructure)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.JOINSTRUCTURE);
  if (foreignField == null && joinStructure == null) {
    throw new RuntimeException("Only datasources that utilize foreignField or joinStructure relationships may utilize this method");
  }
  Criteria criteria=new Criteria();
  String relationshipName;
  if (foreignField != null) {
    relationshipName=foreignField.getManyToField();
  }
 else   if (joinStructure != null) {
    relationshipName=joinStructure.getName();
  }
 else {
    relationshipName="containingEntityId";
  }
  criteria.addCriteria(relationshipName,relationshipValue);
  for (  DataSourceModule dataSourceModule : modules) {
    dataSourceModule.setLinkedValue(relationshipValue);
  }
  return criteria;
}
