{
  if (content.getLockedFlag()) {
    throw new IllegalArgumentException("Unable to update a locked record");
  }
  if (automaticallyApproveAndPromoteStructuredContent) {
    if (destSandbox != null && destSandbox.getSite() != null) {
      destSandbox=destSandbox.getSite().getProductionSandbox();
    }
 else {
      destSandbox=null;
    }
  }
  if (checkForSandboxMatch(content.getSandbox(),destSandbox)) {
    if (content.getDeletedFlag()) {
      SandBoxItem item=sandBoxItemDao.retrieveBySandboxAndTemporaryItemId(content.getSandbox(),SandBoxItemType.STRUCTURED_CONTENT,content.getId());
      if (content.getOriginalItemId() == null && item != null) {
        content.setArchivedFlag(true);
        item.setArchivedFlag(true);
      }
 else       if (item != null) {
        item.setSandBoxOperationType(SandBoxOperationType.DELETE);
        sandBoxItemDao.updateSandBoxItem(item);
      }
 else       if (automaticallyApproveAndPromoteStructuredContent) {
        content.setArchivedFlag(true);
      }
    }
    return structuredContentDao.addOrUpdateContentItem(content);
  }
 else   if (checkForProductionSandbox(content.getSandbox())) {
    StructuredContent clonedContent=content.cloneEntity();
    clonedContent.setOriginalItemId(content.getId());
    clonedContent.setSandbox(destSandbox);
    structuredContentDao.detach(content);
    StructuredContent returnContent=structuredContentDao.addOrUpdateContentItem(clonedContent);
    StructuredContent prod=findStructuredContentById(content.getId());
    prod.setLockedFlag(true);
    prod=structuredContentDao.addOrUpdateContentItem(prod);
    SandBoxOperationType type=SandBoxOperationType.UPDATE;
    if (clonedContent.getDeletedFlag()) {
      type=SandBoxOperationType.DELETE;
    }
    sandBoxItemDao.addSandBoxItem(destSandbox,type,SandBoxItemType.STRUCTURED_CONTENT,returnContent.getContentName(),returnContent.getId(),returnContent.getOriginalItemId());
    return returnContent;
  }
 else {
    throw new IllegalArgumentException("Update called when promote or reject was expected.");
  }
}
