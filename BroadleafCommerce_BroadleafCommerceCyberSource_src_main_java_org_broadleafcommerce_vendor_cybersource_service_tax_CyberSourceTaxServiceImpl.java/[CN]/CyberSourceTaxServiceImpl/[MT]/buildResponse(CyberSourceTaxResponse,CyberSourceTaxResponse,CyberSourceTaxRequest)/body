{
  if (cachedResponse.getCityRate() == null || cachedResponse.getCountyRate() == null || cachedResponse.getDistrictRate() == null || cachedResponse.getTotalRate() == null) {
    throw new TaxException("The cached response [merchant reference code: " + cachedResponse.getMerchantReferenceCode() + "] is missing one or more tax rates. Cannot use the cached response to calculate tax.");
  }
  taxResponse.setDecision("ACCEPT");
  taxResponse.setInvalidField(new String[]{});
  taxResponse.setMerchantReferenceCode(cachedResponse.getMerchantReferenceCode());
  taxResponse.setMissingField(new String[]{});
  taxResponse.setReasonCode(100);
  taxResponse.setRequestToken("from-cache");
  taxResponse.setPostalCode(cachedResponse.getPostalCode());
  CyberSourceTaxItemResponse[] itemResponses=new CyberSourceTaxItemResponse[taxRequest.getItemRequests().size()];
  int counter=0;
  for (  CyberSourceItemRequest itemRequest : taxRequest.getItemRequests()) {
    CyberSourceTaxItemResponse itemResponse=new CyberSourceTaxItemResponse();
    itemResponse.setId(itemRequest.getId());
    itemResponse.setCityTaxAmount(itemRequest.getUnitPrice().multiply(cachedResponse.getCityRate()));
    itemResponse.setCountyTaxAmount(itemRequest.getUnitPrice().multiply(cachedResponse.getCountyRate()));
    itemResponse.setDistrictTaxAmount(itemRequest.getUnitPrice().multiply(cachedResponse.getDistrictRate()));
    itemResponse.setTotalTaxAmount(itemRequest.getUnitPrice().multiply(cachedResponse.getTotalRate()));
    itemResponses[counter]=itemResponse;
    counter++;
  }
  taxResponse.setItemResponses(itemResponses);
}
