{
  EntityForm ef=new EntityForm();
  ef.setEntityType(adornedList.getAdornedTargetEntityClassname());
  PersistencePackageRequest request=PersistencePackageRequest.adorned().withClassName(adornedMd.getCollectionCeilingEntity()).withAdornedList(adornedList);
  ClassMetadata collectionMetadata=adminEntityService.getClassMetadata(request);
  List<Property> entityFormProperties=new ArrayList<Property>();
  for (  String targetFieldName : adornedMd.getMaintainedAdornedTargetFields()) {
    Property p=collectionMetadata.getPMap().get(targetFieldName);
    entityFormProperties.add(p);
  }
  setEntityFormFields(ef,entityFormProperties);
  Field f=new Field().withName(adornedList.getLinkedObjectPath() + "." + adornedList.getLinkedIdProperty()).withFieldType(SupportedFieldType.HIDDEN.toString()).withValue(parentId);
  ef.addField(f,EntityForm.HIDDEN_GROUP);
  f=new Field().withName(adornedList.getTargetObjectPath() + "." + adornedList.getTargetIdProperty()).withFieldType(SupportedFieldType.HIDDEN.toString()).withIdOverride("adornedTargetIdProperty");
  ef.addField(f,EntityForm.HIDDEN_GROUP);
  f=new Field().withName(adornedList.getSortField()).withFieldType(SupportedFieldType.HIDDEN.toString());
  ef.addField(f,EntityForm.HIDDEN_GROUP);
  return ef;
}
