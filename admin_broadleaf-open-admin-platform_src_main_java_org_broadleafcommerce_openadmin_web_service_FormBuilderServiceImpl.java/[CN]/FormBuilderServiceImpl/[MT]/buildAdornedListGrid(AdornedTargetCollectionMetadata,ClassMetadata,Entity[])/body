{
  List<Field> hfs=new ArrayList<Field>();
  for (  String fieldName : fmd.getGridVisibleFields()) {
    Property p=cmd.getPMap().get(fieldName);
    Field hf=new Field();
    hf.setName(p.getName());
    hf.setFriendlyName(p.getMetadata().getFriendlyName());
    hfs.add(hf);
  }
  ListGrid lg=new ListGrid();
  lg.setClassName(cmd.getCeilingType());
  lg.setHeaderFields(hfs);
  for (  Entity e : entities) {
    ListGridRecord record=new ListGridRecord();
    record.setId(e.findProperty("id").getValue());
    for (    Field headerField : hfs) {
      Property p=e.findProperty(headerField.getName());
      Field recordField=new Field();
      recordField.setName(headerField.getName());
      recordField.setValue(p.getValue());
      record.getFields().add(recordField);
    }
    lg.getRecords().add(record);
  }
  return lg;
}
