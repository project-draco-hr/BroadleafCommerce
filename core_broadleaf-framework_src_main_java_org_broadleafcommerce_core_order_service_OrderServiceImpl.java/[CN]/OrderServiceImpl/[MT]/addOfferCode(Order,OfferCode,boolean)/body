{
  if (!order.getAddedOfferCodes().contains(offerCode)) {
    if (!offerService.verifyMaxCustomerUsageThreshold(order.getCustomer(),offerCode.getOffer())) {
      throw new OfferMaxUseExceededException("The customer has used this offer code more than the maximum allowed number of times.");
    }
    order.getAddedOfferCodes().add(offerCode);
    order=updateOrder(order,priceOrder);
  }
  return order;
}
