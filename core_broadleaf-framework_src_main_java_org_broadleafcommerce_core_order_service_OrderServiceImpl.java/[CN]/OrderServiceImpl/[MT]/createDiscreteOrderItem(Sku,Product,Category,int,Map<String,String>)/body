{
  DiscreteOrderItem item=(DiscreteOrderItem)orderItemDao.create(OrderItemType.DISCRETE);
  item.setSku(sku);
  item.setProduct(product);
  item.setQuantity(quantity);
  item.setCategory(category);
  item.setBaseSalePrice(sku.getSalePrice());
  item.setBaseRetailPrice(sku.getRetailPrice());
  if (itemAttributes != null && itemAttributes.size() > 0) {
    Map<String,OrderItemAttribute> orderItemAttributes=new HashMap<String,OrderItemAttribute>();
    item.setOrderItemAttributes(orderItemAttributes);
    for (    String key : itemAttributes.keySet()) {
      String value=itemAttributes.get(key);
      OrderItemAttribute attribute=new OrderItemAttributeImpl();
      attribute.setName(key);
      attribute.setValue(value);
      attribute.setOrderItem(item);
      orderItemAttributes.put(key,attribute);
    }
  }
  item.updatePrices();
  item.assignFinalPrice();
  return item;
}
