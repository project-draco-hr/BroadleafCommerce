{
  FieldMetadata fieldMetadata=new FieldMetadata();
  fieldMetadata.setFieldType(type);
  fieldMetadata.setSecondaryType(secondaryType);
  if (entityType != null && !entityType.isCollectionType()) {
    Column column=null;
    for (    Property property : componentProperties) {
      if (property.getName().equals(propertyName)) {
        column=(Column)property.getColumnIterator().next();
        break;
      }
    }
    if (column != null) {
      fieldMetadata.setLength(column.getLength());
      fieldMetadata.setScale(column.getScale());
      fieldMetadata.setPrecision(column.getPrecision());
      fieldMetadata.setRequired(!column.isNullable());
      fieldMetadata.setUnique(column.isUnique());
    }
    fieldMetadata.setForeignKeyCollection(false);
  }
 else {
    fieldMetadata.setForeignKeyCollection(true);
  }
  fieldMetadata.setMutable(true);
  fieldMetadata.setInheritedFromType(targetClass.getName());
  fieldMetadata.setAvailableToTypes(new String[]{targetClass.getName()});
  if (presentationAttribute != null) {
    fieldMetadata.setPresentationAttributes(presentationAttribute);
  }
  fieldMetadata.setMergedPropertyType(mergedPropertyType);
  if (SupportedFieldType.BROADLEAF_ENUMERATION.equals(type)) {
    setupBroadleafEnumeration(presentationAttribute.getBroadleafEnumeration(),fieldMetadata);
  }
  return fieldMetadata;
}
