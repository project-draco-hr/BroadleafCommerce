{
  final CollectionMetadata fieldMetadata=(CollectionMetadata)presentationAttributes.get(propertyName);
  setExcludedBasedOnShowIfProperty(fieldMetadata);
  fieldMetadata.setInheritedFromType(targetClass.getName());
  fieldMetadata.setAvailableToTypes(new String[]{targetClass.getName()});
  fields.put(propertyName,fieldMetadata);
  fieldMetadata.accept(new MetadataVisitorAdapter(){
    @Override public void visit(    AdornedTargetCollectionMetadata metadata){
      if (StringUtils.isEmpty(fieldMetadata.getCollectionCeilingEntity())) {
        fieldMetadata.setCollectionCeilingEntity(type.getReturnedClass().getName());
        AdornedTargetList targetList=((AdornedTargetList)metadata.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST));
        targetList.setAdornedTargetEntityClassname(metadata.getCollectionCeilingEntity());
      }
    }
    @Override public void visit(    BasicCollectionMetadata metadata){
    }
    @Override public void visit(    MapMetadata metadata){
    }
  }
);
}
