{
  if (sections.size() > 1) {
    int j=0;
    List<FormItem> allItems=new ArrayList<FormItem>();
    String[] groups=new String[sectionNames.size()];
    groups=sectionNames.keySet().toArray(groups);
    Arrays.sort(groups,new Comparator<String>(){
      public int compare(      String o1,      String o2){
        if (o1.equals(o2)) {
          return 0;
        }
 else         if (o1.equals("General")) {
          return 1;
        }
 else         if (o2.equals("General")) {
          return -1;
        }
 else {
          Integer groupOrder1=sectionNames.get(o1);
          Integer groupOrder2=sectionNames.get(o2);
          if (groupOrder1 == null && groupOrder2 == null) {
            return 0;
          }
          if (groupOrder1 == null) {
            return -1;
          }
          if (groupOrder2 == null) {
            return 1;
          }
          return groupOrder1.compareTo(groupOrder2);
        }
      }
    }
);
    for (    String group : groups) {
      SectionItem section=new SectionItem();
      section.setDefaultValue(group);
      section.setSectionExpanded(true);
      List<FormItem> formItems=sections.get(group);
      String[] ids=new String[formItems.size()];
      int x=0;
      for (      FormItem formItem : formItems) {
        ids[x]=formItem.getName();
        x++;
      }
      section.setItemIds(ids);
      allItems.add(section);
      allItems.addAll(formItems);
      j++;
    }
    FormItem[] allFormItems=new FormItem[allItems.size()];
    allFormItems=allItems.toArray(allFormItems);
    form.setItems(allFormItems);
  }
 else {
    List<FormItem> formItems=sections.values().iterator().next();
    FormItem[] allFormItems=new FormItem[formItems.size()];
    allFormItems=formItems.toArray(allFormItems);
    form.setItems(allFormItems);
  }
}
