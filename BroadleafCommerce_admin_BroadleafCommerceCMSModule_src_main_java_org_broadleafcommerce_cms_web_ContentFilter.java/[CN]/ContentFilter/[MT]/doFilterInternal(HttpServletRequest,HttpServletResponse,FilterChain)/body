{
  if (shouldExcludeURL(request)) {
    filterChain.doFilter(request,response);
    return;
  }
  if (logger.isDebugEnabled()) {
    logger.debug("CONTENT FILTER BEGIN " + request.getPathInfo());
  }
  if (request.getAttribute(REQUEST_DTO) == null) {
    request.setAttribute(REQUEST_DTO,new RequestDTOImpl(request));
  }
  Site site=determineSite(request);
  Locale locale=determineLocale(request,site);
  SandBox currentSandbox=determineSandbox(request,site);
  try {
    if (!checkForContentManagedPage(currentSandbox,locale,request,response)) {
      filterChain.doFilter(request,response);
    }
  }
  finally {
    SystemTime.resetLocalTimeSource();
  }
}
