{
  for (  PaymentInfo info : payments.keySet()) {
    if (info.getReferenceNumber() == null) {
      throw new CheckoutException("PaymentInfo reference number cannot be null");
    }
  }
  for (  Referenced referenced : payments.values()) {
    if (referenced.getReferenceNumber() == null) {
      throw new CheckoutException("Referenced reference number cannot be null");
    }
  }
  try {
    CheckoutSeed seed=new CheckoutSeed(order,payments);
    checkoutWorkflow.doActivities(seed);
  }
 catch (  WorkflowException e) {
    throw new CheckoutException("Unable to checkout order -- id: " + order.getId(),e);
  }
}
