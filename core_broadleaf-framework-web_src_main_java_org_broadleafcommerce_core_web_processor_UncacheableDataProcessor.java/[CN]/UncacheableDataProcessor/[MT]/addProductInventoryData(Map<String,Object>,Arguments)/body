{
  List<Long> outOfStockProducts=new ArrayList<Long>();
  Set<Product> products=(Set<Product>)((Map<String,Object>)arguments.getExpressionEvaluationRoot()).get("blcAllDisplayedProducts");
  if (products != null) {
    for (    Product product : products) {
      if (product.getDefaultSku() != null) {
        Boolean qtyAvailable=inventoryService.isAvailable(product.getDefaultSku(),1);
        if (qtyAvailable != null && !qtyAvailable) {
          outOfStockProducts.add(product.getId());
        }
      }
    }
  }
  attrMap.put("outOfStockProducts",outOfStockProducts);
}
