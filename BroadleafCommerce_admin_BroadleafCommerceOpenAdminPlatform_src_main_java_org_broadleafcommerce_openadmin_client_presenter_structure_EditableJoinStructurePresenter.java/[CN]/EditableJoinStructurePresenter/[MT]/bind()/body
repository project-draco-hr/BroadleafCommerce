{
  display.getAddButton().addClickHandler(new ClickHandler(){
    public void onClick(    ClickEvent event){
      if (event.isLeftButtonDown()) {
        searchDialog.search(searchDialogTitle,new SearchItemSelectedHandler(){
          @SuppressWarnings({"rawtypes","unchecked"}) public void onSearchItemSelected(          SearchItemSelected event){
            Map initialValues=((DynamicEntityDataSource)display.getGrid().getDataSource()).extractRecordValues((TreeNode)event.getRecord());
            initialValues.put("backup_id",((DynamicEntityDataSource)display.getGrid().getDataSource()).getPrimaryKeyValue(event.getRecord()));
            BLCMain.ENTITY_ADD.editNewRecord(joinStructureEditTitle,(DynamicEntityDataSource)display.getGrid().getDataSource(),initialValues,null,joinStructureFields,null);
          }
        }
);
      }
    }
  }
);
  display.getGrid().addEditCompleteHandler(new EditCompleteHandler(){
    public void onEditComplete(    EditCompleteEvent event){
      display.getGrid().deselectAllRecords();
      setStartState();
    }
  }
);
  display.getGrid().addRecordDropHandler(new RecordDropHandler(){
    public void onRecordDrop(    RecordDropEvent event){
      ListGridRecord record=event.getDropRecords()[0];
      int originalIndex=((ListGrid)event.getSource()).getRecordIndex(record);
      int newIndex=event.getIndex();
      if (newIndex > originalIndex) {
        newIndex--;
      }
      JoinStructure joinStructure=(JoinStructure)((DynamicEntityDataSource)display.getGrid().getDataSource()).getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.JOINSTRUCTURE);
      record.setAttribute(joinStructure.getSortField(),newIndex);
      display.getGrid().updateData(record);
    }
  }
);
  display.getGrid().addSelectionChangedHandler(new SelectionChangedHandler(){
    public void onSelectionChanged(    SelectionEvent event){
      if (event.getState()) {
        display.getRemoveButton().enable();
      }
 else {
        display.getRemoveButton().disable();
      }
    }
  }
);
  display.getRemoveButton().addClickHandler(new ClickHandler(){
    public void onClick(    ClickEvent event){
      if (event.isLeftButtonDown()) {
        display.getGrid().removeData(display.getGrid().getSelectedRecord(),new DSCallback(){
          public void execute(          DSResponse response,          Object rawData,          DSRequest request){
            display.getRemoveButton().disable();
          }
        }
);
      }
    }
  }
);
}
