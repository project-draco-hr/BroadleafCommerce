{
  StringBuffer identifier=new StringBuffer();
  if (orderItem.getSplitParentItemId() != null || cartService.getAutomaticallyMergeLikeItems()) {
    if (!cartService.getAutomaticallyMergeLikeItems()) {
      identifier.append(orderItem.getSplitParentItemId());
    }
 else {
      if (orderItem instanceof BundleOrderItem) {
        BundleOrderItem bundleOrderItem=(BundleOrderItem)orderItem;
        if (bundleOrderItem.getSku() != null) {
          identifier.append(bundleOrderItem.getSku().getId());
        }
 else {
          if (orderItem.getSplitParentItemId() != null) {
            identifier.append(orderItem.getSplitParentItemId());
          }
 else {
            identifier.append(orderItem.getId());
          }
        }
      }
 else       if (orderItem instanceof DiscreteOrderItem) {
        DiscreteOrderItem discreteOrderItem=(DiscreteOrderItem)orderItem;
        identifier.append(discreteOrderItem.getSku().getId());
      }
 else {
        if (orderItem.getSplitParentItemId() != null) {
          identifier.append(orderItem.getSplitParentItemId());
        }
 else {
          identifier.append(orderItem.getId());
        }
      }
    }
    identifier.append('_').append(orderItem.getPrice().stringValue());
    if (extraIdentifier != null) {
      identifier.append('_').append(extraIdentifier);
    }
    addOptionAttributesToIdentifier(identifier,orderItem);
  }
 else {
    identifier.append(orderItem.getId());
  }
  return identifier.toString();
}
