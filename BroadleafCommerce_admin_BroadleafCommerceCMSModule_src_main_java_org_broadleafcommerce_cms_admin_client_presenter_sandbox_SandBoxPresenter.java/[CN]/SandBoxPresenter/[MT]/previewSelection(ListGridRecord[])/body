{
  String prefix=((HtmlEditingModule)BLCMain.getModule(BLCMain.currentModuleKey)).getPreviewUrlPrefix();
  UrlBuilder urlBuilder=new UrlBuilder();
  if (prefix.startsWith("/")) {
    urlBuilder.setHost(com.google.gwt.user.client.Window.Location.getHost());
    urlBuilder.setPort(Integer.valueOf(com.google.gwt.user.client.Window.Location.getPort()));
    urlBuilder.setProtocol(com.google.gwt.user.client.Window.Location.getProtocol());
  }
  urlBuilder.setPath(prefix);
  urlBuilder.setParameter("blSandboxId",org.broadleafcommerce.openadmin.client.security.SecurityManager.USER.getCurrentSandBoxId());
  if (records == null || (records != null && records.length > 1)) {
    com.google.gwt.user.client.Window.open(urlBuilder.buildString(),"cmsPreview",null);
  }
 else {
    String specificSandboxId=records[0].getAttribute("sandBox.id");
    String type=records[0].getAttribute("sandBoxItemType");
    urlBuilder.setParameter("blSandboxId",specificSandboxId);
    if (type.equals("PAGE")) {
      String newPath=prefix + records[0].getAttribute("description");
      urlBuilder.setPath(newPath);
    }
    com.google.gwt.user.client.Window.open(urlBuilder.buildString(),"cmsPreview",null);
  }
}
