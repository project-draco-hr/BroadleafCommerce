{
  initializeProviders();
  Type lookupType=getLookupType(type,genericType);
  if (getApiWrapper(type,lookupType) != null) {
    genericType=getApiWrapper(type,lookupType);
  }
  if (mediaType.isCompatible(MediaType.APPLICATION_JSON_TYPE)) {
    if (Collection.class.isAssignableFrom(type)) {
      jsonListProvider.writeTo(t,type,genericType,annotations,mediaType,httpHeaders,entityStream);
    }
 else {
      jsonRootElementProvider.writeTo(t,type,genericType,annotations,mediaType,httpHeaders,entityStream);
    }
  }
 else   if (mediaType.isCompatible(MediaType.APPLICATION_XML_TYPE) || mediaType.isCompatible(MediaType.TEXT_XML_TYPE)) {
    if (Collection.class.isAssignableFrom(type)) {
      xmlListProvider.writeTo(t,type,genericType,annotations,mediaType,httpHeaders,entityStream);
    }
 else {
      xmlRootElementProvider.writeTo(t,type,genericType,annotations,mediaType,httpHeaders,entityStream);
    }
  }
}
