{
  super.postProcessPersistenceUnitInfo(newPU);
  ConfigurationOnlyState state=ConfigurationOnlyState.getState();
  String persistenceUnitName=newPU.getPersistenceUnitName();
  MutablePersistenceUnitInfo temp;
  PersistenceUnitInfo pui=getMergedUnit(persistenceUnitName,newPU);
  if (pui != null && Proxy.isProxyClass(pui.getClass())) {
    Jpa2PersistenceUnitInfoDecorator dec=(Jpa2PersistenceUnitInfoDecorator)Proxy.getInvocationHandler(pui);
    temp=(MutablePersistenceUnitInfo)dec.getTarget();
  }
 else {
    temp=(MutablePersistenceUnitInfo)pui;
  }
  List<String> managedClassNames=newPU.getManagedClassNames();
  for (  String managedClassName : managedClassNames) {
    if (!temp.getManagedClassNames().contains(managedClassName)) {
      temp.addManagedClassName(managedClassName);
    }
  }
  List<String> mappingFileNames=newPU.getMappingFileNames();
  for (  String mappingFileName : mappingFileNames) {
    if (!temp.getMappingFileNames().contains(mappingFileName)) {
      temp.addMappingFileName(mappingFileName);
    }
  }
  temp.setExcludeUnlistedClasses(newPU.excludeUnlistedClasses());
  for (  URL url : newPU.getJarFileUrls()) {
    if (!temp.getJarFileUrls().contains(url) && !temp.getPersistenceUnitRootUrl().equals(url)) {
      temp.addJarFileUrl(url);
    }
  }
  if (temp.getProperties() == null) {
    temp.setProperties(newPU.getProperties());
  }
 else {
    Properties props=newPU.getProperties();
    if (props != null) {
      for (      Object key : props.keySet()) {
        temp.getProperties().put(key,props.get(key));
        for (        BroadleafClassTransformer transformer : classTransformers) {
          try {
            transformer.compileJPAProperties(props,key);
          }
 catch (          Exception e) {
            throw new RuntimeException(e);
          }
        }
      }
    }
  }
  if (state == null || !state.isConfigurationOnly()) {
    if (newPU.getJtaDataSource() != null) {
      temp.setJtaDataSource(newPU.getJtaDataSource());
    }
    if (newPU.getNonJtaDataSource() != null) {
      temp.setNonJtaDataSource(newPU.getNonJtaDataSource());
    }
  }
 else {
    temp.getProperties().setProperty("hibernate.hbm2ddl.auto","none");
    temp.getProperties().setProperty("hibernate.temp.use_jdbc_metadata_defaults","false");
  }
  temp.setTransactionType(newPU.getTransactionType());
  if (newPU.getPersistenceProviderClassName() != null) {
    temp.setPersistenceProviderClassName(newPU.getPersistenceProviderClassName());
  }
  if (newPU.getPersistenceProviderPackageName() != null) {
    temp.setPersistenceProviderPackageName(newPU.getPersistenceProviderPackageName());
  }
}
