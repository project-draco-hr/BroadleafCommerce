{
  Money calculatedSubTotal=new Money();
  for (  OrderItem orderItem : orderItems) {
    Money price;
    if (includeNonTaxableItems) {
      price=orderItem.getPrice();
    }
 else {
      price=orderItem.getTaxablePrice();
    }
    if (orderItem instanceof BundleOrderItem) {
      calculatedSubTotal=calculatedSubTotal.add(price);
    }
 else {
      calculatedSubTotal=calculatedSubTotal.add(price.multiply(orderItem.getQuantity()));
    }
  }
  return calculatedSubTotal;
}
