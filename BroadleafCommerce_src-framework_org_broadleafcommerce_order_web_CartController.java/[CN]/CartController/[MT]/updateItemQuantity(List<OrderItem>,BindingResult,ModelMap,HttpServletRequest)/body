{
  Order currentCartOrder=retrieveOrder(request);
  List<OrderItem> currentOrderItems=currentCartOrder.getOrderItems();
  for (  OrderItem updatedOrderItem : updatedOrderItemList) {
    OrderItem currentOrderItem=(OrderItem)CollectionUtils.find(currentOrderItems,new BeanPropertyValueEqualsPredicate("id",updatedOrderItem.getId()));
    if (currentOrderItem != null) {
      try {
        if (updatedOrderItem.getQuantity() >= 0) {
          currentOrderItem.setQuantity(updatedOrderItem.getQuantity());
          cartService.updateItemInOrder(currentCartOrder,currentOrderItem);
        }
 else {
          cartService.removeItemFromOrder(currentCartOrder,currentOrderItem);
        }
      }
 catch (      Exception e) {
        logger.error("An error occurred while updating the quantity of an item.",e);
        model.addAttribute("error","quantity");
        return "error";
      }
    }
  }
  return "success";
}
