{
  ModelAndView model=new ModelAndView();
  Product product=(Product)request.getAttribute(ProductHandlerMapping.CURRENT_PRODUCT_ATTRIBUTE_NAME);
  assert(product != null);
  model.addObject(MODEL_ATTRIBUTE_NAME,product);
  Set<Product> allProductsSet=new HashSet<Product>();
  allProductsSet.add(product);
  model.addObject(ALL_PRODUCTS_ATTRIBUTE_NAME,new HashSet<Product>(allProductsSet));
  addDeepLink(model,deepLinkService,product);
  ExtensionResultHolder<String> erh=new ExtensionResultHolder<String>();
  templateOverrideManager.getProxy().getOverrideTemplate(erh,product);
  if (StringUtils.isNotBlank(erh.getResult())) {
    model.setViewName(erh.getResult());
  }
 else   if (StringUtils.isNotEmpty(product.getDisplayTemplate())) {
    model.setViewName(product.getDisplayTemplate());
  }
 else {
    model.setViewName(getDefaultProductView());
  }
  return model;
}
