{
  if (!enabled) {
    return bytes;
  }
  String type=null;
  if (filename.endsWith(".js")) {
    type="js";
  }
 else   if (filename.endsWith(".css")) {
    type="css";
  }
  if (!"js".equals(type) && !"css".equals(type)) {
    throw new IllegalArgumentException("Can only minify js or css resources");
  }
  byte[] minifiedBytes;
  BufferedReader in=null;
  BufferedWriter out=null;
  try {
    ByteArrayInputStream bais=new ByteArrayInputStream(bytes);
    InputStreamReader isr=new InputStreamReader(bais,"utf-8");
    in=new BufferedReader(isr);
    ByteArrayOutputStream baos=new ByteArrayOutputStream();
    OutputStreamWriter osw=new OutputStreamWriter(baos,"utf-8");
    out=new BufferedWriter(osw);
    if ("js".equals(type)) {
      JavaScriptCompressor jsc=new JavaScriptCompressor(in,getLogBasedErrorReporter());
      jsc.compress(out,linebreak,munge,verbose,preserveAllSemiColons,disableOptimizations);
    }
 else     if ("css".equals(type)) {
      CssCompressor cssc=new CssCompressor(in);
      cssc.compress(out,100);
    }
    out.flush();
    minifiedBytes=baos.toByteArray();
  }
 catch (  Exception e) {
    LOG.warn("Could not minify resources, returned unminified bytes",e);
    return bytes;
  }
 finally {
    try {
      if (in != null) {
        in.close();
      }
      if (out != null) {
        out.close();
      }
    }
 catch (    IOException e2) {
      throw new RuntimeException(e2);
    }
  }
  return minifiedBytes;
}
