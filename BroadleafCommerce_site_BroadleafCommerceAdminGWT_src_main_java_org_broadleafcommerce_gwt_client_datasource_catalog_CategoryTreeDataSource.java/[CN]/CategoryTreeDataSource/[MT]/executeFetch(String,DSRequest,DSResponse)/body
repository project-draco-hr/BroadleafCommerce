{
  persistencePerspective.getOperationTypes().setMiscType(OperationType.ENTITY);
  CriteriaTransferObject criteriaTransferObject=getCto(request);
  String parentCategoryId=criteriaTransferObject.get(CategoryTreeDataSourceFactory.foreignKeyName).getFilterValues()[0];
  boolean hasChildren=true;
  if (parentCategoryId != null) {
    TreeNode parentNode=((TreeGrid)associatedGrid).getTree().findById(parentCategoryId);
    if (parentNode != null) {
      hasChildren=Boolean.parseBoolean(parentNode.getAttribute(CategoryTreeDataSourceFactory.hasChildrenProperty));
    }
  }
  if (hasChildren && parentCategoryId != null) {
    super.executeFetch(requestId,request,response);
  }
 else   if (parentCategoryId == null) {
    TreeNode node=new TreeNode();
    node.setAttribute("id",getRootId());
    node.setAttribute("name",getRootName());
    node.setAttribute(CategoryTreeDataSourceFactory.hasChildrenProperty,String.valueOf(hasChildren));
    TreeNode[] recordList=new TreeNode[]{node};
    response.setData(recordList);
    response.setTotalRows(0);
    processResponse(requestId,response);
  }
 else {
    TreeNode[] recordList=new TreeNode[]{};
    response.setData(recordList);
    response.setTotalRows(0);
    processResponse(requestId,response);
  }
}
