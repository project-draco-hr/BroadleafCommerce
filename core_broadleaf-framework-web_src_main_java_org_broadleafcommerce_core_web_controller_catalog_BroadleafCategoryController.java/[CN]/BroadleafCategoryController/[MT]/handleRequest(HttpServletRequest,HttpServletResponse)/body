{
  ModelAndView model=new ModelAndView();
  Category category=(Category)request.getAttribute(CategoryHandlerMapping.CURRENT_CATEGORY_ATTRIBUTE_NAME);
  assert(category != null);
  model.addObject(CATEGORY_ATTRIBUTE_NAME,category);
  ProductSearchResult result=productSearchService.findProductsByCategory(category,null);
  model.addObject(PRODUCTS_ATTRIBUTE_NAME,result.getProducts());
  if (StringUtils.isNotEmpty(category.getDisplayTemplate())) {
    model.setViewName(category.getDisplayTemplate());
  }
 else {
    model.setViewName(getDefaultCategoryView());
  }
  return model;
}
