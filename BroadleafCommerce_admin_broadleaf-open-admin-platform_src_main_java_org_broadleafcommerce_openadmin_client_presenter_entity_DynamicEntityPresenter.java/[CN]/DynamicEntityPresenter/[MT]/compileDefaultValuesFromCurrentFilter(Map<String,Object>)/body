{
  Criteria currentCriteria=display.getListDisplay().getGrid().getFilterEditorCriteria();
  if (currentCriteria != null) {
    Map<String,Object> valueMap=currentCriteria.getValues();
    for (    Map.Entry<String,Object> entry : valueMap.entrySet()) {
      String fieldName=entry.getKey();
      if (fieldName.endsWith("_Grid")) {
        fieldName=fieldName.substring(0,fieldName.lastIndexOf("_Grid"));
      }
      FormItem displayField=display.getDynamicFormDisplay().getFormOnlyDisplay().getForm().getField("__display_" + fieldName);
      if (displayField != null) {
        DataSourceField field=display.getListDisplay().getGrid().getDataSource().getField(entry.getKey());
        Map valueMap2=field.getValueMap();
        if (valueMap2 != null) {
          initialValues.put(displayField.getName(),valueMap2.get(entry.getValue()));
        }
      }
      initialValues.put(fieldName,entry.getValue());
    }
  }
}
