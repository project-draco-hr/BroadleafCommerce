{
  orderOfferProcessor.clearOffersandAdjustments(order);
  List<Offer> filteredOffers=orderOfferProcessor.filterOffers(offers,order.getCustomer());
  if ((filteredOffers == null) || (filteredOffers.isEmpty())) {
    orderOfferProcessor.calculateOrderTotal(order);
  }
 else {
    List<CandidateOrderOffer> qualifiedOrderOffers=new ArrayList<CandidateOrderOffer>();
    List<CandidateItemOffer> qualifiedItemOffers=new ArrayList<CandidateItemOffer>();
    List<OrderItem> discreteOrderItems=itemOfferProcessor.filterOffers(order,filteredOffers,qualifiedOrderOffers,qualifiedItemOffers);
    if ((qualifiedItemOffers.isEmpty()) && (qualifiedOrderOffers.isEmpty())) {
      orderOfferProcessor.calculateOrderTotal(order);
    }
 else {
      itemOfferProcessor.applyAndCompareOrderAndItemOffers(order,qualifiedOrderOffers,qualifiedItemOffers,discreteOrderItems);
    }
  }
}
