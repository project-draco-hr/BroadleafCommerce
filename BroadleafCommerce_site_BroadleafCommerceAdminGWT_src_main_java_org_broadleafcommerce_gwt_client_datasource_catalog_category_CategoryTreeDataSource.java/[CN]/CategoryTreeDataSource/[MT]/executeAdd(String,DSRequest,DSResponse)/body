{
  Main.NON_MODAL_PROGRESS.startProgress();
  setLinkedValue(getAssociatedGrid().getSelectedRecord().getAttribute("id"));
  JavaScriptObject data=request.getData();
  final TreeNode newRecord=new TreeNode(data);
  persistencePerspective.getOperationTypes().setAddType(OperationType.ENTITY);
  Entity entity=getCompatibleModule(OperationType.ENTITY).buildEntity(newRecord);
  service.add(ceilingEntityFullyQualifiedClassname,entity,persistencePerspective,null,new EntityServiceAsyncCallback<Entity>(EntityOperationType.ADD,requestId,request,response,this){
    public void onSuccess(    Entity result){
      super.onSuccess(result);
      TreeNode record=(TreeNode)getCompatibleModule(OperationType.ENTITY).buildRecord(result,true);
      TreeNode[] recordList=new TreeNode[]{record};
      response.setData(recordList);
      persistencePerspective.getOperationTypes().setAddType(OperationType.JOINSTRUCTURE);
      Entity entity=getCompatibleModule(OperationType.JOINSTRUCTURE).buildEntity(record);
      service.add(ceilingEntityFullyQualifiedClassname,entity,persistencePerspective,null,new EntityServiceAsyncCallback<Entity>(EntityOperationType.ADD,"temp" + requestId,request,response,CategoryTreeDataSource.this){
        public void onSuccess(        Entity result){
          super.onSuccess(result);
          processResponse(requestId,response);
        }
      }
);
    }
  }
);
}
