{
  if (getOffer() != null && getOrder() != null) {
    if (getOrder().getSubTotal() != null) {
      Money priceToUse=getOrder().getSubTotal();
      Money discountAmount=new Money(0);
      if (getOffer().getDiscountType().equals(OfferDiscountType.AMOUNT_OFF)) {
        discountAmount=new Money(getOffer().getValue());
      }
 else       if (getOffer().getDiscountType().equals(OfferDiscountType.FIX_PRICE)) {
        discountAmount=priceToUse.subtract(new Money(getOffer().getValue()));
      }
 else       if (getOffer().getDiscountType().equals(OfferDiscountType.PERCENT_OFF)) {
        discountAmount=priceToUse.multiply(getOffer().getValue().divide(new BigDecimal("100")));
      }
      if (discountAmount.greaterThan(priceToUse)) {
        discountAmount=priceToUse;
      }
      priceToUse=priceToUse.subtract(discountAmount);
      setDiscountedPrice(priceToUse);
    }
  }
}
