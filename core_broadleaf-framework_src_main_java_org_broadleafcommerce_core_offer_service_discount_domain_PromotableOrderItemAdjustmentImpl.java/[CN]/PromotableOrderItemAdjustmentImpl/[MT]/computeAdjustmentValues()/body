{
  if (delegate.getOffer() != null && orderItem != null) {
    Money retailAdjustmentPrice=orderItem.getRetailAdjustmentPrice();
    Money salesAdjustmentPrice=orderItem.getSaleAdjustmentPrice();
    if (retailAdjustmentPrice == null) {
      retailAdjustmentPrice=orderItem.getRetailPrice();
    }
    if (delegate.getOrderItem().getIsOnSale() && salesAdjustmentPrice == null) {
      salesAdjustmentPrice=orderItem.getSalePrice();
    }
    if (delegate.getOffer().getDiscountType().equals(OfferDiscountType.AMOUNT_OFF)) {
      Money amountOff=new Money(delegate.getOffer().getValue(),retailAdjustmentPrice.getCurrency(),5);
      if (delegate.getOffer().getApplyDiscountToSalePrice() && delegate.getOrderItem().getIsOnSale()) {
        if (amountOff.lessThan(salesAdjustmentPrice)) {
          delegate.setSalesPriceValue(amountOff);
        }
 else {
          delegate.setSalesPriceValue(salesAdjustmentPrice);
        }
      }
 else {
        delegate.setSalesPriceValue(Money.ZERO);
      }
      if (amountOff.lessThan(retailAdjustmentPrice)) {
        delegate.setRetailPriceValue(amountOff);
      }
 else {
        delegate.setRetailPriceValue(retailAdjustmentPrice);
      }
    }
    if (delegate.getOffer().getDiscountType().equals(OfferDiscountType.FIX_PRICE)) {
      Money fixPriceAmount=new Money(delegate.getOffer().getValue(),retailAdjustmentPrice.getCurrency(),5);
      if (fixPriceAmount.lessThan(retailAdjustmentPrice)) {
        BigDecimal offerValue=retailAdjustmentPrice.getAmount().subtract(fixPriceAmount.getAmount());
        delegate.setRetailPriceValue(new Money(offerValue,retailAdjustmentPrice.getCurrency(),5));
      }
 else {
        delegate.setRetailPriceValue(Money.ZERO);
      }
      if (delegate.getOffer().getApplyDiscountToSalePrice() && delegate.getOrderItem().getIsOnSale()) {
        if (fixPriceAmount.lessThan(salesAdjustmentPrice)) {
          delegate.setSalesPriceValue(fixPriceAmount);
        }
 else {
          delegate.setSalesPriceValue(Money.ZERO);
        }
      }
    }
    if (delegate.getOffer().getDiscountType().equals(OfferDiscountType.PERCENT_OFF)) {
      if (delegate.getOffer().getApplyDiscountToSalePrice() && delegate.getOrderItem().getIsOnSale()) {
        BigDecimal offerValue=salesAdjustmentPrice.getAmount().multiply(delegate.getOffer().getValue().divide(new BigDecimal("100"),5,RoundingMode.HALF_EVEN));
        delegate.setSalesPriceValue(new Money(offerValue,salesAdjustmentPrice.getCurrency(),5));
      }
 else {
        delegate.setSalesPriceValue(Money.ZERO);
      }
      BigDecimal offerValue=retailAdjustmentPrice.getAmount().multiply(delegate.getOffer().getValue().divide(new BigDecimal("100"),5,RoundingMode.HALF_EVEN));
      delegate.setRetailPriceValue(new Money(offerValue,retailAdjustmentPrice.getCurrency(),5));
    }
  }
}
