{
  if (METADATA_CACHE.containsKey(batchPersistencePackage)) {
    for (    PersistencePackage persistencePackage : batchPersistencePackage.getPersistencePackages()) {
      exploitProtectionService.compareToken(persistencePackage.getCsrfToken());
    }
    return METADATA_CACHE.get(batchPersistencePackage);
  }
  DynamicResultSet[] results=new DynamicResultSet[batchPersistencePackage.getPersistencePackages().length];
  for (int j=0; j < batchPersistencePackage.getPersistencePackages().length; j++) {
    results[j]=inspect(batchPersistencePackage.getPersistencePackages()[j]);
    results[j].setBatchId(batchPersistencePackage.getPersistencePackages()[j].getBatchId());
  }
  BatchDynamicResultSet batchResults=new BatchDynamicResultSet();
  batchResults.setDynamicResultSets(results);
  METADATA_CACHE.put(batchPersistencePackage,batchResults);
  return METADATA_CACHE.get(batchPersistencePackage);
}
