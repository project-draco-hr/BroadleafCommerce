{
  String view=super.viewEntityForm(request,response,model,"offer",id);
  EntityForm entityForm=(EntityForm)model.asMap().get("entityForm");
  Entity entity=(Entity)model.asMap().get("entity");
  for (  Tab tab : entityForm.getTabs()) {
    Set<RuleBuilder> ruleBuilders=tab.getRuleBuilders();
    for (    RuleBuilder builder : ruleBuilders) {
      if (ITEM_DISCOUNT_TARGET_FIELD_NAME.equals(builder.getFieldName())) {
        builder.setFieldBuilder(entity.getPMap().get("targetItemCriteriaFieldService").getValue());
        String json=entity.getPMap().get("targetItemCriteriaJson").getValue();
        builder.setJson(json);
        builder.setDataWrapper(convertJsonToDataWrapper(json));
      }
    }
  }
  return view;
}
