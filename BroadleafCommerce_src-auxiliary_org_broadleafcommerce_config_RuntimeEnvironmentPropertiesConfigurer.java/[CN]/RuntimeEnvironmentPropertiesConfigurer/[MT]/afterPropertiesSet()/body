{
  if (!m_environments.contains(m_defaultEnvironment)) {
    throw new AssertionError("Default environment '" + m_defaultEnvironment + "' not listed in environment list");
  }
  if (m_keyResolver == null) {
    m_keyResolver=new SystemPropertyRuntimeEnvironmentKeyResolver();
  }
  String environment=determineEnvironment();
  Resource[] propertiesLocation=createPropertiesResource(environment);
  Resource[] commonLocation=createCommonResource();
  Resource[] allLocations=new Resource[propertiesLocation.length + commonLocation.length];
  System.arraycopy(commonLocation,0,allLocations,0,commonLocation.length);
  System.arraycopy(propertiesLocation,0,allLocations,commonLocation.length,propertiesLocation.length);
  setLocations(allLocations);
  validateProperties();
}
