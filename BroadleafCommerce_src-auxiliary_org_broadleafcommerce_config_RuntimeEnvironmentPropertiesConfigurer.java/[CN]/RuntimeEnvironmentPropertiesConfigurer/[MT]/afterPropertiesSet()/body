{
  if (!m_environments.contains(m_defaultEnvironment)) {
    throw new AssertionError("Default environment '" + m_defaultEnvironment + "' not listed in environment list");
  }
  if (m_keyResolver == null) {
    m_keyResolver=new SystemPropertyRuntimeEnvironmentKeyResolver();
  }
  String environment=determineEnvironment();
  Resource[] propertiesLocation=createPropertiesResource(environment);
  Resource[] commonLocation=createCommonResource();
  ArrayList<Resource> allLocations=new ArrayList<Resource>();
  for (  Resource resource : propertiesLocation) {
    if (resource.exists()) {
      allLocations.add(resource);
    }
  }
  for (  Resource resource : commonLocation) {
    if (resource.exists()) {
      allLocations.add(resource);
    }
  }
  setLocations(allLocations.toArray(new Resource[]{}));
  validateProperties();
}
