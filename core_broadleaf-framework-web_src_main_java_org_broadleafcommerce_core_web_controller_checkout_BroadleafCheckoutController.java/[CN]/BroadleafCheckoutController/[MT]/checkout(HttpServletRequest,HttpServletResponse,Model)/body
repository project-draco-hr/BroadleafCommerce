{
  Order cart=CartState.getCart();
  if (!(cart instanceof NullOrderImpl)) {
    model.addAttribute("orderMultishipOptions",orderMultishipOptionService.getOrGenerateOrderMultishipOptions(cart));
  }
  model.addAttribute("validShipping",hasValidShippingAddresses(cart));
  List<FulfillmentOption> fulfillmentOptions=fulfillmentOptionService.readAllFulfillmentOptions();
  if (hasValidShippingAddresses(cart)) {
    Set<FulfillmentOption> options=new HashSet<FulfillmentOption>();
    options.addAll(fulfillmentOptions);
    FulfillmentEstimationResponse estimateResponse=null;
    try {
      estimateResponse=fulfillmentPricingService.estimateCostForFulfillmentGroup(cart.getFulfillmentGroups().get(0),options);
    }
 catch (    FulfillmentPriceException e) {
    }
    model.addAttribute("estimateResponse",estimateResponse);
  }
  model.addAttribute("fulfillmentOptions",fulfillmentOptions);
  model.addAttribute("states",stateService.findStates());
  model.addAttribute("countries",countryService.findCountries());
  model.addAttribute("expirationMonths",populateExpirationMonths());
  model.addAttribute("expirationYears",populateExpirationYears());
  return getCheckoutView();
}
