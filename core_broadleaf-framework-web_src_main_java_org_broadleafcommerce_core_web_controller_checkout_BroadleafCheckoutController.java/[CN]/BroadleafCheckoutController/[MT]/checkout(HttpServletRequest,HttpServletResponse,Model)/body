{
  Order cart=CartState.getCart();
  if (!(cart instanceof NullOrderImpl)) {
    model.addAttribute("orderMultishipOptions",orderMultishipOptionService.getOrGenerateOrderMultishipOptions(cart));
  }
  String editShipping=request.getParameter("edit-shipping");
  boolean hasValidShipping;
  if (BooleanUtils.toBoolean(editShipping)) {
    hasValidShipping=false;
  }
 else {
    hasValidShipping=hasValidShippingAddresses(cart);
  }
  model.addAttribute("validShipping",hasValidShipping);
  putFulfillmentOptionsAndEstimationOnModel(model);
  model.addAttribute("states",stateService.findStates());
  model.addAttribute("countries",countryService.findCountries());
  model.addAttribute("expirationMonths",populateExpirationMonths());
  model.addAttribute("expirationYears",populateExpirationYears());
  return getCheckoutView();
}
