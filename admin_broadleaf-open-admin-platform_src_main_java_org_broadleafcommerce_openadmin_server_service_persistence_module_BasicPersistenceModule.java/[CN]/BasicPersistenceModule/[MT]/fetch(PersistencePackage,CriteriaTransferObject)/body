{
  Entity[] payload;
  int totalRecords;
  PersistencePerspective persistencePerspective=persistencePackage.getPersistencePerspective();
  String ceilingEntityFullyQualifiedClassname=persistencePackage.getCeilingEntityFullyQualifiedClassname();
  try {
    Map<String,FieldMetadata> mergedProperties=getMergedProperties(persistencePackage,cto);
    List<FilterMapping> filterMappings=getFilterMappings(persistencePerspective,cto,persistencePackage.getFetchTypeFullyQualifiedClassname(),mergedProperties);
    if (CollectionUtils.isNotEmpty(cto.getAdditionalFilterMappings())) {
      filterMappings.addAll(cto.getAdditionalFilterMappings());
    }
    List<Serializable> records;
    try {
      records=getPersistentRecords(persistencePackage.getFetchTypeFullyQualifiedClassname(),filterMappings,cto.getFirstResult(),cto.getMaxResults());
      totalRecords=getTotalRecords(persistencePackage.getFetchTypeFullyQualifiedClassname(),filterMappings);
    }
 catch (    CriteriaConversionException e) {
      TypedQueryBuilder builder=getSpecialCaseQueryBuilder(e.getFieldPath(),filterMappings,Class.forName(persistencePackage.getFetchTypeFullyQualifiedClassname()));
      records=builder.toQuery(getPersistenceManager().getDynamicEntityDao().getStandardEntityManager()).getResultList();
      totalRecords=((Long)builder.toCountQuery(getPersistenceManager().getDynamicEntityDao().getStandardEntityManager()).getSingleResult()).intValue();
    }
    payload=getRecords(mergedProperties,records,null,null);
  }
 catch (  Exception e) {
    throw new ServiceException("Unable to fetch results for " + ceilingEntityFullyQualifiedClassname,e);
  }
  return new DynamicResultSet(null,payload,totalRecords);
}
