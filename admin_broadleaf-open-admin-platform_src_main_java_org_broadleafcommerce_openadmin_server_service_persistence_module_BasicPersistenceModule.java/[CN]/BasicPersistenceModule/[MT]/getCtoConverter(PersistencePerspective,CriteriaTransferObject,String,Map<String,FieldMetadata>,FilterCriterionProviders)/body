{
  Map<String,FieldMetadata> mergedProperties=filterOutCollectionMetadata(mergedUnfilteredProperties);
  BaseCtoConverter ctoConverter=(BaseCtoConverter)applicationContext.getBean("blBaseCtoConverter");
  if (criterionProviders != null) {
    ctoConverter.setFilterCriterionProviders(criterionProviders);
  }
  for (  String propertyId : cto.getPropertyIdSet()) {
    if (mergedProperties.containsKey(propertyId)) {
      boolean handled=false;
      for (      PersistenceProvider persistenceProvider : persistenceProviders) {
        if (persistenceProvider.canHandleFilterMapping((BasicFieldMetadata)mergedProperties.get(propertyId))) {
          persistenceProvider.addFilterMapping(persistencePerspective,cto,ceilingEntityFullyQualifiedClassname,mergedProperties,ctoConverter,propertyId,getFieldManager());
          handled=true;
        }
      }
      if (!handled) {
        defaultPersistenceProvider.addFilterMapping(persistencePerspective,cto,ceilingEntityFullyQualifiedClassname,mergedProperties,ctoConverter,propertyId,getFieldManager());
      }
    }
 else {
      ctoConverter.addEmptyMapping(ceilingEntityFullyQualifiedClassname,propertyId);
    }
  }
  if (cto.getPropertyIdSet().isEmpty()) {
    ctoConverter.addEmptyMapping(ceilingEntityFullyQualifiedClassname,"");
  }
  return ctoConverter;
}
