{
  PersistentEntityCriteria countCriteria=ctoConverter.convert(new CriteriaTransferObjectCountWrapper(cto).wrap(),ceilingEntityFullyQualifiedClassname);
  Class<?>[] entities=persistenceManager.getDynamicEntityDao().getAllPolymorphicEntitiesFromCeiling(Class.forName(ceilingEntityFullyQualifiedClassname));
  boolean isArchivable=false;
  for (  Class<?> entity : entities) {
    if (Archivable.class.isAssignableFrom(entity)) {
      isArchivable=true;
      break;
    }
  }
  if (isArchivable) {
    SimpleFilterCriterionProvider criterionProvider=new SimpleFilterCriterionProvider(SimpleFilterCriterionProvider.FilterDataStrategy.NONE,0){
      public Criterion getCriterion(      String targetPropertyName,      Object[] filterObjectValues,      Object[] directValues){
        return Restrictions.or(Restrictions.eq(targetPropertyName,false),Restrictions.isNull(targetPropertyName));
      }
    }
;
    FilterCriterion filterCriterion=new FilterCriterion(AssociationPath.ROOT,"archiveStatus.archived",criterionProvider);
    ((NestedPropertyCriteria)countCriteria).add(filterCriterion);
  }
  return persistenceManager.getDynamicEntityDao().count(countCriteria,Class.forName(StringUtils.isEmpty(fetchTypeFullyQualifiedClassname) ? ceilingEntityFullyQualifiedClassname : fetchTypeFullyQualifiedClassname));
}
