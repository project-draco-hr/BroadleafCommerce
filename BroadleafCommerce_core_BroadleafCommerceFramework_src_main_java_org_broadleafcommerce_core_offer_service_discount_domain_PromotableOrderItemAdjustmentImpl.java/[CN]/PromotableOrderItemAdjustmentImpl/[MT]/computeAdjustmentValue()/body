{
  if (delegate.getOffer() != null && orderItem != null) {
    Money adjustmentPrice=orderItem.getAdjustmentPrice();
    if (adjustmentPrice == null) {
      if ((delegate.getOffer().getApplyDiscountToSalePrice()) && (orderItem.getSalePrice() != null)) {
        adjustmentPrice=orderItem.getSalePrice();
      }
 else {
        adjustmentPrice=orderItem.getRetailPrice();
      }
    }
    if (delegate.getOffer().getDiscountType().equals(OfferDiscountType.AMOUNT_OFF)) {
      delegate.setValue(new Money(delegate.getOffer().getValue()));
    }
    if (delegate.getOffer().getDiscountType().equals(OfferDiscountType.FIX_PRICE)) {
      delegate.setValue(adjustmentPrice.subtract(new Money(delegate.getOffer().getValue())));
    }
    if (delegate.getOffer().getDiscountType().equals(OfferDiscountType.PERCENT_OFF)) {
      delegate.setValue(adjustmentPrice.multiply(delegate.getOffer().getValue().divide(new BigDecimal("100"))));
    }
    if (adjustmentPrice.lessThan(delegate.getValue())) {
      delegate.setValue(adjustmentPrice);
    }
  }
}
