{
  Order order=orderDao.create();
  order.setCustomer(createCustomer());
  Address address=new AddressImpl();
  address.setAddressLine1("123 Test Rd");
  address.setCity("Dallas");
  address.setFirstName("Jeff");
  address.setLastName("Fischer");
  address.setPostalCode("75240");
  address.setPrimaryPhone("972-978-9067");
  State state=new StateImpl();
  state.setAbbreviation("ALL");
  state.setName("ALL");
  address.setState(state);
  Country country=new CountryImpl();
  country.setAbbreviation("US");
  country.setName("United States");
  state.setCountry(country);
  address.setCountry(country);
  FulfillmentGroup group=new FulfillmentGroupImpl();
  group.setAddress(address);
  List<FulfillmentGroup> groups=new ArrayList<FulfillmentGroup>();
  group.setMethod("standard");
  groups.add(group);
  order.setFulfillmentGroups(groups);
  Money total=new Money(5D);
  group.setShippingPrice(total);
  DiscreteOrderItemImpl item=new DiscreteOrderItemImpl();
  Sku sku=new SkuImpl();
  sku.setId(123456L);
  sku.setRetailPrice(new Money(10D));
  sku.setDiscountable(true);
  item.setSku(sku);
  item.setQuantity(2);
  order.addOrderItem(item);
  FulfillmentGroupItem fgItem=new FulfillmentGroupItemImpl();
  fgItem.setFulfillmentGroup(group);
  fgItem.setOrderItem(item);
  fgItem.setQuantity(2);
  fgItem.setPrice(new Money(0D));
  group.addFulfillmentGroupItem(fgItem);
  item=new DiscreteOrderItemImpl();
  sku=new SkuImpl();
  sku.setId(1234567L);
  sku.setRetailPrice(new Money(20D));
  sku.setDiscountable(true);
  item.setSku(sku);
  item.setQuantity(1);
  order.addOrderItem(item);
  fgItem=new FulfillmentGroupItemImpl();
  fgItem.setFulfillmentGroup(group);
  fgItem.setOrderItem(item);
  fgItem.setQuantity(1);
  fgItem.setPrice(new Money(0D));
  group.addFulfillmentGroupItem(fgItem);
  order.addAddedOfferCode(createOfferCode("20 Percent Off Item Offer",OfferType.ORDER_ITEM,OfferDiscountType.PERCENT_OFF,20,null,"discreteOrderItem.sku.id == 123456"));
  order.addAddedOfferCode(createOfferCode("3 Dollars Off Item Offer",OfferType.ORDER_ITEM,OfferDiscountType.AMOUNT_OFF,3,null,"discreteOrderItem.sku.id != 123456"));
  order.addAddedOfferCode(createOfferCode("1.20 Dollars Off Order Offer",OfferType.ORDER,OfferDiscountType.AMOUNT_OFF,1.20,null,null));
  order.setTotalShipping(new Money(0D));
  order=pricingService.executePricing(order);
  assert(order.getAdjustmentPrice().equals(new Money(31.80D)));
  assert(order.getTotal().greaterThan(order.getSubTotal()));
  assert(order.getTotalTax().equals(order.getSubTotal().multiply(0.05D).add(group.getShippingPrice().multiply(0.05D))));
  assert(order.getTotal().equals(order.getSubTotal().add(order.getTotalTax()).add(order.getTotalShipping()).subtract(order.getOrderAdjustmentsValue())));
}
