{
  Order cart=CartState.getCart();
  if (cart != null) {
    FulfillmentGroupRequest fulfillmentGroupRequest=wrapper.unwrap(request,context);
    if (fulfillmentGroupRequest.getOrder() != null && fulfillmentGroupRequest.getOrder().getId().equals(cart.getId())) {
      try {
        fulfillmentGroupRequest.setOrder(cart);
        FulfillmentGroup fulfillmentGroup=fulfillmentGroupService.addFulfillmentGroupToOrder(fulfillmentGroupRequest,priceOrder);
        FulfillmentGroupWrapper fulfillmentGroupWrapper=(FulfillmentGroupWrapper)context.getBean(FulfillmentGroupWrapper.class.getName());
        fulfillmentGroupWrapper.wrap(fulfillmentGroup,request);
        return fulfillmentGroupWrapper;
      }
 catch (      PricingException e) {
        throw new WebApplicationException(e,Response.status(Response.Status.INTERNAL_SERVER_ERROR).type(MediaType.TEXT_PLAIN).entity("An error occured pricing the cart.").build());
      }
    }
  }
  throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND).type(MediaType.TEXT_PLAIN).entity("Cart could not be found").build());
}
