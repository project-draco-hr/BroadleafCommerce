{
  String returnPath=saveEntity(request,response,model,pathVars,id,entityForm,result,ra);
  Map<String,Object> jsonResponse=new HashMap<String,Object>();
  if (result.hasErrors()) {
    List<Map<String,Object>> errorArray=new ArrayList<Map<String,Object>>();
    for (    FieldError e : result.getFieldErrors()) {
      Map<String,Object> errorMap=new HashMap<String,Object>();
      errorMap.put("errorType","fieldError");
      String fieldName=e.getField().substring(e.getField().indexOf("[") + 1,e.getField().indexOf("]")).replace("_","-");
      errorMap.put("field",fieldName);
      errorMap.put("message",e.getDefaultMessage());
      String tabFieldName=fieldName.replaceAll("_+",".");
      for (      Tab t : entityForm.getTabs()) {
        for (        Field f : t.getFields()) {
          if (f.getName().equals(tabFieldName)) {
            errorMap.put("tab",t.getTitle());
            break;
          }
        }
        if (errorMap.get("tab") != null) {
          break;
        }
      }
      errorArray.add(errorMap);
    }
    for (    ObjectError e : result.getGlobalErrors()) {
      Map<String,Object> errorMap=new HashMap<String,Object>();
      errorMap.put("errorType","globalError");
      errorMap.put("code",e.getCode());
      errorMap.put("message",e.getDefaultMessage());
      errorArray.add(errorMap);
    }
    jsonResponse.put("errors",errorArray);
  }
  return jsonResponse;
}
