{
  PaymentInfo info=paymentContext.getPaymentInfo();
  PaymentLog log=paymentInfoService.createLog();
  log.setLogType(PaymentLogEventType.FINISHED);
  log.setTransactionTimestamp(new Date());
  log.setTransactionSuccess(e == null ? Boolean.TRUE : Boolean.FALSE);
  log.setTransactionType(transactionType);
  log.setCustomer(info.getOrder().getCustomer());
  log.setPaymentInfoReferenceNumber(info.getReferenceNumber());
  log.setUserName(paymentContext.getUserName());
  String exceptionMessage;
  if (e != null) {
    exceptionMessage=e.getMessage();
    if (exceptionMessage != null) {
      if (exceptionMessage.length() >= 255) {
        exceptionMessage=exceptionMessage.substring(0,254);
      }
    }
 else {
      exceptionMessage=e.getClass().getName();
    }
  }
 else {
    exceptionMessage=null;
  }
  log.setExceptionMessage(exceptionMessage);
  log.setAmountPaid(info.getAmount());
  log.setPaymentInfo(info);
  info.getPaymentLogs().add(log);
  paymentInfoService.save(info);
}
