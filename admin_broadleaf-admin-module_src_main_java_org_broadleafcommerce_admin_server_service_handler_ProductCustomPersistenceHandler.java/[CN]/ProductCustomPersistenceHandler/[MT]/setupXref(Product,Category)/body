{
  Iterator<CategoryProductXref> itr=adminInstance.getAllParentCategoryXrefs().iterator();
  while (itr.hasNext()) {
    CategoryProductXref xref=itr.next();
    if (!isDefaultCategoryLegacyMode() && xref.getDefaultReference() != null && xref.getDefaultReference()) {
      itr.remove();
    }
    xref.setDefaultReference(false);
  }
  if (existingDefaultCategory != null) {
    CategoryProductXref categoryXref=new CategoryProductXrefImpl();
    categoryXref.setCategory(existingDefaultCategory);
    categoryXref.setProduct(adminInstance);
    if (!adminInstance.getAllParentCategoryXrefs().contains(categoryXref)) {
      adminInstance.getAllParentCategoryXrefs().add(categoryXref);
    }
    adminInstance.getAllParentCategoryXrefs().get(adminInstance.getAllParentCategoryXrefs().indexOf(categoryXref)).setDefaultReference(!isDefaultCategoryLegacyMode());
  }
}
