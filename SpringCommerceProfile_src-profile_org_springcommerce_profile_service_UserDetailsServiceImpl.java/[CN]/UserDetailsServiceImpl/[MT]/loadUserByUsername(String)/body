{
  org.springcommerce.profile.domain.User user=userDao.readUserByUsername(username);
  if (user == null) {
    throw new UsernameNotFoundException("The user was not found");
  }
  List<UserRole> roles=userDao.readRolesByUserId(user.getId());
  List<GrantedAuthority> authorities=new ArrayList<GrantedAuthority>();
  if (roles != null) {
    for (    UserRole role : roles) {
      authorities.add(new GrantedAuthorityImpl(role.getRoleName()));
    }
  }
  return new User(username,user.getPassword(),true,true,true,true,authorities.toArray(new GrantedAuthority[0]));
}
