{
  ReconstructCartResponse reconstructCartResponse=new ReconstructCartResponse();
  Order customerCart=findCartForCustomer(customer);
  if (customerCart != null) {
    List<OrderItem> itemsToRemove=new ArrayList<OrderItem>();
    for (    OrderItem orderItem : customerCart.getOrderItems()) {
      if (orderItem instanceof DiscreteOrderItem) {
        DiscreteOrderItem discreteOrderItem=(DiscreteOrderItem)orderItem;
        if (!discreteOrderItem.getSku().isActive(discreteOrderItem.getProduct(),orderItem.getCategory())) {
          itemsToRemove.add(orderItem);
        }
      }
 else       if (orderItem instanceof BundleOrderItem) {
        BundleOrderItem bundleOrderItem=(BundleOrderItem)orderItem;
        boolean removeBundle=false;
        for (        DiscreteOrderItem discreteOrderItem : bundleOrderItem.getDiscreteOrderItems()) {
          if (!discreteOrderItem.getSku().isActive(discreteOrderItem.getProduct(),orderItem.getCategory())) {
            removeBundle=true;
            break;
          }
        }
        if (removeBundle) {
          itemsToRemove.add(orderItem);
        }
      }
    }
    for (    OrderItem item : itemsToRemove) {
      removeItemFromOrder(customerCart,item);
    }
    reconstructCartResponse.setRemovedItems(itemsToRemove);
  }
  reconstructCartResponse.setOrder(customerCart);
  return reconstructCartResponse;
}
