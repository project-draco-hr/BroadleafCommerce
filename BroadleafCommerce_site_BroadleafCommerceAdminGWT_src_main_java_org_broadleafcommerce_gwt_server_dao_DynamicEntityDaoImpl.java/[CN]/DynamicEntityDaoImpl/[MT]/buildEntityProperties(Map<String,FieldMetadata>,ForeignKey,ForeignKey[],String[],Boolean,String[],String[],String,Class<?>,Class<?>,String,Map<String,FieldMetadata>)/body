{
  Map<String,FieldMetadata> newFields=getPropertiesForEntityClass(returnedClass,foreignField,additionalNonPersistenProperties,additionalForeignFields,MergedPropertyType.PRIMARY,populateManyToOneFields,includeFields,excludeFields,prefix + propertyName + ".",metadataOverrides);
  for (  FieldMetadata newMetadata : newFields.values()) {
    newMetadata.setInheritedFromType(targetClass.getName());
    newMetadata.setAvailableToTypes(new String[]{targetClass.getName()});
  }
  Map<String,FieldMetadata> convertedFields=new HashMap<String,FieldMetadata>();
  for (  String key : newFields.keySet()) {
    convertedFields.put(propertyName + "." + key,newFields.get(key));
  }
  fields.putAll(convertedFields);
}
