{
  if (!xssProtectionEnabled || StringUtils.isEmpty(string)) {
    return string;
  }
  try {
    CleanResults results=as.scan(string,antiSamyPolicy);
    if (results.getNumberOfErrors() > 0) {
      throw new CleanStringException(results);
    }
    return results.getCleanHTML();
  }
 catch (  CleanStringException e) {
    throw e;
  }
catch (  Exception e) {
    StringBuilder sb=new StringBuilder();
    sb.append("Unable to clean the passed in entity values");
    sb.append("\nNote - ");
    sb.append(getAntiSamyPolicyFileLocation());
    sb.append(" policy in effect. Set a new policy file to modify validation behavior/strictness.");
    LOG.error(sb.toString(),e);
    throw new ServiceException(sb.toString(),e);
  }
}
