{
  HttpServletRequest request=((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getRequest();
  if (BLCRequestUtils.isOKtoUseSession(new ServletWebRequest(request))) {
    HttpSession session=request.getSession();
    String token=(String)session.getAttribute(CSRFTOKEN);
    if (StringUtils.isEmpty(token)) {
      try {
        token=RandomGenerator.generateRandomId("SHA1PRNG",32);
      }
 catch (      NoSuchAlgorithmException e) {
        LOG.error("Unable to generate random number",e);
        throw new ServiceException("Unable to generate random number",e);
      }
      session.setAttribute(CSRFTOKEN,token);
    }
    return token;
  }
  return null;
}
