{
  String[] overrideKeys=null;
  FieldMetadata[] overrideValues=null;
  if (metadataOverrides != null) {
    overrideKeys=new String[metadataOverrides.size()];
    overrideValues=new FieldMetadata[metadataOverrides.size()];
    int j=0;
    for (    String key : metadataOverrides.keySet()) {
      overrideKeys[j]=key;
      overrideValues[j]=metadataOverrides.get(key);
    }
  }
  AppServices.DYNAMIC_ENTITY.inspect(ceilingEntityFullyQualifiedClassname,persistencePerspective,customCriteria,overrideKeys,overrideValues,new AbstractCallback<DynamicResultSet>(){
    @Override protected void onOtherException(    Throwable exception){
      super.onOtherException(exception);
      cb.onFailure(exception);
    }
    @Override protected void onSecurityException(    ApplicationSecurityException exception){
      super.onSecurityException(exception);
      cb.onFailure(exception);
    }
    public void onSuccess(    DynamicResultSet result){
      super.onSuccess(result);
      ClassMetadata metadata=result.getClassMetaData();
      filterProperties(metadata,new MergedPropertyType[]{MergedPropertyType.PRIMARY,MergedPropertyType.JOINSTRUCTURE},overrideFieldSort);
      DataSourceField typeField=new DataSourceTextField("_type");
      typeField.setCanEdit(false);
      typeField.setHidden(true);
      typeField.setAttribute("permanentlyHidden",true);
      dataSource.addField(typeField);
      for (      PolymorphicEntity polymorphicEntity : metadata.getPolymorphicEntities()) {
        String name=polymorphicEntity.getName();
        String type=polymorphicEntity.getType();
        dataSource.getPolymorphicEntities().put(type,name);
      }
      dataSource.setDefaultNewEntityFullyQualifiedClassname(dataSource.getPolymorphicEntities().keySet().iterator().next());
      cb.onSuccess(dataSource);
    }
  }
);
}
