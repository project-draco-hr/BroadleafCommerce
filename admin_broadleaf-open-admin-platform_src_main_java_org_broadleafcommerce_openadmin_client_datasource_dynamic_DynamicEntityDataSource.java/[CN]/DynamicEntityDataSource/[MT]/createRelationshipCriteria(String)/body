{
  ForeignKey foreignField=(ForeignKey)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.FOREIGNKEY);
  AdornedTargetList adornedTargetList=(AdornedTargetList)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST);
  if (foreignField == null && adornedTargetList == null) {
    throw new RuntimeException("Only datasources that utilize foreignField or adornedTargetList relationships may utilize this method");
  }
  Criteria criteria=new Criteria();
  String relationshipName;
  if (foreignField != null) {
    relationshipName=foreignField.getManyToField();
  }
 else   if (adornedTargetList != null) {
    relationshipName=adornedTargetList.getName();
  }
 else {
    relationshipName="containingEntityId";
  }
  if (relationshipValue == null) {
    relationshipValue="null";
  }
  criteria.addCriteria(relationshipName,relationshipValue);
  for (  DataSourceModule dataSourceModule : modules) {
    dataSourceModule.setLinkedValue(relationshipValue);
  }
  return criteria;
}
