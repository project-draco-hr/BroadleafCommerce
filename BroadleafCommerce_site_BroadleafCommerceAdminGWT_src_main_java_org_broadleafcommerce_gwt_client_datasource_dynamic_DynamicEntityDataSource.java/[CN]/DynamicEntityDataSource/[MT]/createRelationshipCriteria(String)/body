{
  ForeignKey foreignField=(ForeignKey)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.FOREIGNKEY);
  JoinStructure joinStructure=(JoinStructure)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.JOINSTRUCTURE);
  if (foreignField == null && joinStructure == null) {
    throw new RuntimeException("Only datasources that utilize a foreignField or joinStructure relationship may utilize this method");
  }
  Criteria criteria=new Criteria();
  String foreignKeyName;
  if (foreignField != null) {
    foreignKeyName=foreignField.getManyToField();
  }
 else {
    foreignKeyName=joinStructure.getManyToField();
  }
  criteria.addCriteria(foreignKeyName,relationshipValue);
  for (  DataSourceModule dataSourceModule : modules) {
    dataSourceModule.setLinkedValue(relationshipValue);
  }
  return criteria;
}
