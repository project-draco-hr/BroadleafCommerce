{
  Order cart=CartState.getCart();
  if (billingForm.isUseShippingAddress()) {
    copyShippingAddressToBillingAddress(cart,billingForm);
  }
  billingInfoFormValidator.validate(billingForm,result);
  if (result.hasErrors()) {
    return ExtensionResultStatusType.HANDLED_STOP;
  }
  PaymentInfo ccInfo=paymentInfoFactory.constructPaymentInfo(cart);
  ccInfo.setAddress(billingForm.getAddress());
  cart.getPaymentInfos().add(ccInfo);
  CreditCardPaymentInfo ccReference=(CreditCardPaymentInfo)securePaymentInfoService.create(PaymentInfoType.CREDIT_CARD);
  ccReference.setNameOnCard(billingForm.getCreditCardName());
  ccReference.setReferenceNumber(ccInfo.getReferenceNumber());
  ccReference.setPan(billingForm.getCreditCardNumber());
  ccReference.setCvvCode(billingForm.getCreditCardCvvCode());
  ccReference.setExpirationMonth(Integer.parseInt(billingForm.getCreditCardExpMonth()));
  ccReference.setExpirationYear(Integer.parseInt(billingForm.getCreditCardExpYear()));
  payments.put(ccInfo,ccReference);
  return ExtensionResultStatusType.HANDLED_CONTINUE;
}
