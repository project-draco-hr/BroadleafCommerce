{
  try {
    File drlFile=new File("war/WEB-INF/drools/" + shoppingCartPromotion.getName() + ".drl");
    Writer output=new BufferedWriter(new FileWriter(drlFile));
    if (drlFile == null) {
      throw new IllegalArgumentException("File should not be null.");
    }
    if (!drlFile.exists()) {
      throw new FileNotFoundException("File does not exist: " + drlFile);
    }
    if (!drlFile.isFile()) {
      throw new IllegalArgumentException("Should not be a directory: " + drlFile);
    }
    if (!drlFile.canWrite()) {
      throw new IllegalArgumentException("File cannot be written: " + drlFile);
    }
    String newLine="\n";
    String tab="\t";
    output.write("package org.broadleafcommerce.rules;" + newLine);
    output.write("import org.broadleafcommerce.rules.domain.CouponCode;" + newLine);
    output.write("import org.broadleafcommerce.order.domain.BroadleafOrder;" + newLine);
    output.write("rule \"" + shoppingCartPromotion.getName() + "\""+ newLine);
    output.write("when" + newLine + tab);
    if (!shoppingCartPromotion.getCouponCode().isEmpty()) {
      output.write("CouponCode(code == \"" + shoppingCartPromotion.getCouponCode() + "\")"+ newLine+ tab);
    }
    if (shoppingCartPromotion.getOrderTotal() > 0) {
      output.write("BroadleafOrder(orderTotal " + logicalOperator + " "+ shoppingCartPromotion.getOrderTotal()+ ")"+ newLine);
    }
    output.write("then" + newLine + tab);
    output.write("System.out.println(\"SUCCESS\");" + newLine);
    output.write("end");
    output.close();
    Package pkg=addRuleToNewPackage(drlFile);
    mergePackageWithRuleBase(pkg);
  }
 catch (  Exception e) {
    e.printStackTrace();
    System.out.println("Error writing drools file");
  }
 finally {
  }
}
