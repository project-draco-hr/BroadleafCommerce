{
  Customer loggedInCustomer=customerService.readCustomerByUsername((String)authResult.getPrincipal());
  Customer anonymousCustomer=customerState.getCustomer(request);
  Order cart=cartService.findCartForCustomer(anonymousCustomer);
  MergeCartResponse mergeCartResponse;
  try {
    mergeCartResponse=cartService.mergeCart(loggedInCustomer,cart);
  }
 catch (  PricingException e) {
    throw new RuntimeException(e);
  }
  request.getSession().setAttribute(mergeCartResponseKey,mergeCartResponse);
}
