{
  Product product=catalogService.findProductById(productId);
  if (product.getProductOptions() == null || product.getProductOptions().size() == 0) {
    return -1;
  }
  if (product.getAdditionalSkus().size() > 0) {
    for (    Sku sku : product.getAdditionalSkus()) {
      skuDao.delete(sku);
    }
    product.getAdditionalSkus().clear();
  }
  List<List<ProductOptionValue>> allPermutations=generatePermutations(0,new ArrayList<ProductOptionValue>(),product.getProductOptions());
  LOG.info("Total number of permutations: " + allPermutations.size());
  LOG.info(allPermutations);
  for (  List<ProductOptionValue> permutation : allPermutations) {
    Sku permutatedSku=catalogService.createSku();
    permutatedSku.setProduct(product);
    permutatedSku.setProductOptionValues(permutation);
    permutatedSku=catalogService.saveSku(permutatedSku);
    product.getAdditionalSkus().add(permutatedSku);
  }
  catalogService.saveProduct(product);
  return allPermutations.size();
}
