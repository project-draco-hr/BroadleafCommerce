{
  FileUploadBean bean=(FileUploadBean)command;
  MultipartFile file=bean.getFile();
  if (file == null) {
  }
  try {
    String basepath=request.getPathTranslated().substring(0,request.getPathTranslated().indexOf("/upload"));
    String absoluteFilename=basepath + File.separator + bean.getDirectory()+ File.separator+ file.getOriginalFilename();
    FileSystemResource fileResource=new FileSystemResource(absoluteFilename);
    checkDirectory(basepath + bean.getDirectory());
    backupExistingFile(fileResource,basepath + bean.getDirectory());
    FileOutputStream fout=new FileOutputStream(new FileSystemResource(basepath + File.separator + bean.getDirectory()+ File.separator+ file.getOriginalFilename()).getFile());
    BufferedOutputStream bout=new BufferedOutputStream(fout);
    BufferedInputStream bin=new BufferedInputStream(file.getInputStream());
    int x;
    while ((x=bin.read()) != -1) {
      bout.write(x);
    }
    bout.flush();
    bout.close();
    bin.close();
    return super.onSubmit(request,response,command,errors);
  }
 catch (  Exception e) {
    e.printStackTrace();
    throw new RuntimeException(e);
  }
}
