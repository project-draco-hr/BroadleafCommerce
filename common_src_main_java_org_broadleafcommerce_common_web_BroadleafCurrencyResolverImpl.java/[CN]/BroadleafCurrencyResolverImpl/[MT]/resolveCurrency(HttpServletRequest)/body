{
  BroadleafCurrency currency=null;
  currency=(BroadleafCurrency)request.getAttribute(CURRENCY_VAR);
  if (currency == null) {
    HttpSession session=request.getSession(true);
    if (session != null) {
      currency=(BroadleafCurrency)session.getAttribute(CURRENCY_VAR);
    }
  }
  if (currency == null) {
    Locale locale=(Locale)localeService.findDefaultLocale();
    if (locale != null) {
      currency=locale.getDefaultCurrency();
    }
  }
  if (currency == null) {
    currency=broadleafCurrencyService.findDefaultBroadleafCurrency();
  }
  request.getSession().setAttribute(CURRENCY_VAR,currency);
  return currency;
}
