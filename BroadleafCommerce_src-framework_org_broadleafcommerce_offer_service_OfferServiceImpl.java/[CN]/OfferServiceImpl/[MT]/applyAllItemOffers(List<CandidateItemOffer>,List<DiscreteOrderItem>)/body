{
  Offer notCombinableOfferApplied=null;
  int appliedItemOffersCount=0;
  for (  CandidateItemOffer itemOffer : itemOffers) {
    OrderItem orderItem=itemOffer.getOrderItem();
    if (notCombinableOfferApplied == null) {
      if ((itemOffer.getOffer().isStackable()) || orderItem.getOrderItemAdjustments().size() == 0) {
        applyOrderItemOffer(itemOffer);
        appliedItemOffersCount++;
        if (!itemOffer.getOffer().isCombinableWithOtherOffers()) {
          notCombinableOfferApplied=itemOffer.getOffer();
        }
      }
    }
 else {
      if (itemOffer.getOffer().equals(notCombinableOfferApplied)) {
        applyOrderItemOffer(itemOffer);
        appliedItemOffersCount++;
      }
    }
  }
  if (appliedItemOffersCount > 0) {
    for (    DiscreteOrderItem discreteOrderItem : discreteOrderItems) {
      if (discreteOrderItem.getAdjustmentPrice() != null) {
        Money itemPrice=discreteOrderItem.getRetailPrice();
        if (discreteOrderItem.getSalePrice() != null) {
          itemPrice=discreteOrderItem.getSalePrice();
        }
        if (discreteOrderItem.getAdjustmentPrice().greaterThanOrEqual(itemPrice)) {
          int offersApplied=discreteOrderItem.getOrderItemAdjustments().size();
          discreteOrderItem.removeAllAdjustments();
          appliedItemOffersCount=appliedItemOffersCount - offersApplied;
        }
      }
    }
    if ((notCombinableOfferApplied != null) && (appliedItemOffersCount == 0)) {
      itemOffers=removeOfferFromCandidateItemOffers(itemOffers,notCombinableOfferApplied);
      notCombinableOfferApplied=null;
      if (!itemOffers.isEmpty()) {
        applyAllItemOffers(itemOffers,discreteOrderItems);
      }
    }
  }
  return notCombinableOfferApplied;
}
