{
  if (offer != null && order != null) {
    if (order.getSubTotal() != null) {
      Money priceToUse=order.getSubTotal();
      if (offer.getDiscountType().equals(OfferDiscountType.AMOUNT_OFF)) {
        priceToUse=priceToUse.subtract(offer.getValue());
      }
 else       if (offer.getDiscountType().equals(OfferDiscountType.FIX_PRICE)) {
        priceToUse=offer.getValue();
      }
 else       if (offer.getDiscountType().equals(OfferDiscountType.PERCENT_OFF)) {
        priceToUse=priceToUse.subtract(priceToUse.multiply(offer.getValue().divide(new BigDecimal("100")).getAmount()));
      }
      if (priceToUse.lessThan(new Money(0))) {
        priceToUse=new Money(0);
      }
      discountedPrice=priceToUse.getAmount();
    }
  }
}
