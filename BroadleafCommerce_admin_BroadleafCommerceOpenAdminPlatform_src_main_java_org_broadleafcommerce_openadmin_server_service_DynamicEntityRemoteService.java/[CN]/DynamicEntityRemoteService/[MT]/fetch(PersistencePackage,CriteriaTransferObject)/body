{
  String ceilingEntityFullyQualifiedClassname=persistencePackage.getCeilingEntityFullyQualifiedClassname();
  SandBoxInfo sandBoxInfo=persistencePackage.getSandBoxInfo();
  adminRemoteSecurityService.securityCheck(ceilingEntityFullyQualifiedClassname,EntityOperationType.FETCH);
  PersistenceManager persistenceManager=null;
  try {
    SandBoxContext context=new SandBoxContext();
    context.setSandBoxName(sandBoxInfo.getSandBox());
    context.setSandBoxMode(persistencePackage.getSandBoxInfo().isCommitImmediately() ? SandBoxMode.IMMEDIATE_COMMIT : SandBoxMode.SANDBOX_COMMIT);
    SandBoxContext.setSandBoxContext(context);
    persistenceManager=(PersistenceManager)applicationContext.getBean(persistenceManagerRef);
    persistenceManager.setTargetMode(TargetModeType.SANDBOX);
    return persistenceManager.fetch(persistencePackage,cto);
  }
  finally {
    try {
      if (persistenceManager != null) {
        persistenceManager.close();
      }
    }
 catch (    Exception e) {
      e.printStackTrace();
    }
    SandBoxContext.setSandBoxContext(null);
  }
}
