{
  Customer customer=customerState.getCustomer(request);
  Order cart=cartService.findCartForCustomer(customer);
  OrderItem orderItem=null;
  for (  DiscreteOrderItem doi : cart.getDiscreteOrderItems()) {
    if (doi.getId().equals(orderItemId)) {
      orderItem=doi;
    }
  }
  orderItem.setQuantity(newQuantity);
  cartService.updateItemQuantity(cart,orderItem);
  cart=cartService.save(cart,true);
  Map<String,Object> responseMap=new HashMap<String,Object>();
  responseMap.put("cartItemCount",String.valueOf(cart.getItemCount()));
  if (isAjaxRequest(request)) {
    return responseMap;
  }
 else {
    sendRedirect(request,response,"/cart");
  }
  return null;
}
