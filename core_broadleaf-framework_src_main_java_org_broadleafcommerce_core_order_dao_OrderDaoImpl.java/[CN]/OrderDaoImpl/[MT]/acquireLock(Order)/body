{
  JdbcTemplate template=new JdbcTemplate(dataSource);
  boolean lockExists=template.queryForObject("SELECT COUNT(ORDER_ID) FROM BLC_ORDER_LOCK WHERE ORDER_ID = ?",new Object[]{order.getId()},Integer.class) == 1;
  if (!lockExists) {
    int rowsAffected;
    try {
      rowsAffected=template.update("INSERT INTO BLC_ORDER_LOCK(ORDER_ID, LOCKED) VALUES (?, ?)",order.getId(),"Y");
    }
 catch (    ConstraintViolationException e) {
      rowsAffected=0;
    }
    if (rowsAffected == 1) {
      return true;
    }
  }
  int rowsAffected=template.update("UPDATE BLC_ORDER_LOCK SET LOCKED = ? WHERE ORDER_ID = ? AND LOCKED = ?","Y",order.getId(),"N");
  return rowsAffected == 1;
}
