{
  Customer loggedInCustomer=customerService.readCustomerByUsername(authResult.getName());
  Customer anonymousCustomer=(Customer)request.getSession(true).getAttribute(CustomerStateFilter.ANONYMOUS_CUSTOMER_SESSION_ATTRIBUTE_NAME);
  Order cart=null;
  if (anonymousCustomer != null) {
    cart=orderService.findCartForCustomer(anonymousCustomer);
  }
  MergeCartResponse mergeCartResponse;
  try {
    mergeCartResponse=mergeCartService.mergeCart(loggedInCustomer,cart);
  }
 catch (  PricingException e) {
    throw new RuntimeException(e);
  }
catch (  RemoveFromCartException e) {
    throw new RuntimeException(e);
  }
  request.getSession().setAttribute(mergeCartResponseKey,mergeCartResponse);
}
