{
  BroadleafRequestContext brc=BroadleafRequestContext.getBroadleafRequestContext();
  if (brc == null) {
    brc=new BroadleafRequestContext();
    BroadleafRequestContext.setBroadleafRequestContext(brc);
  }
  brc.getAdditionalProperties().putAll(entityExtensionManagers);
  if (brc.getSite() == null) {
    Site site=siteResolver.resolveSite(request);
    brc.setSite(site);
  }
  brc.setWebRequest(request);
  brc.setIgnoreSite(brc.getSite() == null);
  brc.setAdmin(true);
  brc.getAdditionalProperties().put(ADMIN_ENFORCE_PRODUCTION_WORKFLOW_KEY,enforceProductionWorkflowUpdate);
  Locale locale=localeResolver.resolveLocale(request);
  brc.setLocale(locale);
  brc.setMessageSource(messageSource);
  TimeZone timeZone=broadleafTimeZoneResolver.resolveTimeZone(request);
  brc.setTimeZone(timeZone);
  BroadleafCurrency currency=currencyResolver.resolveCurrency(request);
  brc.setBroadleafCurrency(currency);
  prepareSandBox(request,brc);
}
