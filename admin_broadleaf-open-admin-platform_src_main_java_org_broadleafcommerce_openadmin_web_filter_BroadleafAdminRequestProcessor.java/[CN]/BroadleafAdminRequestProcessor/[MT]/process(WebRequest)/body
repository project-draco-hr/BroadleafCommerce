{
  BroadleafRequestContext brc=BroadleafRequestContext.getBroadleafRequestContext();
  if (brc == null) {
    brc=new BroadleafRequestContext();
    BroadleafRequestContext.setBroadleafRequestContext(brc);
  }
  if (brc.getSite() == null) {
    Site site=siteResolver.resolveSite(request);
    brc.setSite(site);
  }
  brc.setWebRequest(request);
  brc.setIgnoreSite(brc.getSite() == null);
  brc.setAdmin(true);
  Locale locale=localeResolver.resolveLocale(request);
  brc.setLocale(locale);
  brc.setMessageSource(messageSource);
  TimeZone timeZone=broadleafTimeZoneResolver.resolveTimeZone(request);
  brc.setTimeZone(timeZone);
  BroadleafCurrency currency=currencyResolver.resolveCurrency(request);
  brc.setBroadleafCurrency(currency);
  AdminUser adminUser=adminRemoteSecurityService.getPersistentAdminUser();
  if (adminUser != null) {
    brc.getAdditionalProperties().put(ADMIN_USER_PROPERTY,adminUser);
  }
}
