{
  BroadleafRequestContext brc=BroadleafRequestContext.getBroadleafRequestContext();
  if (brc == null) {
    brc=new BroadleafRequestContext();
    BroadleafRequestContext.setBroadleafRequestContext(brc);
  }
  brc.getAdditionalProperties().putAll(entityExtensionManagers);
  brc.getAdditionalProperties().put(USE_LEGACY_DEFAULT_CATEGORY_MODE,useLegacyDefaultCategoryMode);
  if (brc.getSite() == null) {
    Site site=siteResolver.resolveSite(request);
    brc.setSite(site);
  }
  brc.setWebRequest(request);
  brc.setIgnoreSite(brc.getSite() == null);
  brc.setAdmin(true);
  if (adminStrictValidateProductionChanges) {
    brc.setValidateProductionChangesState(ValidateProductionChangesState.ADMIN);
  }
 else {
    brc.setValidateProductionChangesState(ValidateProductionChangesState.UNDEFINED);
  }
  Locale locale=localeResolver.resolveLocale(request);
  brc.setLocale(locale);
  brc.setMessageSource(messageSource);
  TimeZone timeZone=broadleafTimeZoneResolver.resolveTimeZone(request);
  brc.setTimeZone(timeZone);
  BroadleafCurrency currency=currencyResolver.resolveCurrency(request);
  brc.setBroadleafCurrency(currency);
  prepareSandBox(request,brc);
  prepareProfile(request,brc);
  prepareCatalog(request,brc);
}
