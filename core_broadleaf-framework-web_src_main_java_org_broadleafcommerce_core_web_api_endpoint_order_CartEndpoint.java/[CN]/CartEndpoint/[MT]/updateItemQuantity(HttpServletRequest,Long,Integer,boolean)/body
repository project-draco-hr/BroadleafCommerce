{
  Order cart=CartState.getCart();
  if (cart != null) {
    try {
      OrderItemRequestDTO orderItemRequestDTO=new OrderItemRequestDTO();
      orderItemRequestDTO.setOrderItemId(itemId);
      orderItemRequestDTO.setQuantity(quantity);
      Order order=orderService.updateItemQuantity(cart.getId(),orderItemRequestDTO,priceOrder);
      order=orderService.save(order,priceOrder);
      OrderWrapper wrapper=(OrderWrapper)context.getBean(OrderWrapper.class.getName());
      wrapper.wrapDetails(order,request);
      return wrapper;
    }
 catch (    UpdateCartException e) {
      if (e.getCause() instanceof ItemNotFoundException) {
        throw new WebApplicationException(e,Response.status(Response.Status.NOT_FOUND).type(MediaType.TEXT_PLAIN).entity("Could not find order item id " + itemId).build());
      }
 else {
        throw new WebApplicationException(e,Response.status(Response.Status.INTERNAL_SERVER_ERROR).type(MediaType.TEXT_PLAIN).entity("An error occurred removing the item to the cart.").build());
      }
    }
catch (    RemoveFromCartException e) {
      if (e.getCause() instanceof ItemNotFoundException) {
        throw new WebApplicationException(e,Response.status(Response.Status.NOT_FOUND).type(MediaType.TEXT_PLAIN).entity("Could not find order item id " + itemId).build());
      }
 else {
        throw new WebApplicationException(e,Response.status(Response.Status.INTERNAL_SERVER_ERROR).type(MediaType.TEXT_PLAIN).entity("An error occurred removing the item to the cart.").build());
      }
    }
catch (    PricingException pe) {
      throw new WebApplicationException(pe,Response.status(Response.Status.INTERNAL_SERVER_ERROR).type(MediaType.TEXT_PLAIN).entity("An error occurred pricing the cart.").build());
    }
  }
  throw new WebApplicationException(Response.status(Response.Status.NOT_FOUND).type(MediaType.TEXT_PLAIN).entity("Cart could not be found").build());
}
