{
  try {
    final Map<String,Object> dirtyValues=new HashMap<String,Object>();
    extractData(selectedRecord,dirtyValues,PagesRuleBasedPresenterInitializer.ATTRIBUTEMAP.get(RuleType.CUSTOMER),getDisplay().getCustomerFilterBuilder(),MVELKEYWORDMAP.get(RuleType.CUSTOMER));
    extractData(selectedRecord,dirtyValues,PagesRuleBasedPresenterInitializer.ATTRIBUTEMAP.get(RuleType.PRODUCT),getDisplay().getProductFilterBuilder(),MVELKEYWORDMAP.get(RuleType.PRODUCT));
    extractData(selectedRecord,dirtyValues,PagesRuleBasedPresenterInitializer.ATTRIBUTEMAP.get(RuleType.REQUEST),getDisplay().getRequestFilterBuilder(),MVELKEYWORDMAP.get(RuleType.REQUEST));
    extractData(selectedRecord,dirtyValues,PagesRuleBasedPresenterInitializer.ATTRIBUTEMAP.get(RuleType.TIME),getDisplay().getTimeFilterBuilder(),MVELKEYWORDMAP.get(RuleType.TIME));
    extractQualifierData(null,true,dirtyValues);
    DSRequest requestProperties=new DSRequest();
    for (    String key : dirtyValues.keySet()) {
      getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().getForm().setValue(key,(String)dirtyValues.get(key));
    }
    getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().getForm().saveData(new DSCallback(){
      @Override public void execute(      DSResponse response,      Object rawData,      DSRequest request){
        if (response.getStatus() != RPCResponse.STATUS_FAILURE) {
          final String newId=response.getAttribute("newId");
          FormOnlyView legacyForm=(FormOnlyView)((FormOnlyView)getDisplay().getDynamicFormDisplay().getFormOnlyDisplay()).getMember("pageTemplateForm");
          final DynamicForm form=legacyForm.getForm();
          PageTemplateFormListDataSource dataSource=(PageTemplateFormListDataSource)form.getDataSource();
          dataSource.setCustomCriteria(new String[]{"constructForm",newId});
          form.saveData(new DSCallback(){
            @Override public void execute(            DSResponse response,            Object rawData,            DSRequest request){
              if (response.getStatus() != RPCResponse.STATUS_FAILURE) {
                try {
                  extractQualifierData(newId,false,dirtyValues);
                  if (!presenter.currentPageId.equals(newId)) {
                    Record myRecord=getDisplay().getListDisplay().getGrid().getResultSet().find("id",presenter.currentPageId);
                    if (myRecord != null) {
                      myRecord.setAttribute("id",newId);
                      presenter.currentPageRecord=myRecord;
                      presenter.currentPageId=newId;
                    }
 else {
                      String primaryKey=getDisplay().getListDisplay().getGrid().getDataSource().getPrimaryKeyFieldName();
                      getDisplay().getListDisplay().getGrid().getDataSource().fetchData(new Criteria(primaryKey,newId),new DSCallback(){
                        @Override public void execute(                        DSResponse response,                        Object rawData,                        DSRequest request){
                          getDisplay().getListDisplay().getGrid().clearCriteria();
                          getDisplay().getListDisplay().getGrid().setData(response.getData());
                          getDisplay().getListDisplay().getGrid().selectRecord(0);
                        }
                      }
);
                      SC.say(BLCMain.getMessageManager().getString("criteriaDoesNotMatch"));
                    }
                  }
                  getDisplay().getListDisplay().getGrid().selectRecord(getDisplay().getListDisplay().getGrid().getRecordIndex(presenter.currentPageRecord));
                }
 catch (                Exception e) {
                  SC.warn(e.getMessage());
                  java.util.logging.Logger.getLogger(getClass().toString()).log(Level.SEVERE,e.getMessage(),e);
                }
              }
            }
          }
);
        }
      }
    }
,requestProperties);
  }
 catch (  IncompatibleMVELTranslationException e) {
    SC.warn(e.getMessage());
    java.util.logging.Logger.getLogger(getClass().toString()).log(Level.SEVERE,e.getMessage(),e);
  }
}
