{
  if (!responseDTO.getValid()) {
    throw new IllegalArgumentException("Invalid payment responses cannot be parsed into the order payment domain");
  }
  Long orderId=Long.parseLong(responseDTO.getOrderId());
  Order order=orderService.findOrderById(orderId);
  List<OrderPayment> payments=order.getPayments();
  PaymentType type=null;
  if (responseDTO.getCreditCard() instanceof CreditCardDTO) {
    type=PaymentType.CREDIT_CARD;
  }
  OrderPayment payment=orderPaymentService.create();
  payment.setType(type);
  payment.setAmount(responseDTO.getAmount());
  PaymentTransaction transaction=orderPaymentService.createTransaction();
  transaction.setAmount(responseDTO.getAmount());
  transaction.setRawResponse(responseDTO.getRawResponse());
  transaction.setSuccess(responseDTO.getSuccessful());
  payment.addTransaction(transaction);
  orderService.addPaymentToOrder(order,payment,null);
  return null;
}
