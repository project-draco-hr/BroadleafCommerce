{
  super.run();
  while (true) {
    try {
      greenMail.waitForIncomingEmail(10000,1);
      MimeMessage[] messages=greenMail.getReceivedMessages();
      if (messages != null) {
        for (int j=currentCount; j < messages.length; j++) {
          ByteArrayOutputStream baos=new ByteArrayOutputStream();
          messages[j].writeTo(baos);
          baos.close();
          LOG.info("Email Sent - See MimeMessage Output: " + new String(baos.toByteArray()));
        }
        currentCount=messages.length;
      }
      if (currentCount > 2) {
        greenMail.stop();
        init();
      }
    }
 catch (    InterruptedException e) {
    }
catch (    Exception e) {
      LOG.warn("Unable to log demo email message",e);
    }
  }
}
