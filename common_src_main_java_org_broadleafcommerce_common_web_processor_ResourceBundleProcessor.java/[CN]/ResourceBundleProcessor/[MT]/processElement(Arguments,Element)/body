{
  String name=element.getAttributeValue("name");
  String mappingPrefix=element.getAttributeValue("mapping-prefix");
  boolean async=element.hasAttribute("async");
  boolean defer=element.hasAttribute("defer");
  NestableNode parent=element.getParent();
  List<String> files=new ArrayList<String>();
  for (  String file : element.getAttributeValue("files").split(",")) {
    files.add(file.trim());
  }
  if (bundleEnabled) {
    String versionedBundle=bundlingService.getVersionedBundleName(name);
    if (StringUtils.isBlank(versionedBundle)) {
      BroadleafResourceHttpRequestHandler reqHandler=getRequestHandler(name,arguments);
      try {
        versionedBundle=bundlingService.registerBundle(name,files,reqHandler);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
    String value=(String)StandardExpressionProcessor.processExpression(arguments,"@{'" + mappingPrefix + versionedBundle+ "'}");
    Element e=getElement(value,async,defer);
    parent.insertAfter(element,e);
  }
 else {
    List<String> additionalBundleFiles=bundlingService.getAdditionalBundleFiles(name);
    if (additionalBundleFiles != null) {
      files.addAll(additionalBundleFiles);
    }
    for (    String file : files) {
      file=file.trim();
      String value=(String)StandardExpressionProcessor.processExpression(arguments,"@{'" + mappingPrefix + file+ "'}");
      Element e=getElement(value,async,defer);
      parent.insertBefore(element,e);
    }
  }
  parent.removeChild(element);
  return ProcessorResult.OK;
}
