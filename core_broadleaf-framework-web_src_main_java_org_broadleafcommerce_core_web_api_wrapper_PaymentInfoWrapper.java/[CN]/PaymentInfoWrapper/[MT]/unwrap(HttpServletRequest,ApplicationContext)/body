{
  PaymentInfoService paymentInfoService=(PaymentInfoService)context.getBean("blPaymentInfoService");
  PaymentInfo paymentInfo=paymentInfoService.create();
  paymentInfo.setType(PaymentInfoType.getInstance(this.type));
  if (this.address != null) {
    paymentInfo.setAddress(this.address.unwrap(request,context));
  }
  if (this.phone != null) {
    paymentInfo.setPhone(this.phone.unwrap(request,context));
  }
  if (this.additionalFields != null && !this.additionalFields.isEmpty()) {
    Map<String,String> fields=new HashMap<String,String>();
    for (    MapElementWrapper mapElementWrapper : this.additionalFields) {
      fields.put(mapElementWrapper.getKey(),mapElementWrapper.getValue().toString());
    }
    paymentInfo.setAdditionalFields(fields);
  }
  if (this.amount != null) {
    if (this.currency != null) {
      paymentInfo.setAmount(new Money(this.amount,this.currency));
    }
 else {
      paymentInfo.setAmount(new Money(this.amount));
    }
  }
  paymentInfo.setCustomerIpAddress(this.customerIpAddress);
  paymentInfo.setReferenceNumber(this.referenceNumber);
  return paymentInfo;
}
