{
  if (getOffer() != null && fulfillmentGroup != null) {
    Money adjustmentPrice=fulfillmentGroup.getAdjustmentPrice();
    if (adjustmentPrice == null) {
      if ((getOffer().getApplyDiscountToSalePrice()) && (fulfillmentGroup.getSaleShippingPrice() != null)) {
        adjustmentPrice=fulfillmentGroup.getSaleShippingPrice();
      }
 else {
        adjustmentPrice=fulfillmentGroup.getRetailShippingPrice();
      }
    }
    if (getOffer().getDiscountType().equals(OfferDiscountType.AMOUNT_OFF)) {
      setValue(new Money(delegate.getOffer().getValue(),adjustmentPrice.getCurrency(),adjustmentPrice.getAmount().scale()));
    }
    if (getOffer().getDiscountType().equals(OfferDiscountType.FIX_PRICE)) {
      BigDecimal offerValue=adjustmentPrice.getAmount().subtract(delegate.getOffer().getValue());
      setValue(new Money(offerValue,adjustmentPrice.getCurrency(),5));
    }
    if (getOffer().getDiscountType().equals(OfferDiscountType.PERCENT_OFF)) {
      BigDecimal offerValue=adjustmentPrice.getAmount().multiply(delegate.getOffer().getValue().divide(new BigDecimal("100"),adjustmentPrice.getAmount().scale(),RoundingMode.HALF_EVEN));
      setValue(new Money(offerValue,adjustmentPrice.getCurrency(),5));
    }
    if (adjustmentPrice.lessThan(getValue())) {
      setValue(adjustmentPrice);
    }
  }
}
