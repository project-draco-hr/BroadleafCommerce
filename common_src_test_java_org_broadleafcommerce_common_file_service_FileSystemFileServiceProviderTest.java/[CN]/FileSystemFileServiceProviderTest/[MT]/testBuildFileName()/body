{
  FileSystemFileServiceProvider provider=new FileSystemFileServiceProvider();
  String tmpdir=FileUtils.getTempDirectoryPath();
  provider.fileSystemBaseDirectory=FilenameUtils.concat(tmpdir,"test");
  provider.maxGeneratedDirectoryDepth=2;
  File file=provider.getResource("/product/myproductimage.jpg");
  String resultPath=StringUtils.join(new String[]{tmpdir.substring(0,tmpdir.length() - 1),"test","35","ec","myproductimage.jpg"},File.separator);
  assertEquals(file.getAbsolutePath(),resultPath);
  BroadleafRequestContext brc=new BroadleafRequestContext();
  BroadleafRequestContext.setBroadleafRequestContext(brc);
  Site site=new SiteImpl();
  site.setId(125L);
  brc.setSite(site);
  file=provider.getResource("/product/myproductimage.jpg");
  resultPath=StringUtils.join(new String[]{tmpdir.substring(0,tmpdir.length() - 1),"test","7f","site-125","35","ec","myproductimage.jpg"},File.separator);
  assertEquals(file.getAbsolutePath(),resultPath);
  provider.maxGeneratedDirectoryDepth=3;
  file=provider.getResource("/product/myproductimage.jpg");
  resultPath=StringUtils.join(new String[]{tmpdir.substring(0,tmpdir.length() - 1),"test","7f","site-125","35","ec","52","myproductimage.jpg"},File.separator);
  assertEquals(file.getAbsolutePath(),resultPath);
}
