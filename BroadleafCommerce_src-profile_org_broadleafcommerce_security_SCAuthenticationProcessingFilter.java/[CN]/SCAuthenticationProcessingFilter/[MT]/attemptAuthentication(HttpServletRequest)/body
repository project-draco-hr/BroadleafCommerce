{
  Authentication auth=null;
  try {
    auth=super.attemptAuthentication(request);
  }
 catch (  CredentialsExpiredException e) {
    String username=obtainUsername(request);
    String password=obtainPassword(request);
    if (username == null) {
      username="";
    }
    if (password == null) {
      password="";
    }
    username=username.trim();
    UsernamePasswordAuthenticationToken authRequest=new UsernamePasswordAuthenticationToken(username,password,new GrantedAuthority[]{});
    HttpSession session=request.getSession(false);
    if (session != null || getAllowSessionCreation()) {
      request.getSession().setAttribute(SPRING_SECURITY_LAST_USERNAME_KEY,TextUtils.escapeEntities(username));
    }
    setDetails(request,authRequest);
    auth=authRequest;
    logger.info("###jb username = " + this.obtainUsername(request));
  }
  return auth;
}
