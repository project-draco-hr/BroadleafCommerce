{
  if (BroadleafControllerUtility.isAjaxRequest(request)) {
    response.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    ModelAndView mav=new ModelAndView("utility/blcException");
    mav.addObject("exceptionMessage",ex.getMessage());
    showDebugMessage=false;
    mav.addObject("showDebugMessage",showDebugMessage);
    if (showDebugMessage) {
      StringBuilder sb2=new StringBuilder();
      appendStackTrace(ex,sb2);
      mav.addObject("debugMessage",sb2.toString());
    }
    return mav;
  }
 else {
    return super.resolveException(request,response,handler,ex);
  }
}
