{
  customer.setRegistered(true);
  if (customer.getId() == null) {
    customer.setId(idGenerationService.findNextId("org.broadleafcommerce.profile.domain.Customer"));
  }
  customer.setUnencodedPassword(password);
  Customer retCustomer=saveCustomer(customer);
  notifyPostRegisterListeners(retCustomer);
  this.sendConfirmationEmail(retCustomer);
  HashMap<String,Object> emailDataMap=new HashMap<String,Object>();
  emailDataMap.put("customer",retCustomer);
  emailService.sendTemplateEmail(retCustomer.getEmailAddress(),emailInfo,emailDataMap);
  authenticateUser(customer.getUsername(),password);
  return retCustomer;
}
