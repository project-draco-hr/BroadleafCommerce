{
  Customer customer=readCustomerByUsername(passwordChange.getUsername());
  customer.setUnencodedPassword(passwordChange.getNewPassword());
  customer.setPasswordChangeRequired(false);
  customer=saveCustomer(customer);
  Authentication auth=SecurityContextHolder.getContext().getAuthentication();
  UsernamePasswordAuthenticationToken authRequest=new UsernamePasswordAuthenticationToken(passwordChange.getUsername(),passwordChange.getNewPassword(),auth.getAuthorities());
  SecurityContextHolder.getContext().setAuthentication(authRequest);
  auth.setAuthenticated(false);
  return customer;
}
