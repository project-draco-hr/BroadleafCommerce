{
  if (offer != null && orderItem != null) {
    Money priceToUse=orderItem.getRetailPrice();
    if ((offer.getApplyDiscountToSalePrice()) && (orderItem.getSalePrice() != null)) {
      priceToUse=orderItem.getSalePrice();
    }
    if (offer.getDiscountType() == OfferDiscountType.AMOUNT_OFF) {
      priceToUse=priceToUse.subtract(offer.getValue());
    }
 else     if (offer.getDiscountType() == OfferDiscountType.FIX_PRICE) {
      priceToUse=offer.getValue();
    }
 else     if (offer.getDiscountType() == OfferDiscountType.PERCENT_OFF) {
      priceToUse=priceToUse.subtract(priceToUse.multiply(offer.getValue().divide(new BigDecimal("100")).getAmount()));
    }
    if (priceToUse.lessThan(new Money(0))) {
      priceToUse=new Money(0);
    }
    discountedPrice=priceToUse.getAmount();
  }
}
