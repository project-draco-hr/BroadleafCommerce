{
  if (!mergedPus.containsKey(persistenceUnitName)) {
    PersistenceUnitInfo puiToStore=newPU;
    if (jpa2ApiPresent) {
      puiToStore=(PersistenceUnitInfo)Proxy.newProxyInstance(SmartPersistenceUnitInfo.class.getClassLoader(),new Class[]{SmartPersistenceUnitInfo.class},new Jpa2PersistenceUnitInfoDecorator(newPU));
    }
    for (    BroadleafClassTransformer transformer : classTransformers) {
      try {
        puiToStore.addTransformer(transformer);
      }
 catch (      IllegalStateException e) {
        LOG.warn("A BroadleafClassTransformer is configured for this persistence unit, but Spring reported a problem (likely that a LoadTimeWeaver is not registered). As a result, the Broadleaf Commerce ClassTransformer (" + transformer.getClass().getName() + ") is not being registered with the persistence unit.",e);
      }
    }
    mergedPus.put(persistenceUnitName,puiToStore);
  }
  return mergedPus.get(persistenceUnitName);
}
