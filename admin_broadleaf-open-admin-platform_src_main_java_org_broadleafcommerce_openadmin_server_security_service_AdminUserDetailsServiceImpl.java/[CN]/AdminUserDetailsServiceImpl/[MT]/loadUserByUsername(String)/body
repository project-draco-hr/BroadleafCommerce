{
  AdminUser adminUser=adminSecurityService.readAdminUserByUserName(username);
  if (adminUser == null || adminUser.getActiveStatusFlag() == null || !adminUser.getActiveStatusFlag()) {
    throw new UsernameNotFoundException("The user was not found");
  }
  List<GrantedAuthority> authorities=new ArrayList<GrantedAuthority>();
  for (  AdminRole role : adminUser.getAllRoles()) {
    for (    AdminPermission permission : role.getAllPermissions()) {
      authorities.add(new SimpleGrantedAuthority(permission.getName()));
    }
  }
  for (  AdminPermission permission : adminUser.getAllPermissions()) {
    authorities.add(new SimpleGrantedAuthority(permission.getName()));
  }
  authorities.add(new GrantedAuthorityImpl(AdminSecurityService.DEFAULT_PERMISSION));
  return new AdminUserDetails(adminUser.getId(),username,adminUser.getPassword(),true,true,true,true,authorities);
}
