{
  String customerId=null;
  HttpServletRequest request=(HttpServletRequest)servletRequest;
  if (request.getAttribute(CustomerStateFilter.getCustomerRequestAttributeName()) == null) {
    if (request.getAttribute(customerIdAttributeName) != null) {
      customerId=String.valueOf(request.getAttribute(customerIdAttributeName));
    }
    if (customerId == null) {
      customerId=servletRequest.getParameter(customerIdAttributeName);
    }
    if (customerId == null) {
      customerId=request.getHeader(customerIdAttributeName);
    }
    if (customerId != null && customerId.trim().length() > 0) {
      Customer customer=customerService.readCustomerById(Long.valueOf(customerId));
      if (customer != null) {
        servletRequest.setAttribute(CustomerStateFilter.getCustomerRequestAttributeName(),customer);
      }
    }
  }
  filterChain.doFilter(request,servletResponse);
}
