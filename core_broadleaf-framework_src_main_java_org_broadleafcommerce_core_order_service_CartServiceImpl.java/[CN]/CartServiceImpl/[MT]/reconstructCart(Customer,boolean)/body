{
  ReconstructCartResponse reconstructCartResponse=new ReconstructCartResponse();
  Order customerCart=findCartForCustomer(customer);
  if (customerCart != null) {
    List<OrderItem> itemsToRemove=new ArrayList<OrderItem>();
    for (    OrderItem orderItem : customerCart.getOrderItems()) {
      if (orderItem instanceof DiscreteOrderItem) {
        DiscreteOrderItem discreteOrderItem=(DiscreteOrderItem)orderItem;
        if (discreteOrderItem.getSku().getActiveStartDate() != null) {
          if (!discreteOrderItem.getSku().isActive(discreteOrderItem.getProduct(),orderItem.getCategory())) {
            itemsToRemove.add(orderItem);
          }
        }
 else {
          if (!discreteOrderItem.getProduct().isActive() || !orderItem.getCategory().isActive()) {
            itemsToRemove.add(orderItem);
          }
        }
      }
 else       if (orderItem instanceof BundleOrderItem) {
        boolean removeBundle=false;
        BundleOrderItem bundleOrderItem=(BundleOrderItem)orderItem;
        if (bundleOrderItem.getSku() != null) {
          if (!bundleOrderItem.getSku().isActive()) {
            removeBundle=true;
          }
        }
        if (removeBundle == false) {
          for (          DiscreteOrderItem discreteOrderItem : bundleOrderItem.getDiscreteOrderItems()) {
            if (discreteOrderItem.getSku().getActiveStartDate() != null) {
              if (!discreteOrderItem.getSku().isActive(discreteOrderItem.getProduct(),orderItem.getCategory())) {
                removeBundle=true;
                break;
              }
            }
 else {
              if (!discreteOrderItem.getProduct().isActive() || !orderItem.getCategory().isActive()) {
                removeBundle=true;
                break;
              }
            }
          }
        }
        if (removeBundle) {
          itemsToRemove.add(orderItem);
        }
      }
    }
    for (    OrderItem item : itemsToRemove) {
      removeItemFromOrder(customerCart,item,priceOrder);
    }
    reconstructCartResponse.setRemovedItems(itemsToRemove);
  }
  reconstructCartResponse.setOrder(customerCart);
  return reconstructCartResponse;
}
