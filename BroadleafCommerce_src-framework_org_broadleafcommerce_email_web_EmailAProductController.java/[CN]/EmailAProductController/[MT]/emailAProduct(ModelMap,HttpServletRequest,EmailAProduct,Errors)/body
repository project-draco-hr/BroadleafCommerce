{
  new EmailAProductValidator().validate(emailAProduct,errors);
  if (errors.hasErrors()) {
    if ("".equals(StringUtils.trim(emailAProduct.getEmailMessage()))) {
      emailAProduct.setEmailMessage(defaultMessage);
    }
    if ("".equals(StringUtils.trim(emailAProduct.getEmailSubject()))) {
      emailAProduct.setEmailMessage(defaultSubject);
    }
    model.addAttribute("emailAProduct",emailAProduct);
    return "email/emailAProduct";
  }
  if (emailAProduct.getEmailSubject() == null || emailAProduct.getEmailSubject().trim().length() == 0) {
    emailAProduct.setEmailSubject(defaultSubject);
  }
  if (emailAProduct.getEmailMessage() == null || emailAProduct.getEmailMessage().trim().length() == 0) {
    emailAProduct.setEmailMessage(defaultMessage);
  }
  if (emailAProduct.isSignUpForEmail()) {
    if (!emailListService.isOnList(emailAProduct.getSenderEmail(),EmailListType.MASTER)) {
      EmailListRequest emailListRequest=new EmailListRequest(emailAProduct.getSenderEmail());
      emailListRequest.setSendConfirmationEmail(true);
      emailListRequest.generateComment(request.getRemoteHost(),request.getHeader("USER-AGENT"));
      emailListService.subscribe(emailListRequest);
    }
  }
  emailWebService.sendEmailAProduct(emailAProduct);
  return "redirect:" + emailAProduct.getProductUrl();
}
