{
  Order order=context.getSeedData();
  Money difference=new Money(BigDecimal.ZERO);
  Money paymentSum=new Money(BigDecimal.ZERO);
  for (  OrderPayment payment : order.getPayments()) {
    paymentSum=paymentSum.add(payment.getSuccessfulTransactionAmountForType(PaymentTransactionType.AUTHORIZE)).add(payment.getSuccessfulTransactionAmountForType(PaymentTransactionType.AUTHORIZE_AND_CAPTURE));
  }
  if (!paymentSum.equals(order.getTotal())) {
    difference=order.getTotal().subtract(paymentSum);
    for (    OrderPayment payment : order.getPayments()) {
      if (PaymentType.THIRD_PARTY_ACCOUNT.equals(payment.getType())) {
        payment.setAmount(payment.getAmount().add(difference));
      }
    }
  }
  context.setSeedData(order);
  return context;
}
