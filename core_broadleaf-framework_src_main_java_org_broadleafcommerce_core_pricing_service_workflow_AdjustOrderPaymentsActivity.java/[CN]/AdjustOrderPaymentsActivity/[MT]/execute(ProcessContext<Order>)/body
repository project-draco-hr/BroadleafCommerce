{
  Order order=context.getSeedData();
  OrderPayment unconfirmedThirdParty=null;
  Money appliedPaymentsWithoutThirdParty=Money.ZERO;
  for (  OrderPayment payment : order.getPayments()) {
    PaymentTransaction initialTransaction=payment.getInitialTransaction();
    if (initialTransaction != null && PaymentTransactionType.UNCONFIRMED.equals(initialTransaction.getType()) && PaymentType.THIRD_PARTY_ACCOUNT.equals(payment.getType())) {
      unconfirmedThirdParty=payment;
    }
 else     if (payment.isActive() && payment.getAmount() != null) {
      appliedPaymentsWithoutThirdParty.add(payment.getAmount());
    }
  }
  if (unconfirmedThirdParty != null) {
    Money difference=order.getTotal().subtract(appliedPaymentsWithoutThirdParty);
    unconfirmedThirdParty.setAmount(difference);
  }
  context.setSeedData(order);
  return context;
}
