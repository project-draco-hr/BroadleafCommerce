{
  query.setFacet(true);
  for (  Entry<String,SearchFacetDTO> entry : namedFacetMap.entrySet()) {
    SearchFacetDTO dto=entry.getValue();
    String facetTagField=entry.getValue().isActive() ? GLOBAL_FACET_TAG_FIELD : entry.getKey();
    if (dto.getFacet().getSearchFacetRanges().size() > 0) {
      for (      SearchFacetRange range : dto.getFacet().getSearchFacetRanges()) {
        query.addFacetQuery(getSolrTaggedFieldString(entry.getKey(),facetTagField,"ex",range));
      }
    }
 else {
      query.addFacetField(getSolrTaggedFieldString(entry.getKey(),facetTagField,"ex",null));
    }
  }
}
