{
  if (staticAsset.getLockedFlag()) {
    throw new IllegalArgumentException("Unable to update a locked record");
  }
  if (automaticallyApproveAndPromoteStaticAssets) {
    if (destSandbox != null && destSandbox.getSite() != null) {
      destSandbox=destSandbox.getSite().getProductionSandbox();
    }
 else {
      destSandbox=null;
    }
  }
  if (checkForSandboxMatch(staticAsset.getSandbox(),destSandbox)) {
    if (staticAsset.getDeletedFlag()) {
      SandBoxItem item=sandBoxItemDao.retrieveBySandboxAndTemporaryItemId(staticAsset.getSandbox(),SandBoxItemType.STATIC_ASSET,staticAsset.getId());
      if (staticAsset.getOriginalAssetId() == null && item != null) {
        staticAsset.setArchivedFlag(true);
        item.setArchivedFlag(true);
      }
 else       if (item != null) {
        item.setSandBoxOperationType(SandBoxOperationType.DELETE);
        sandBoxItemDao.updateSandBoxItem(item);
      }
 else       if (automaticallyApproveAndPromoteStaticAssets) {
        staticAsset.setArchivedFlag(true);
      }
    }
    return staticAssetDao.addOrUpdateStaticAsset(staticAsset,true);
  }
 else   if (isProductionSandBox(staticAsset.getSandbox())) {
    StaticAsset clonedAsset=staticAsset.cloneEntity();
    clonedAsset.setOriginalAssetId(staticAsset.getId());
    clonedAsset.setSandbox(destSandbox);
    StaticAsset returnAsset=staticAssetDao.addOrUpdateStaticAsset(clonedAsset,true);
    StaticAsset prod=findStaticAssetById(staticAsset.getId());
    prod.setLockedFlag(true);
    staticAssetDao.addOrUpdateStaticAsset(prod,false);
    SandBoxOperationType type=SandBoxOperationType.UPDATE;
    if (clonedAsset.getDeletedFlag()) {
      type=SandBoxOperationType.DELETE;
    }
    sandBoxItemDao.addSandBoxItem(destSandbox,type,SandBoxItemType.STATIC_ASSET,returnAsset.getFullUrl(),returnAsset.getId(),returnAsset.getOriginalAssetId());
    return returnAsset;
  }
 else {
    throw new IllegalArgumentException("Update called when promote or reject was expected.");
  }
}
