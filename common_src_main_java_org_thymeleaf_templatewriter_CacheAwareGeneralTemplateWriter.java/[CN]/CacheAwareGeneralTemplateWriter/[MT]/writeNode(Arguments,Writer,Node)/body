{
  if (!(node instanceof org.thymeleaf.dom.Element)) {
    super.writeNode(arguments,writer,node);
    return;
  }
  org.thymeleaf.dom.Element e=(org.thymeleaf.dom.Element)node;
  String cacheKey=e.getAttributeValueFromNormalizedName("blccachekey");
  if (StringUtils.isNotBlank(cacheKey)) {
    Element element=getCache().get(cacheKey);
    String valueToWrite;
    if (element != null && element.getObjectValue() != null) {
      if (LOG.isTraceEnabled()) {
        LOG.trace("Read template from cache - " + cacheKey);
      }
      valueToWrite=(String)element.getObjectValue();
    }
 else {
      StringWriter w2=new StringWriter();
      final Node[] children=e.unsafeGetChildrenNodeArray();
      final int childrenLen=e.numChildren();
      for (int i=0; i < childrenLen; i++) {
        writeNode(arguments,w2,children[i]);
      }
      valueToWrite=w2.toString();
      element=new Element(cacheKey,valueToWrite);
      getCache().put(element);
    }
    writer.write(valueToWrite);
  }
 else {
    super.writeNode(arguments,writer,node);
  }
}
