{
  String contextPath=request.getContextPath();
  String requestURIWithoutContext;
  if (request.getContextPath() != null) {
    requestURIWithoutContext=request.getRequestURI().substring(request.getContextPath().length());
  }
 else {
    requestURIWithoutContext=request.getRequestURI();
  }
  URLHandler handler=urlHandlerService.findURLHandlerByURI(requestURIWithoutContext);
  if (handler != null) {
    if (URLRedirectType.FORWARD == handler.getUrlRedirectType()) {
      request.getRequestDispatcher(handler.getNewURL()).forward(request,response);
    }
 else     if (URLRedirectType.REDIRECT_PERM == handler.getUrlRedirectType()) {
      String url=UrlUtil.fixRedirectUrl(contextPath,handler.getNewURL());
      response.setStatus(Response.SC_MOVED_PERMANENTLY);
      response.setHeader("Location",url);
      response.setHeader("Connection","close");
    }
 else     if (URLRedirectType.REDIRECT_TEMP == handler.getUrlRedirectType()) {
      String url=UrlUtil.fixRedirectUrl(contextPath,handler.getNewURL());
      response.sendRedirect(url);
    }
  }
 else {
    filterChain.doFilter(request,response);
  }
}
