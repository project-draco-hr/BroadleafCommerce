{
  String[] broadleafConfigLocations=StandardConfigLocations.retrieveAll(StandardConfigLocations.ALLCONTEXTTYPE);
  ArrayList<InputStream> sources=new ArrayList<InputStream>();
  for (  String location : broadleafConfigLocations) {
    InputStream source=MergeXmlWebApplicationContext.class.getClassLoader().getResourceAsStream(location);
    if (source != null) {
      sources.add(source);
    }
  }
  InputStream[] filteredSources=new InputStream[]{};
  filteredSources=sources.toArray(filteredSources);
  String patchLocation=getPatchLocation();
  String[] patchLocations=StringUtils.tokenizeToStringArray(patchLocation,CONFIG_LOCATION_DELIMITERS);
  InputStream[] patches=new InputStream[patchLocations.length];
  for (int i=0; i < patchLocations.length; i++) {
    if (patchLocations[i].startsWith("classpath")) {
      patches[i]=MergeXmlWebApplicationContext.class.getClassLoader().getResourceAsStream(patchLocations[i].substring("classpath*:".length(),patchLocations[i].length()));
    }
 else {
      Resource resource=getResourceByPath(patchLocations[i]);
      patches[i]=resource.getInputStream();
    }
  }
  Resource[] resources=new MergeApplicationContextXmlConfigResource().getConfigResources(filteredSources,patches);
  reader.loadBeanDefinitions(resources);
}
