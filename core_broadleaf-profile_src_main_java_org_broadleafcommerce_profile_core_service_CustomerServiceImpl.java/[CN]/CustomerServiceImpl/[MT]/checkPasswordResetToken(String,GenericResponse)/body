{
  if (token == null || "".equals(token)) {
    response.addErrorCode("invalidToken");
  }
  String rawToken=null;
  String salt=null;
  String[] tokens=token.split("-");
  if (tokens.length > 2) {
    response.addErrorCode("invalidToken");
  }
 else {
    rawToken=tokens[0].toLowerCase();
    if (tokens.length == 2) {
      salt=tokens[1];
    }
  }
  CustomerForgotPasswordSecurityToken fpst=null;
  if (!response.getHasErrors()) {
    fpst=customerForgotPasswordSecurityTokenDao.readToken(passwordEncoder.encodePassword(rawToken,salt));
    if (fpst == null) {
      response.addErrorCode("invalidToken");
    }
 else     if (fpst.isTokenUsedFlag()) {
      response.addErrorCode("tokenUsed");
    }
 else     if (isTokenExpired(fpst)) {
      response.addErrorCode("tokenExpired");
    }
  }
  return fpst;
}
