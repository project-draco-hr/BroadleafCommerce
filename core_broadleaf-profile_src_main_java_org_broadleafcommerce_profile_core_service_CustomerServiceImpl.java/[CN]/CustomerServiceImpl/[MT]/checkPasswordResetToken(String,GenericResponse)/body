{
  if (token == null || "".equals(token)) {
    response.addErrorCode("invalidToken");
  }
  CustomerForgotPasswordSecurityToken fpst=null;
  if (!response.getHasErrors()) {
    token=token.toLowerCase();
    fpst=customerForgotPasswordSecurityTokenDao.readToken(encodePassword(token,null));
    if (fpst == null) {
      response.addErrorCode("invalidToken");
    }
 else     if (fpst.isTokenUsedFlag()) {
      response.addErrorCode("tokenUsed");
    }
 else     if (isTokenExpired(fpst)) {
      response.addErrorCode("tokenExpired");
    }
  }
  return fpst;
}
