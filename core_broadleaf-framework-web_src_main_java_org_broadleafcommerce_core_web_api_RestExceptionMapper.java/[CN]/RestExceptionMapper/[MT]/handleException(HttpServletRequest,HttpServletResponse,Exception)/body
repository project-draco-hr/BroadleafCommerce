{
  ErrorWrapper errorWrapper=new ErrorWrapper();
  Locale locale=null;
  BroadleafRequestContext requestContext=BroadleafRequestContext.getBroadleafRequestContext();
  if (requestContext != null) {
    locale=requestContext.getJavaLocale();
  }
  LOG.error("An error occured invoking a REST service",ex);
  if (locale == null) {
    locale=Locale.getDefault();
  }
  errorWrapper.setHttpStatusCode(500);
  response.setStatus(resolveResponseStatusCode(ex,errorWrapper));
  ErrorMessageWrapper errorMessageWrapper=new ErrorMessageWrapper();
  errorMessageWrapper.setMessageKey(resolveClientMessageKey(BroadleafWebServicesException.UNKNOWN_ERROR));
  errorMessageWrapper.setMessage(messageSource.getMessage(BroadleafWebServicesException.UNKNOWN_ERROR,null,BroadleafWebServicesException.UNKNOWN_ERROR,locale));
  errorWrapper.getMessages().add(errorMessageWrapper);
  return errorWrapper;
}
