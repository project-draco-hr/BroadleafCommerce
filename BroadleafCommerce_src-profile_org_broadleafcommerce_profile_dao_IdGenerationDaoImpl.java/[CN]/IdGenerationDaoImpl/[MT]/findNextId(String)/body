{
  IdGeneration idGeneration;
  Query query=em.createNamedQuery("BC_FIND_NEXT_ID");
  query.setParameter("idType",idType);
  query.setHint(getQueryCacheableKey(),false);
  try {
    idGeneration=(IdGeneration)query.getSingleResult();
  }
 catch (  NoResultException nre) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("No row found in idGenerator table for " + idType + " creating row.");
    }
    idGeneration=(IdGeneration)entityConfiguration.createEntityInstance("org.broadleafcommerce.profile.domain.IdGeneration");
    idGeneration.setType(idType);
    idGeneration.setBatchStart(getDefaultBatchStart());
    idGeneration.setBatchSize(getDefaultBatchSize());
    try {
      em.persist(idGeneration);
    }
 catch (    EntityExistsException e) {
      if (LOG.isWarnEnabled()) {
        LOG.warn("Error inserting row id generation for idType " + idType + ".  Requerying table.");
      }
      return findNextId(idType);
    }
  }
  return idGeneration;
}
