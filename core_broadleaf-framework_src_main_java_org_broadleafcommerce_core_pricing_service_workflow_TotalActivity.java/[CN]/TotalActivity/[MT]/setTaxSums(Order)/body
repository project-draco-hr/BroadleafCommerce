{
  Money orderTotalTax=new Money(BigDecimal.ZERO);
  for (  FulfillmentGroup fg : order.getFulfillmentGroups()) {
    Money fgTotalFgTax=new Money(BigDecimal.ZERO);
    Money fgTotalItemTax=new Money(BigDecimal.ZERO);
    Money fgTotalFeeTax=new Money(BigDecimal.ZERO);
    if (fg.getTaxes() != null) {
      for (      TaxDetail tax : fg.getTaxes()) {
        fgTotalFgTax=fgTotalFgTax.add(tax.getAmount());
      }
    }
    for (    FulfillmentGroupItem item : fg.getFulfillmentGroupItems()) {
      Money itemTotalTax=new Money(BigDecimal.ZERO);
      if (item.getTaxes() != null) {
        for (        TaxDetail tax : item.getTaxes()) {
          itemTotalTax=itemTotalTax.add(tax.getAmount());
        }
      }
      item.setTotalTax(itemTotalTax);
      fgTotalItemTax=fgTotalItemTax.add(itemTotalTax);
    }
    for (    FulfillmentGroupFee fee : fg.getFulfillmentGroupFees()) {
      Money feeTotalTax=new Money(BigDecimal.ZERO);
      if (fee.getTaxes() != null) {
        for (        TaxDetail tax : fee.getTaxes()) {
          feeTotalTax=feeTotalTax.add(tax.getAmount());
        }
      }
      fee.setTotalTax(feeTotalTax);
      fgTotalFeeTax=fgTotalFeeTax.add(feeTotalTax);
    }
    Money fgTotalTax=new Money(BigDecimal.ZERO).add(fgTotalFgTax).add(fgTotalItemTax).add(fgTotalFeeTax);
    fg.setTotalFulfillmentGroupTax(fgTotalFgTax);
    fg.setTotalItemTax(fgTotalItemTax);
    fg.setTotalFeeTax(fgTotalFeeTax);
    fg.setTotalTax(fgTotalTax);
    orderTotalTax=orderTotalTax.add(fgTotalTax);
  }
  order.setTotalTax(orderTotalTax);
}
