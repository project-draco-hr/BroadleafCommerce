{
  AdvancedCriteria myCriteria=new AdvancedCriteria();
  if (group.getOperatorType() == null) {
    group.setOperatorType(OperatorId.AND);
  }
  OperatorId operator=group.getOperatorType();
  myCriteria.setAttribute("operator",operator);
  List<Criterion> myCriteriaList=new ArrayList<Criterion>();
  if (group.getOperatorType().getValue().equals(OperatorId.NOT.getValue()) && group.getIsTopGroup()) {
    group=group.getSubGroups().get(0);
    group.setOperatorType(operator);
  }
  int j=0;
  for (  String phrase : group.getPhrases()) {
    appendCriteria(phrase,dataSource,j,parentCriteria,group.getOperatorType(),myCriteriaList);
    j++;
  }
  if (myCriteriaList.size() > 0) {
    Criterion[] convertedList=myCriteriaList.toArray(new Criterion[]{});
    myCriteria.buildCriterionFromList(group.getOperatorType(),convertedList);
  }
  if (group.getSubGroups().size() > 0) {
    for (    Group subgroup : group.getSubGroups()) {
      AdvancedCriteria subCriteria=createAdvancedCriteria(myCriteria,subgroup,dataSource);
      JavaScriptObject listJS=subCriteria.getAttributeAsJavaScriptObject("criteria");
      if (JSOHelper.isArray(listJS)) {
        myCriteria.appendToCriterionList(subCriteria);
      }
    }
  }
  return myCriteria;
}
