{
  Document document=DocumentHelper.createDocument();
  Element root=document.addElement(RATE_REQUEST_ELEM);
  root.addAttribute(USER_ID_ATTR,uspsUserName);
  root.addAttribute(PASSWORD_ATTR,uspsPassword);
  for (  USPSContainerItemRequest itemRequest : request.getContainerItems()) {
    Element dom=root.addElement(PACKAGE_ELEM).addAttribute(ID_ATTR,itemRequest.getPackageId());
    dom.addElement(SERVICE_ELEM).setText(SERVICE_TEXT);
    dom.addElement(ZIP_ORIGIN_ELEMENT).setText(itemRequest.getZipOrigination());
    dom.addElement(ZIP_DESTINATION_ELEMENT).setText(itemRequest.getZipDestination());
  }
  StringWriter strWriter=new StringWriter();
  XMLWriter writer=new XMLWriter(strWriter);
  try {
    writer.write(document);
    if (LOG.isDebugEnabled()) {
      LOG.debug("strWriter.toString(): " + strWriter.toString());
    }
    return strWriter.toString();
  }
  finally {
    document=null;
    if (writer != null) {
      try {
        writer.close();
      }
 catch (      IOException e) {
        LOG.warn("There was an unexpected error closing the Dom4J XMLWriter",e);
      }
    }
    if (strWriter != null) {
      try {
        strWriter.close();
      }
 catch (      IOException e) {
        LOG.warn("There was an unexpected error closing a java.io.StringWriter associated with the Dom4J XMLWriter",e);
      }
    }
  }
}
