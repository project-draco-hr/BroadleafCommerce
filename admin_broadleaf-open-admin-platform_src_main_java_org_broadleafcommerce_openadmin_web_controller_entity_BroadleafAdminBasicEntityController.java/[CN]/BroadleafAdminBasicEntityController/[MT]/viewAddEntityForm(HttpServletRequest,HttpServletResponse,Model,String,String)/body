{
  String sectionClassName=getClassNameForSection(sectionKey);
  ClassMetadata cmd=service.getClassMetadata(sectionClassName);
  if (StringUtils.isBlank(entityType)) {
    if (cmd.getPolymorphicEntities().getChildren().length == 0) {
      entityType=cmd.getPolymorphicEntities().getFullyQualifiedClassname();
    }
 else {
      entityType=getDefaultEntityType();
    }
  }
 else {
    entityType=URLDecoder.decode(entityType,"UTF-8");
  }
  if (StringUtils.isBlank(entityType)) {
    List<ClassTree> entityTypes=getAddEntityTypes(cmd.getPolymorphicEntities());
    model.addAttribute("entityTypes",entityTypes);
    model.addAttribute("viewType","entityTypeSelection");
  }
 else {
    ClassMetadata specificTypeMd=service.getClassMetadata(entityType);
    EntityForm entityForm=formService.buildEntityForm(specificTypeMd);
    formService.removeNonApplicableFields(cmd,entityForm,entityType);
    model.addAttribute("entityForm",entityForm);
    model.addAttribute("viewType","entityAddForm");
  }
  model.addAttribute("currentUrl",request.getRequestURL().toString());
  model.addAttribute("modalHeaderType","addEntity");
  setModelAttributes(model,sectionKey);
  return "modules/modalContainer";
}
