{
  String mainClassName=getClassNameForSection(sectionKey);
  ClassMetadata mainMetadata=service.getClassMetadata(mainClassName);
  service.addSubCollectionEntity(entityForm,mainClassName,collectionField,id);
  for (  Property p : mainMetadata.getProperties()) {
    if (p.getName().equals(collectionField)) {
      Entity[] rows=service.getRecordsForCollection(mainMetadata,id,p);
      ClassMetadata subCollectionMd;
      ListGrid listGrid;
      if (p.getMetadata() instanceof BasicCollectionMetadata) {
        subCollectionMd=service.getClassMetadata(((BasicCollectionMetadata)p.getMetadata()).getCollectionCeilingEntity());
        listGrid=formService.buildListGrid(subCollectionMd,rows);
      }
 else       if (p.getMetadata() instanceof AdornedTargetCollectionMetadata) {
        AdornedTargetCollectionMetadata fmd=((AdornedTargetCollectionMetadata)p.getMetadata());
        AdornedTargetList adornedList=(AdornedTargetList)fmd.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST);
        subCollectionMd=service.getClassMetadata(fmd.getCollectionCeilingEntity(),adornedList);
        listGrid=formService.buildAdornedListGrid(fmd,subCollectionMd,rows);
      }
 else {
        subCollectionMd=null;
        listGrid=null;
      }
      if (listGrid != null) {
        listGrid.setSubCollectionFieldName(collectionField);
        listGrid.setListGridType("inline");
        model.addAttribute("listGrid",listGrid);
      }
      break;
    }
  }
  setModelAttributes(model,sectionKey);
  return "views/modalListGrid";
}
