{
  if (!StringUtils.isEmpty(resetPasswordForm.getToken())) {
    GenericResponse errorResponse=adminSecurityService.resetPasswordUsingToken(resetPasswordForm.getUsername(),resetPasswordForm.getToken(),resetPasswordForm.getPassword(),resetPasswordForm.getConfirmPassword());
    if (errorResponse.getHasErrors()) {
      setErrors(errorResponse,request);
      return getResetPasswordView();
    }
 else {
      return redirectToLoginWithMessage("passwordReset");
    }
  }
  String username=resetPasswordForm.getUsername();
  GenericResponse errorResponse=adminSecurityService.sendResetPasswordNotification(username);
  if (errorResponse.getHasErrors()) {
    setErrors(errorResponse,request);
    return getForgotPasswordView();
  }
 else {
    request.getSession(true).setAttribute("forgot_password_username",username);
    return redirectToResetPasswordWithMessage("passwordTokenSent");
  }
}
