{
  Class result=null;
  try {
    result=Class.forName(className,true,Thread.currentThread().getContextClassLoader());
  }
 catch (  ClassNotFoundException ignoredClassNotFoundException) {
    String flexHomeProperty=getProject().getProperty("FLEX_HOME");
    if (flexHomeProperty != null) {
      File flexHome=new File(flexHomeProperty);
      if (flexHome.exists()) {
        File jarFile=new File(flexHome + "/lib",jarFileName);
        if (jarFile.exists()) {
          try {
            URLClassLoader urlClassLoader=new URLClassLoader(new URL[]{jarFile.toURL()});
            result=Class.forName(className,true,urlClassLoader);
            originalContextClassLoader=Thread.currentThread().getContextClassLoader();
            Thread.currentThread().setContextClassLoader(urlClassLoader);
          }
 catch (          MalformedURLException malformedURLException) {
            malformedURLException.printStackTrace();
          }
catch (          ClassNotFoundException classNotFoundException) {
            throw new BuildException("The class not found in jar file: " + jarFileName,getLocation());
          }
        }
 else {
          throw new BuildException("File does not exist: " + jarFileName,getLocation());
        }
      }
 else {
        throw new BuildException("FLEX_HOME does not exist.",getLocation());
      }
    }
 else {
      throw new BuildException("The class, " + className + ", must be in the classpath or the FLEX_HOME property must be set.",getLocation());
    }
  }
  return result;
}
