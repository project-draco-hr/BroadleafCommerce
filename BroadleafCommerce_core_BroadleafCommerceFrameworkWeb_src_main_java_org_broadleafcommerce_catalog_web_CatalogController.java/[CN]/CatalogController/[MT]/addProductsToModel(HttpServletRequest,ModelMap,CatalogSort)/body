{
  boolean productFound=false;
  String productId=request.getParameter("productId");
  Product product=null;
  try {
    product=catalogService.findProductById(new Long(productId));
  }
 catch (  Exception e) {
  }
  if (product != null && product.isActive()) {
    productFound=validateProductAndAddToModel(product,model);
    addRatingSummaryToModel(productId,model);
  }
 else {
    Category currentCategory=(Category)model.get("currentCategory");
    List<Product> productList=catalogService.findActiveProductsByCategory(currentCategory,SystemTime.asDate());
    SearchFilterUtil.filterProducts(productList,request.getParameterMap(),new String[]{"manufacturer","skus[0].salePrice"});
    if ((catalogSort != null) && (catalogSort.getSort() != null)) {
      populateProducts(productList,currentCategory);
      model.addAttribute("displayProducts",sortProducts(catalogSort,productList));
    }
 else {
      catalogSort=new CatalogSort();
      catalogSort.setSort("featured");
      populateProducts(productList,currentCategory);
      model.addAttribute("displayProducts",sortProducts(catalogSort,productList));
    }
  }
  return productFound;
}
