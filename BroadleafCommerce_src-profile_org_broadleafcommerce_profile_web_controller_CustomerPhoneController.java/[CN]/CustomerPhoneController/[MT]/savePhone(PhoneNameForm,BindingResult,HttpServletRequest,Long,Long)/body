{
  if (GenericValidator.isBlankOrNull(phoneNameForm.getPhoneName())) {
    ValidationUtils.rejectIfEmptyOrWhitespace(errors,"phoneName","phoneName.required");
  }
  if (phoneId != null) {
    phoneNameForm.getPhone().setId(phoneId);
  }
  phoneFormatter.formatPhoneNumber(phoneNameForm.getPhone());
  errors.pushNestedPath("phone");
  phoneValidator.validate(phoneNameForm.getPhone(),errors);
  errors.popNestedPath();
  if (!errors.hasErrors()) {
    CustomerPhone customerPhone=(CustomerPhone)entityConfiguration.createEntityInstance("org.broadleafcommerce.profile.domain.CustomerPhone");
    customerPhone.setCustomerId(customerState.getCustomerId(request));
    customerPhone.setPhoneName(phoneNameForm.getPhoneName());
    customerPhone.setPhone(phoneNameForm.getPhone());
    if ((customerPhoneId != null) && (customerPhoneId > 0)) {
      customerPhone.setId(customerPhoneId);
    }
    customerPhoneValidator.validate(customerPhone,errors);
    if (!errors.hasErrors()) {
      customerPhoneService.saveCustomerPhone(customerPhone);
      request.setAttribute("customerPhoneId",customerPhone.getId());
      request.setAttribute("phoneId",customerPhone.getPhone().getId());
    }
    return savePhoneSuccessUrl;
  }
 else {
    return savePhoneErrorUrl;
  }
}
