{
  super.bind();
  getDisplay().getStepFGForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getStepItemForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getStepBogoForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getOrderCombineForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getOrderItemCombineForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getRawCustomerForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getRawOrderForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getRawFGForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getRestrictForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getCustomerObtainForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getWhichCustomerForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getOrderForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getReceiveFromAnotherPromoForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getQualifyForAnotherPromoForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getReceiveFromAnotherPromoTargetForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getQualifyForAnotherPromoTargetForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getFGCombineForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getQualifyingItemSubTotalForm().addItemChangedHandler(new ItemChangedHandler(){
    @Override public void onItemChanged(    ItemChangedEvent event){
      setDirtyState();
    }
  }
);
  getDisplay().getListDisplay().getRemoveButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent event){
      if (event.isLeftButtonDown()) {
        getDisplay().getAdvancedButton().setSelected(false);
        getDisplay().getAdvancedButton().disable();
        getDisplay().getDeliveryTypeRadio().disable();
        getDisplay().getCustomerRuleRadio().disable();
        getDisplay().getOrderRuleRadio().disable();
        initializer.disable();
      }
    }
  }
);
  getDisplay().getAdvancedButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent event){
      if (((ToolStripButton)event.getSource()).getSelected()) {
        getPresenterSequenceSetupManager().getDataSource("offerDS").resetPermanentFieldVisibilityBasedOnType(lastSelectedRecord.getAttributeAsStringArray("_type"));
        getPresenterSequenceSetupManager().getDataSource("offerDS").permanentlyHideFields("deliveryType","offerItemQualifierRuleType","offerItemTargetRuleType","targetItemCriteria.id","targetItemCriteria.quantity","targetItemCriteria.orderItemMatchRule");
        getDisplay().getAdvancedItemCriteria().setVisible(true);
        getDisplay().getAdvancedItemCriteriaTarget().setVisible(true);
        getDisplay().getRestrictionSectionView().setVisible(true);
      }
 else {
        getPresenterSequenceSetupManager().getDataSource("offerDS").resetVisibilityOnly("name","description","type","discountType","maxUsesPerCustomer","maxUsesPerOrder","value","priority","startDate","endDate");
        getDisplay().getAdvancedItemCriteria().setVisible(false);
        getDisplay().getAdvancedItemCriteriaTarget().setVisible(false);
        getDisplay().getRestrictionSectionView().setVisible(false);
      }
      Map values=getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().getForm().getValues();
      Object[] keys=values.keySet().toArray();
      for (      Object key : keys) {
        if (key.toString().equals("__ref")) {
          values.remove(key);
        }
      }
      getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().buildFields(getPresenterSequenceSetupManager().getDataSource("offerDS"),true,true,false,lastSelectedRecord);
      getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().getForm().editRecord(lastSelectedRecord);
      getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().getForm().setValues(values);
      rebindFormItems(lastSelectedRecord);
    }
  }
);
  selectionChangedHandlerRegistration.removeHandler();
  getDisplay().getListDisplay().getGrid().addSelectionChangedHandler(new SelectionChangedHandler(){
    @Override public void onSelectionChanged(    SelectionEvent event){
      ListGridRecord selectedRecord=event.getSelectedRecord();
      if (event.getState()) {
        if (!selectedRecord.equals(lastSelectedRecord)) {
          lastSelectedRecord=selectedRecord;
          if (selectedRecord.getAttributeAsStringArray("_type") == null) {
            formPresenter.disable();
            getDisplay().getListDisplay().getRemoveButton().disable();
          }
 else {
            formPresenter.setStartState();
            getPresenterSequenceSetupManager().getDataSource("offerDS").resetVisibilityOnly("name","description","type","discountType","maxUsesPerCustomer","maxUsesPerOrder","value","priority","startDate","endDate");
            getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().buildFields(getDisplay().getListDisplay().getGrid().getDataSource(),true,true,false,selectedRecord);
            getDisplay().getDynamicFormDisplay().getFormOnlyDisplay().getForm().editRecord(selectedRecord);
            getDisplay().getListDisplay().getRemoveButton().enable();
          }
          changeSelection(selectedRecord);
          for (          Map.Entry<String,SubPresentable> subPresentable : subPresentables.entrySet()) {
            subPresentable.getValue().setStartState();
            subPresentable.getValue().load(selectedRecord,(DynamicEntityDataSource)display.getListDisplay().getGrid().getDataSource());
          }
        }
      }
    }
  }
);
  getSaveButtonHandlerRegistration().removeHandler();
  getDisplay().getDynamicFormDisplay().getSaveButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent event){
      if (event.isLeftButtonDown()) {
        extractor.applyData(lastSelectedRecord);
      }
    }
  }
);
  getDisplay().getHelpButtonType().addMouseMoveHandler(new MouseMoveHandler(){
    @Override public void onMouseMove(    MouseMoveEvent event){
      if (currentHelp == null) {
        currentHelp=createHelpWin(BLCMain.getMessageManager().getString("offerObtainSettingsHelpTitle"),BLCMain.getMessageManager().getString("offerObtainSettingsHelpContent"),true,300,200,getDisplay().getHelpButtonType().getAbsoluteLeft() + 26,getDisplay().getHelpButtonType().getAbsoluteTop());
        currentHelp.show();
      }
    }
  }
);
  getDisplay().getHelpButtonType().addMouseOutHandler(new MouseOutHandler(){
    @Override public void onMouseOut(    MouseOutEvent event){
      if (currentHelp != null) {
        currentHelp.destroy();
        currentHelp=null;
      }
    }
  }
);
  getDisplay().getDeliveryTypeRadio().addChangedHandler(new ChangedHandler(){
    @Override public void onChanged(    ChangedEvent event){
      String deliveryType=event.getValue().toString();
      initializer.initDeliveryType(deliveryType,lastSelectedRecord);
    }
  }
);
  getDisplay().getCustomerRuleRadio().addChangedHandler(new ChangedHandler(){
    @Override public void onChanged(    ChangedEvent event){
      String customerRule=event.getValue().toString();
      initializer.initCustomerRule(customerRule,lastSelectedRecord);
    }
  }
);
  getDisplay().getFgRuleRadio().addChangedHandler(new ChangedHandler(){
    @Override public void onChanged(    ChangedEvent event){
      String fgRule=event.getValue().toString();
      initializer.initFGRule(fgRule,lastSelectedRecord);
    }
  }
);
  getDisplay().getItemRuleRadio().addChangedHandler(new ChangedHandler(){
    @Override public void onChanged(    ChangedEvent event){
      String itemRule=event.getValue().toString();
      initializer.initItemRule(itemRule);
    }
  }
);
  getDisplay().getOrderRuleRadio().addChangedHandler(new ChangedHandler(){
    @Override public void onChanged(    ChangedEvent event){
      String orderRule=event.getValue().toString();
      initializer.initOrderRule(orderRule,lastSelectedRecord);
    }
  }
);
  getDisplay().getHelpButtonBogo().addMouseMoveHandler(new MouseMoveHandler(){
    @Override public void onMouseMove(    MouseMoveEvent event){
      if (currentHelp == null) {
        currentHelp=createHelpWin(BLCMain.getMessageManager().getString("bogoHelpTitle"),BLCMain.getMessageManager().getString("bogoHelpContent"),true,300,200,getDisplay().getHelpButtonBogo().getAbsoluteLeft() + 26,getDisplay().getHelpButtonBogo().getAbsoluteTop());
        currentHelp.show();
      }
    }
  }
);
  getDisplay().getHelpButtonBogo().addMouseOutHandler(new MouseOutHandler(){
    @Override public void onMouseOut(    MouseOutEvent event){
      if (currentHelp != null) {
        currentHelp.destroy();
        currentHelp=null;
      }
    }
  }
);
  getDisplay().getBogoRadio().addChangedHandler(new ChangedHandler(){
    @Override public void onChanged(    ChangedEvent event){
      String bogoRule=event.getValue().toString();
      initializer.initBogoRule(bogoRule);
    }
  }
);
  getDisplay().getAddItemButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent event){
      if (event.isLeftButtonDown()) {
        final ItemBuilderDisplay display=getDisplay().addItemBuilder(getPresenterSequenceSetupManager().getDataSource("offerOrderItemDS"));
        bindItemBuilderEvents(display,true);
        display.setDirty(true);
        setDirtyState();
      }
    }
  }
);
  for (  final ItemBuilderDisplay display : getDisplay().getItemBuilderViews()) {
    bindItemBuilderEvents(display,true);
  }
  getDisplay().getCustomerFilterBuilder().addFilterChangedHandler(new FilterChangedHandler(){
    @Override public void onFilterChanged(    FilterChangedEvent event){
      setDirtyState();
      getDisplay().getRawCustomerTextArea().setAttribute("dirty",true);
    }
  }
);
  additionalFilterEventManager.addFilterBuilderAdditionalEventHandler(getDisplay().getCustomerFilterBuilder(),new FilterBuilderAdditionalEventHandler(){
    @Override public void onAdditionalChangeEvent(){
      setDirtyState();
      getDisplay().getRawCustomerTextArea().setAttribute("dirty",true);
    }
  }
);
  getDisplay().getOrderFilterBuilder().addFilterChangedHandler(new FilterChangedHandler(){
    @Override public void onFilterChanged(    FilterChangedEvent event){
      setDirtyState();
      getDisplay().getRawOrderTextArea().setAttribute("dirty",true);
    }
  }
);
  additionalFilterEventManager.addFilterBuilderAdditionalEventHandler(getDisplay().getOrderFilterBuilder(),new FilterBuilderAdditionalEventHandler(){
    @Override public void onAdditionalChangeEvent(){
      setDirtyState();
      getDisplay().getRawOrderTextArea().setAttribute("dirty",true);
    }
  }
);
  getDisplay().getFulfillmentGroupFilterBuilder().addFilterChangedHandler(new FilterChangedHandler(){
    @Override public void onFilterChanged(    FilterChangedEvent event){
      setDirtyState();
      getDisplay().getRawFGTextArea().setAttribute("dirty",true);
    }
  }
);
  additionalFilterEventManager.addFilterBuilderAdditionalEventHandler(getDisplay().getFulfillmentGroupFilterBuilder(),new FilterBuilderAdditionalEventHandler(){
    @Override public void onAdditionalChangeEvent(){
      setDirtyState();
      getDisplay().getRawFGTextArea().setAttribute("dirty",true);
    }
  }
);
  getDisplay().getTargetAddItemButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent event){
      if (event.isLeftButtonDown()) {
        final ItemBuilderDisplay display=getDisplay().addTargetItemBuilder(getPresenterSequenceSetupManager().getDataSource("offerOrderItemDS"));
        bindItemBuilderEvents(display,true);
        display.setDirty(true);
        setDirtyState();
      }
    }
  }
);
  for (  final ItemBuilderDisplay display : getDisplay().getTargetItemBuilderViews()) {
    bindItemBuilderEvents(display,true);
  }
  getDisplay().getDynamicFormDisplay().getRefreshButton().addClickHandler(new ClickHandler(){
    @Override public void onClick(    ClickEvent event){
      if (event.isLeftButtonDown()) {
        additionalFilterEventManager.resetFilterState(new FilterStateRunnable(){
          @Override public void run(          FilterRestartCallback cb){
            initializeDisplay(lastSelectedRecord,cb);
          }
        }
);
      }
    }
  }
);
  getDisplay().getListDisplay().getGrid().addFetchDataHandler(new FetchDataHandler(){
    @Override public void onFilterData(    FetchDataEvent event){
      initializer.disable();
    }
  }
);
}
