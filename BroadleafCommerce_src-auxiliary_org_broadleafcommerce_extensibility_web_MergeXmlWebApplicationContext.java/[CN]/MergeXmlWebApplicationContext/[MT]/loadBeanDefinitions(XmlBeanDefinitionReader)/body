{
  String[] broadleafConfigLocations=StandardConfigLocations.retrieveAll();
  InputStream[] sources=new InputStream[broadleafConfigLocations.length];
  for (int i=0; i < broadleafConfigLocations.length; i++) {
    sources[i]=MergeXmlWebApplicationContext.class.getClassLoader().getResourceAsStream(broadleafConfigLocations[i]);
  }
  String patchLocation=getPatchLocation();
  String[] patchLocations=StringUtils.tokenizeToStringArray(patchLocation,CONFIG_LOCATION_DELIMITERS);
  InputStream[] patches=new InputStream[patchLocations.length];
  for (int i=0; i < patchLocations.length; i++) {
    if (patchLocations[i].startsWith("classpath")) {
      patches[i]=MergeXmlWebApplicationContext.class.getClassLoader().getResourceAsStream(patchLocations[i].substring("classpath*:".length(),patchLocations[i].length()));
    }
 else {
      Resource resource=getResourceByPath(patchLocations[i]);
      patches[i]=resource.getInputStream();
    }
  }
  Resource[] resources=new MergeApplicationContextXmlConfigResource().getConfigResources(sources,patches);
  reader.loadBeanDefinitions(resources);
}
