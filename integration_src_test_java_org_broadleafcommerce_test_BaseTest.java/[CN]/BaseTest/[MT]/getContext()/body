{
  try {
    if (mergeContext == null) {
      String[] contexts=StandardConfigLocations.retrieveAll(StandardConfigLocations.TESTCONTEXTTYPE);
      String[] additionalContexts=(ManagementFactory.getRuntimeMXBean().getInputArguments().contains("-Dlegacy=true")) ? new String[]{"bl-applicationContext-test-legacy.xml"} : new String[]{};
      additionalContexts=(String[])ArrayUtils.addAll(additionalContexts,moduleContexts.toArray());
      mergeContext=new MergeClassPathXMLApplicationContext(contexts,additionalContexts);
    }
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  return mergeContext;
}
