{
  PromotableOrder promotableOrder=promotableItemFactory.createPromotableOrder(order);
  orderOfferProcessor.clearOffersandAdjustments(promotableOrder);
  List<Offer> filteredOffers=orderOfferProcessor.filterOffers(offers,promotableOrder.getCustomer());
  if ((filteredOffers == null) || (filteredOffers.isEmpty())) {
    orderOfferProcessor.compileOrderTotal(promotableOrder);
  }
 else {
    itemOfferProcessor.prepareCart(promotableOrder);
    itemOfferProcessor.gatherCart(promotableOrder);
    orderOfferProcessor.initializeBundleSplitItems(promotableOrder);
    List<PromotableCandidateOrderOffer> qualifiedOrderOffers=new ArrayList<PromotableCandidateOrderOffer>();
    List<PromotableCandidateItemOffer> qualifiedItemOffers=new ArrayList<PromotableCandidateItemOffer>();
    itemOfferProcessor.filterOffers(promotableOrder,filteredOffers,qualifiedOrderOffers,qualifiedItemOffers);
    if ((qualifiedItemOffers.isEmpty()) && (qualifiedOrderOffers.isEmpty())) {
      orderOfferProcessor.compileOrderTotal(promotableOrder);
    }
 else {
      itemOfferProcessor.applyAndCompareOrderAndItemOffers(promotableOrder,qualifiedOrderOffers,qualifiedItemOffers);
      itemOfferProcessor.gatherCart(promotableOrder);
    }
  }
}
