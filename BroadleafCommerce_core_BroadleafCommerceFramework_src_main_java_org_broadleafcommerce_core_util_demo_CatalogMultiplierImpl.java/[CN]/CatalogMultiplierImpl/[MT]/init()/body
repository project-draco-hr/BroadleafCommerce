{
  long j=0;
  List<Product> products=catalogService.findAllProducts();
  while (j < numberOfProductsToAdd) {
    for (    Product product : products) {
      List<ProductAttribute> attributes=product.getProductAttributes();
      for (      ProductAttribute attribute : attributes) {
        em.detach(attribute);
        attribute.setId(null);
      }
      ProductSku derivedProduct=(ProductSku)product;
      Sku sku=derivedProduct.getSku();
      em.detach(sku);
      sku.setId(null);
      String skuName=sku.getName();
      int pos=skuName.indexOf('_');
      if (pos >= 0) {
        skuName=skuName.substring(0,pos);
      }
      sku.setName(skuName + '_' + j);
      sku=catalogService.saveSku(sku);
      derivedProduct.setSku(sku);
      product.getAllSkus().clear();
      product.getAllSkus().add(sku);
      product.getAllParentCategories().size();
      em.detach(product);
      product.setId(null);
      String productName=sku.getName();
      pos=productName.indexOf('_');
      if (pos >= 0) {
        productName=productName.substring(0,pos);
      }
      product.setName(productName + '_' + j);
      String manuName=product.getManufacturer();
      pos=manuName.indexOf('_');
      if (pos >= 0) {
        manuName=manuName.substring(0,pos);
      }
      product.setManufacturer(manuName + '_' + random.nextInt(100));
      product=catalogService.saveProduct(product);
      j++;
      System.out.println(j + ". Adding additional demo product: " + product.getName());
      if (j > numberOfProductsToAdd) {
        break;
      }
    }
    em.flush();
    em.clear();
  }
}
