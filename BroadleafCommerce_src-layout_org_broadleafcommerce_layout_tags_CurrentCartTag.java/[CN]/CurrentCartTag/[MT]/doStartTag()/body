{
  Customer customer=null;
  if (id != null) {
    WebApplicationContext applicationContext=WebApplicationContextUtils.getWebApplicationContext(pageContext.getServletContext());
    CustomerService customerService=(CustomerService)applicationContext.getBean("customerService");
    customer=customerService.readCustomerById((customerId));
  }
 else {
    customer=CustomerState.getCustomer((HttpServletRequest)pageContext.getRequest());
  }
  WebApplicationContext applicationContext=WebApplicationContextUtils.getWebApplicationContext(pageContext.getServletContext());
  OrderService orderService=(OrderService)applicationContext.getBean("orderService");
  Order order=orderService.findCurrentCartForCustomer(customer);
  if (orderVar != null) {
    pageContext.setAttribute(orderVar,order);
  }
  List<OrderItem> orderItems=null;
  if ((orderItemsVar != null || totalQuantityVar != null) && order != null) {
    orderItems=orderService.findItemsForOrder(order);
    if (orderItemsVar != null) {
      pageContext.setAttribute(orderItemsVar,orderItems);
    }
  }
  if (totalQuantityVar != null && orderItems != null) {
    int orderItemsCount=0;
    for (    OrderItem orderItem : orderItems) {
      orderItemsCount+=orderItem.getQuantity();
    }
    pageContext.setAttribute(totalQuantityVar,orderItemsCount);
  }
 else   if (totalQuantityVar != null) {
    pageContext.setAttribute(totalQuantityVar,0);
  }
  return EVAL_PAGE;
}
