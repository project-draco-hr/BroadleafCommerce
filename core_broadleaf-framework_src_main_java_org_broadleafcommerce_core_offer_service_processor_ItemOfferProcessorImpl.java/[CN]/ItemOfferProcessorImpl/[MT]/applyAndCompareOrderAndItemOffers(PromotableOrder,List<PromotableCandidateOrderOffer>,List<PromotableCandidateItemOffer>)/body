{
  if (!qualifiedItemOffers.isEmpty()) {
    Collections.sort(qualifiedItemOffers,ItemOfferComparator.INSTANCE);
    applyAllItemOffers(qualifiedItemOffers,order);
  }
  chooseSaleOrRetailAdjustments(order);
  if (!qualifiedOrderOffers.isEmpty()) {
    Collections.sort(qualifiedOrderOffers,new BeanComparator("discountedPrice"));
    Collections.sort(qualifiedOrderOffers,new BeanComparator("priority"));
    qualifiedOrderOffers=removeTrailingNotCombinableOrderOffers(qualifiedOrderOffers);
    applyAllOrderOffers(qualifiedOrderOffers,order);
  }
  order.setOrderSubTotalToPriceWithAdjustments();
  if (!qualifiedOrderOffers.isEmpty() && !qualifiedItemOffers.isEmpty()) {
    List<PromotableCandidateOrderOffer> finalQualifiedOrderOffers=new ArrayList<PromotableCandidateOrderOffer>();
    order.removeAllCandidateOrderOfferAdjustments();
    for (    PromotableCandidateOrderOffer candidateOrderOffer : qualifiedOrderOffers) {
      if (couldOfferApplyToOrder(candidateOrderOffer.getOffer(),order)) {
        finalQualifiedOrderOffers.add(candidateOrderOffer);
      }
    }
    Collections.sort(finalQualifiedOrderOffers,new BeanComparator("discountedPrice"));
    Collections.sort(finalQualifiedOrderOffers,new BeanComparator("priority"));
    if (!finalQualifiedOrderOffers.isEmpty()) {
      applyAllOrderOffers(finalQualifiedOrderOffers,order);
      order.setOrderSubTotalToPriceWithAdjustments();
    }
  }
}
