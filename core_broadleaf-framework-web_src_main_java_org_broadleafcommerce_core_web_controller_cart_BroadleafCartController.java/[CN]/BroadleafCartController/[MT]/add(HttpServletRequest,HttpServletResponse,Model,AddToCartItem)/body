{
  Order cart=CartState.getCart(request);
  if (cart == null || cart.equals(cartService.getNullOrder())) {
    cart=cartService.createNewCartForCustomer(CustomerState.getCustomer(request));
  }
  cartService.addItemToOrder(cart.getId(),itemRequest,false);
  cart=cartService.save(cart,true);
  CartState.setCart(request,cart);
  return isAjaxRequest(request) ? "ajax/cart" : "redirect:/cart";
}
