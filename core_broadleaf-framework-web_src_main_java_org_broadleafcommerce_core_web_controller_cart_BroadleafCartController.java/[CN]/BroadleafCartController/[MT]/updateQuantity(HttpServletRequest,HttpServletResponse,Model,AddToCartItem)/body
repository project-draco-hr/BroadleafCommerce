{
  Order cart=CartState.getCart();
  cart=orderService.updateItemQuantity(cart.getId(),itemRequest,false);
  cart=orderService.save(cart,true);
  CartState.setCart(cart);
  if (isAjaxRequest(request)) {
    Map<String,Object> extraData=new HashMap<String,Object>();
    extraData.put("productId",itemRequest.getProductId());
    extraData.put("cartItemCount",cart.getItemCount());
    model.addAttribute("blcextradata",new ObjectMapper().writeValueAsString(extraData));
    return getCartView();
  }
 else {
    return getCartPageRedirect();
  }
}
