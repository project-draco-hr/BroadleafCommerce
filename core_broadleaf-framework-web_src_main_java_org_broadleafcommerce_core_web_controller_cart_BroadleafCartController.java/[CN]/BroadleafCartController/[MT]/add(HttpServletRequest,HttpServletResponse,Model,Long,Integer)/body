{
  Customer customer=CustomerState.getCustomer(request);
  Order cart=CartState.getCart(request);
  if (cart == null || cart.equals(cartService.getNullOrder())) {
    cart=cartService.createNewCartForCustomer(customer);
  }
  Product product=catalogService.findProductById(productId);
  OrderItemRequestDTO itemRequest=new OrderItemRequestDTO();
  itemRequest.setQuantity(1);
  itemRequest.setProductId(product.getId());
  cartService.addItemToOrder(cart.getId(),itemRequest,false);
  cart=cartService.save(cart,true);
  Map<String,Object> responseMap=new HashMap<String,Object>();
  responseMap.put("productId",String.valueOf(productId));
  responseMap.put("cartItemCount",String.valueOf(cart.getItemCount()));
  responseMap.put("productName",product.getName());
  responseMap.put("quantityAdded",quantity);
  if (isAjaxRequest(request)) {
    return responseMap;
  }
 else {
    sendRedirect(request,response,"/cart");
  }
  return null;
}
