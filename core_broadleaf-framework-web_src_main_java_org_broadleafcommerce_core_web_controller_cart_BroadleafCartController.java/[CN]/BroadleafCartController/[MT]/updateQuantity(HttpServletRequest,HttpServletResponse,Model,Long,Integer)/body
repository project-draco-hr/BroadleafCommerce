{
  Order cart=CartState.getCart(request);
  OrderItem orderItem=null;
  Long productId=null;
  for (  DiscreteOrderItem doi : cart.getDiscreteOrderItems()) {
    if (doi.getId().equals(orderItemId)) {
      orderItem=doi;
      productId=doi.getProduct().getId();
    }
  }
  orderItem.setQuantity(newQuantity);
  cartService.updateItemQuantity(cart,orderItem);
  cart=cartService.save(cart,true);
  Map<String,Object> responseMap=new HashMap<String,Object>();
  responseMap.put("cartItemCount",String.valueOf(cart.getItemCount()));
  responseMap.put("productId",String.valueOf(productId));
  if (isAjaxRequest(request)) {
    return responseMap;
  }
 else {
    sendRedirect(request,response,"/cart");
  }
  return null;
}
