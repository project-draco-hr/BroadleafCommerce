{
  JoinTable joinTable=(JoinTable)persistencePerspective.getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.JOINTABLE);
  Entity entity=super.buildEntity(record);
  entity.setType(joinTable.getJoinTableEntityClassname());
  List<Property> properties=new ArrayList<Property>();
{
    Property property=new Property();
    property.setName(joinTable.getLinkedObjectPath() + "." + joinTable.getLinkedIdProperty());
    property.setValue(dataSource.stripDuplicateAllowSpecialCharacters(getLinkedValue()));
    properties.add(property);
  }
{
    Property property=new Property();
    property.setName(joinTable.getTargetObjectPath() + "." + joinTable.getTargetIdProperty());
    property.setValue(dataSource.stripDuplicateAllowSpecialCharacters(record.getAttribute("id")));
    properties.add(property);
  }
  if (joinTable.getSortField() != null) {
    Property property=new Property();
    property.setName(joinTable.getSortField());
    property.setValue(record.getAttribute(joinTable.getSortField()));
    properties.add(property);
  }
  Property[] props=new Property[properties.size() + entity.getProperties().length];
  for (int j=0; j < properties.size(); j++) {
    props[j]=properties.get(j);
  }
  int count=properties.size();
  for (int j=0; j < entity.getProperties().length; j++) {
    props[count]=entity.getProperties()[j];
    count++;
  }
  entity.setProperties(props);
  return entity;
}
