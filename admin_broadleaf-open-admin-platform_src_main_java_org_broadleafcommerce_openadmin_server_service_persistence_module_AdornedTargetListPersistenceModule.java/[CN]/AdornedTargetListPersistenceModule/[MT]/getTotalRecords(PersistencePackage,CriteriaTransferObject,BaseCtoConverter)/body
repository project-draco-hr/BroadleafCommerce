{
  AdornedTargetList adornedTargetList=(AdornedTargetList)persistencePackage.getPersistencePerspective().getPersistencePerspectiveItems().get(PersistencePerspectiveItemType.ADORNEDTARGETLIST);
  PersistentEntityCriteria countCriteria=ctoConverter.convert(new CriteriaTransferObjectCountWrapper(cto).wrap(),adornedTargetList.getAdornedTargetEntityClassname());
  Class<?>[] entities;
  try {
    entities=persistenceManager.getDynamicEntityDao().getAllPolymorphicEntitiesFromCeiling(Class.forName(adornedTargetList.getAdornedTargetEntityClassname()));
  }
 catch (  ClassNotFoundException e) {
    throw new PersistenceException(e);
  }
  boolean isArchivable=false;
  for (  Class<?> entity : entities) {
    if (Status.class.isAssignableFrom(entity)) {
      isArchivable=true;
      break;
    }
  }
  if (isArchivable && !persistencePackage.getPersistencePerspective().getShowArchivedFields()) {
    SimpleFilterCriterionProvider criterionProvider=new SimpleFilterCriterionProvider(SimpleFilterCriterionProvider.FilterDataStrategy.NONE,0){
      public Criterion getCriterion(      String targetPropertyName,      Object[] filterObjectValues,      Object[] directValues){
        return Restrictions.or(Restrictions.eq(targetPropertyName,'N'),Restrictions.isNull(targetPropertyName));
      }
    }
;
    FilterCriterion filterCriterion=new FilterCriterion(AssociationPath.ROOT,"archiveStatus.archived",criterionProvider);
    ((NestedPropertyCriteria)countCriteria).add(filterCriterion);
  }
  try {
    return persistenceManager.getDynamicEntityDao().count(countCriteria,Class.forName(adornedTargetList.getAdornedTargetEntityClassname()));
  }
 catch (  ClassNotFoundException e) {
    throw new PersistenceException(e);
  }
}
