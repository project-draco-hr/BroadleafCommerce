{
  Order order=null;
  Query query=em.createNamedQuery("BC_READ_ORDERS_BY_CUSTOMER_ID_AND_NAME_NULL");
  query.setParameter("customerId",customer.getId());
  query.setParameter("orderStatus",OrderStatus.IN_PROCESS);
  try {
    order=(Order)query.getSingleResult();
    return order;
  }
 catch (  NoResultException nre) {
    if (persist) {
      order=create();
      if (customer.getUsername() == null) {
        customer.setUsername(String.valueOf(customer.getId()));
        em.persist(customer);
      }
      order.setCustomer(customer);
      order.setStatus(OrderStatus.IN_PROCESS);
      em.persist(order);
    }
    return order;
  }
}
