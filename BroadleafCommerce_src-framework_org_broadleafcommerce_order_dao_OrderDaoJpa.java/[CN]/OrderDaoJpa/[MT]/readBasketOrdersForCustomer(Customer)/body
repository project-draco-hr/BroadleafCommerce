{
  Order bo;
  Query query=em.createNamedQuery("BC_READ_ORDERS_BY_CUSTOMER_ID_AND_TYPE");
  query.setParameter("customerId",customer.getId());
  query.setParameter("orderType",OrderType.BASKET);
  try {
    bo=(OrderImpl)query.getSingleResult();
    return (OrderImpl)query.getSingleResult();
  }
 catch (  NoResultException nre) {
    bo=(Order)entityConfiguration.createEntityInstance("org.broadleafcommerce.order.domain.Order");
    bo.setCustomer(customer);
    bo.setType(OrderType.BASKET);
    em.persist(bo);
    return bo;
  }
}
