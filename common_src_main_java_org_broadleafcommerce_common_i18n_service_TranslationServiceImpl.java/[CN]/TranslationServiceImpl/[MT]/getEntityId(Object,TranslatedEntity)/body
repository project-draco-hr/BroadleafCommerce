{
  Map<String,Object> idMetadata=dao.getIdPropertyMetadata(entityType);
  String idProperty=(String)idMetadata.get("name");
  Type idType=(Type)idMetadata.get("type");
  if (!(idType instanceof LongType || idType instanceof StringType)) {
    throw new UnsupportedOperationException("Only ID types of String and Long are currently supported");
  }
  Object idValue;
  try {
    idValue=PropertyUtils.getProperty(entity,idProperty);
  }
 catch (  Exception e) {
    throw new RuntimeException("Error reading id property",e);
  }
  if (idType instanceof StringType) {
    return (String)idValue;
  }
 else   if (idType instanceof LongType) {
    SandBoxHelper.OriginalIdResponse originalIdResponse=sandBoxHelper.getOriginalId(dao.getEntityImpl(entityType),(Long)idValue);
    if (originalIdResponse.isRecordFound() && originalIdResponse.getOriginalId() != null) {
      idValue=originalIdResponse.getOriginalId();
      originalIdResponse=sandBoxHelper.getProductionOriginalId(dao.getEntityImpl(entityType),(Long)idValue);
      if (originalIdResponse.isRecordFound() && !originalIdResponse.getOriginalId().equals(idValue)) {
        idValue=originalIdResponse.getOriginalId();
      }
    }
    return String.valueOf(idValue);
  }
  throw new IllegalArgumentException(String.format("Could not retrieve value for id property. Object: [%s], " + "ID Property: [%s], ID Type: [%s]",entity,idProperty,idType));
}
