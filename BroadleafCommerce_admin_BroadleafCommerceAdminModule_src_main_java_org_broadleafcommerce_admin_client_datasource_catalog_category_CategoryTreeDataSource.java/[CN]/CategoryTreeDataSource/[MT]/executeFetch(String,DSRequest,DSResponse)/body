{
  CriteriaTransferObject criteriaTransferObject=getCompatibleModule(OperationType.ENTITY).getCto(request);
  String[] filterValues=criteriaTransferObject.get(CategoryTreeDataSourceFactory.foreignKeyName).getFilterValues();
  String parentCategoryId=filterValues.length > 0 ? filterValues[0] : null;
  boolean hasChildren=true;
  if (parentCategoryId != null) {
    TreeNode parentNode=((TreeGrid)associatedGrid).getTree().findById(parentCategoryId);
    if (parentNode != null) {
      hasChildren=Boolean.parseBoolean(parentNode.getAttribute(CategoryTreeDataSourceFactory.hasChildrenProperty));
    }
  }
  if (hasChildren && parentCategoryId != null) {
    super.executeFetch(requestId,request,response);
  }
 else   if (parentCategoryId == null) {
    TreeNode node=new TreeNode();
    node.setAttribute(getPrimaryKeyFieldName(),getRootId());
    node.setAttribute("name",getRootName());
    node.setAttribute(CategoryTreeDataSourceFactory.hasChildrenProperty,String.valueOf(hasChildren));
    node.setAttribute("_type",new String[]{EntityImplementations.CATEGORY});
    TreeNode[] recordList=new TreeNode[]{node};
    response.setData(recordList);
    response.setTotalRows(0);
    processResponse(requestId,response);
  }
 else {
    TreeNode[] recordList=new TreeNode[]{};
    response.setData(recordList);
    response.setTotalRows(0);
    processResponse(requestId,response);
  }
}
