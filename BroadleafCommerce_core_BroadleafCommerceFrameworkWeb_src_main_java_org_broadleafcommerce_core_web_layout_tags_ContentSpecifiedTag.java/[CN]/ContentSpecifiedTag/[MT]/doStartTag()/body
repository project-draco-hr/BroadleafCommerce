{
  WebApplicationContext applicationContext=WebApplicationContextUtils.getWebApplicationContext(pageContext.getServletContext());
  ContentService contentService=(ContentService)applicationContext.getBean("blContentService");
  List<Content> contentObjs;
  Date displayDate=null;
  String sandbox="PROD";
  HttpSession session=pageContext.getSession();
  if (session != null) {
    String newSandbox=(String)session.getAttribute("BLC_CONTENT_SANDBOX");
    String displayDateString=(String)session.getAttribute("BLC_CONTENT_DATE_TIME");
    if (newSandbox != null && newSandbox != "") {
      sandbox=newSandbox;
    }
    if (displayDateString != null && displayDateString != "") {
      try {
        displayDate=new SimpleDateFormat("MM-dd-yyyy").parse(displayDateString);
      }
 catch (      ParseException exp) {
        throw new JspException();
      }
    }
  }
  if (displayDate == null) {
    contentObjs=contentService.findContent(sandbox,contentType,parameterMap,SystemTime.asDate());
  }
 else {
    contentObjs=contentService.findContent(sandbox,contentType,parameterMap,displayDate);
  }
  JspWriter out=pageContext.getOut();
  try {
    String renderedText=contentService.renderedContent((String)xslt,contentObjs,rowCount);
    if (!escapeXml) {
      out.write(renderedText);
    }
 else {
      writeEscapedXml(renderedText.toCharArray(),renderedText.length(),out);
    }
  }
 catch (  Exception e) {
    throw new JspException();
  }
  return EVAL_PAGE;
}
