{
  Order order=cartService.createNewCartForCustomer(createCustomer());
  order.addOrderItem(createDiscreteOrderItem(sku1,10D,null,true,2,order));
  order.addOrderItem(createDiscreteOrderItem(sku2,20D,null,true,1,order));
  order.addAddedOfferCode(createOfferCode("20 Percent Off Item Offer",OfferType.ORDER_ITEM,OfferDiscountType.PERCENT_OFF,20,null,"discreteOrderItem.sku.id == " + sku1,true,true,10));
  order.addAddedOfferCode(createOfferCode("3 Dollars Off Item Offer",OfferType.ORDER_ITEM,OfferDiscountType.AMOUNT_OFF,3,null,"discreteOrderItem.sku.id != " + sku1,true,true,10));
  Offer offer=createOffer("1.20 Dollars Off Order Offer",OfferType.ORDER,OfferDiscountType.AMOUNT_OFF,1.20,null,null,true,true,10);
  offer.setDeliveryType(OfferDeliveryType.MANUAL);
  offer=offerService.save(offer);
  CustomerOffer customerOffer=new CustomerOfferImpl();
  customerOffer.setCustomer(order.getCustomer());
  customerOffer.setOffer(offer);
  customerOffer=customerOfferDao.save(customerOffer);
  List<Offer> offers=offerService.buildOfferListForOrder(order);
  offerService.applyOffersToOrder(offers,order);
  assert(order.getAdjustmentPrice().equals(new Money(31.80D)));
}
