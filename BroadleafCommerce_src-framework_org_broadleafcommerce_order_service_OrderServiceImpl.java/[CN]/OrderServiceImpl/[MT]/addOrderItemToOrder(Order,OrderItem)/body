{
  int orderItemIndex;
  List<OrderItem> orderItems=order.getOrderItems();
  boolean containsItem=orderItems.contains(newOrderItem);
  if (rollupOrderItems && containsItem) {
    OrderItem itemFromOrder=orderItems.get(orderItems.indexOf(newOrderItem));
    itemFromOrder.setQuantity(itemFromOrder.getQuantity() + newOrderItem.getQuantity());
    orderItemIndex=orderItems.indexOf(itemFromOrder);
  }
 else {
    orderItems.add(newOrderItem);
    newOrderItem.setOrder(order);
    orderItemIndex=orderItems.size() - 1;
  }
  order=updateOrder(order);
  return order.getOrderItems().get(orderItemIndex);
}
