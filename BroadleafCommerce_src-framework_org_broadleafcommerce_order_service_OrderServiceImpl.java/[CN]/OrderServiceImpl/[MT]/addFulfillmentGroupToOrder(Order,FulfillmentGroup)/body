{
  FulfillmentGroup dfg;
  try {
    dfg=fulfillmentGroupDao.readDefaultFulfillmentGroupForOrder(order);
  }
 catch (  NoResultException nre) {
    FulfillmentGroup newDfg=findDefaultFulfillmentGroupForOrder(order);
    order.addFulfillmentGroup(newDfg);
    newDfg.setAddress(fulfillmentGroup.getAddress());
    fulfillmentGroupDao.maintainDefaultFulfillmentGroup(newDfg);
    return newDfg;
  }
  if (dfg.getId().equals(fulfillmentGroup.getId())) {
    return fulfillmentGroupDao.maintainDefaultFulfillmentGroup(fulfillmentGroup);
  }
 else {
    fulfillmentGroup.setOrderId(order.getId());
    if (fulfillmentGroup.getFulfillmentGroupItems() != null) {
      for (      FulfillmentGroupItem fgItem : fulfillmentGroup.getFulfillmentGroupItems()) {
        for (        FulfillmentGroup fg : order.getFulfillmentGroups()) {
          for (          FulfillmentGroupItem tempFgi : fg.getFulfillmentGroupItems()) {
            if (tempFgi.getOrderItem().getId().equals(fgItem.getId())) {
              fg.getFulfillmentGroupItems().remove(fg);
            }
          }
          fulfillmentGroupDao.maintainFulfillmentGroup(fg);
        }
      }
    }
    FulfillmentGroup returnedFg=fulfillmentGroupDao.maintainFulfillmentGroup(fulfillmentGroup);
    order.addFulfillmentGroup(returnedFg);
    maintainOrder(order);
    return returnedFg;
  }
}
