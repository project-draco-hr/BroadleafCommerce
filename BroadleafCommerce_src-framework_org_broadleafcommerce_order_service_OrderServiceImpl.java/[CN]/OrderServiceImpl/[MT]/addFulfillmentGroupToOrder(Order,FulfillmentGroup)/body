{
  FulfillmentGroup dfg=findDefaultFulfillmentGroupForOrder(order);
  if (dfg == null) {
    fulfillmentGroup.setType(FulfillmentGroupType.DEFAULT);
  }
 else   if (dfg.equals(fulfillmentGroup)) {
    fulfillmentGroup.setType(FulfillmentGroupType.DEFAULT);
    order.getFulfillmentGroups().remove(dfg);
    fulfillmentGroupDao.delete(dfg);
  }
  fulfillmentGroup.setOrder(order);
  for (  FulfillmentGroupItem fgItem : fulfillmentGroup.getFulfillmentGroupItems()) {
    for (    FulfillmentGroup fg : order.getFulfillmentGroups()) {
      for (      FulfillmentGroupItem oldItem : fg.getFulfillmentGroupItems()) {
        if (oldItem.getOrderItem().getId().equals(fgItem.getOrderItem().getId())) {
          fg.getFulfillmentGroupItems().remove(oldItem);
        }
      }
    }
  }
  order.getFulfillmentGroups().add(fulfillmentGroup);
  order=updateOrder(order);
  return order.getFulfillmentGroups().get(order.getFulfillmentGroups().indexOf(fulfillmentGroup));
}
