{
  Offer offer=offerService.lookupOfferByCode(offerCode);
  List<OrderItem> orderItems=findItemsForOrder(order);
  for (  OrderItem orderItem : orderItems) {
    if (offer.getType() == OfferType.ORDER_ITEM) {
      if (offer.getOfferOrderItems().indexOf(orderItem) > -1) {
        orderItem.addCandidateOffer(offer);
      }
    }
 else     if (offer.getType() == OfferType.ORDER) {
      orderItem.addCandidateOffer(offer);
    }
  }
  return order;
}
