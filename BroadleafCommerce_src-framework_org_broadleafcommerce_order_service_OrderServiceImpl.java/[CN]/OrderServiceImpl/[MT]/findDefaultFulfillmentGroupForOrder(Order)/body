{
  FulfillmentGroup fg=null;
  try {
    fg=fulfillmentGroupDao.readDefaultFulfillmentGroupForOrder(order);
  }
 catch (  NoResultException nre) {
    fg=createDefaultFulfillmentGroup(order);
    fg=fulfillmentGroupDao.maintainDefaultFulfillmentGroup(fg);
  }
  if (fg.getFulfillmentGroupItems() == null || fg.getFulfillmentGroupItems().size() == 0) {
    List<OrderItem> orderItems=order.getOrderItems();
    for (    OrderItem orderItem : orderItems) {
      FulfillmentGroupItem fgi=this.createFulfillmentGroupItemFromOrderItem(orderItem,fg.getId());
      fgi=fulfillmentGroupItemDao.maintainFulfillmentGroupItem(fgi);
      fg.addFulfillmentGroupItem(fgi);
    }
    fulfillmentGroupDao.maintainDefaultFulfillmentGroup(fg);
  }
  return fg;
}
